{
  "hash": "7bc85352c3edda147bd3ffa495b5f10a",
  "result": {
    "markdown": "---\ntitle: \"R包: canregtools\"\nsubtitle: \"肿瘤登记(逻辑核查、数据分析、数据可视化、肿瘤报告)\"\nauthor: \"👨‍⚕️陈琼，博士，副主任医师\"\ndate: 2023-9-23\ndate-modified: last-modified\ndate-format: \"dddd MMM D, YYYY\"\ninstitute: \"🏥河南省癌症中心\\n河南省肿瘤医院\"\nformat: \n  revealjs:\n    slide-number: true\n    smaller: true\n    scrollable: true\n    footer: \"R package: canregtools\"\n    subtitle-as-header: true\ntitle-slide-attributes:\n  data-background-color: \"lightblue\"\ncategories: [\"肿瘤登记\", \"R语言\"]\naddress: \"呼和浩特\"\n---\n\n\n## 实际需求\n\n<br>\n\n> 肿瘤登记是我国恶性肿瘤监测的一项常规工作内容，它定期收集人群中恶性肿瘤发病、死亡及生存数据并进行统计分析，从而为肿瘤防控工作提供参考数据。\n\n<br>\n\n- 质量控制（五大洲发病率、年度数据质量审核）\n- 统计分析（粗率、标化率等）\n- 撰写报告（肿瘤登记年报）\n- 科技论文\n\n:::{.callout-important}\n## 缺少工具\n目前还没有一款公开发布的肿瘤登记数据分析工具来方便快捷的实现上述功能。\n:::\n\n\n## 软件平台选择\n\n<br>\n\n> *R语言*是一种用于统计分析和数据可视化的编程语言和环境。它是一个开源的、免费的软件，广泛用于统计学、数据分析、数据挖掘和生物信息学等领域。\n\n<br>\n\n\n```{mermaid}\n%%| label: fig-1\n%%| fig-cap: 软件平台选择\n%%| fig-align: center\nflowchart TD\n  A[(工具)] --> B(R语言)\n  A --> C(SAS)\n  A --> D(SPSS)\n  A --> E(STATA)\n  A --> F(Python)\n```\n\n\n\n## 软件平台选择\n<br>\n\n:::: {.columns}\n\n::: {.column width=\"50%\"}\n- 免费\n- 便于分享(CRAN, github)\n- R包\n- 跨平台(Windows、macOS、Linux、unix)\n:::\n\n::: {.column width=\"50%\"}\n![](images/r-packages.png)\n\n:::\n\n::::\n\n\n## 功能设计\n\n\n\n```{mermaid}\n\n%%| fig-align: center\nflowchart TD\n  A[(肿瘤登记R包)] --> B(数据读入与转换)\n  A --> C(数据处理)\n  A --> D(质量控制)\n  A --> E(统计分析)\n  A --> F(可视化)\n  A --> G(报表)\n  B --> b1(常规报告)\n  B --> b2(寿命表)\n  C --> c1(标准转换)\n  C --> c2(分类)\n  C --> c3(语种)\n  C --> c4(人口数据)\n  \n```\n\n\n\n:::: {.columns}\n\n::: {.column width=\"50%\"}\n\n```{mermaid}\n%%| fig-align: center\nflowchart TD\n  A[(统计分析)] --> B(统计计算)\n  A --> C(统计学检验)\n  B --> b1(寿命表)\n  B --> b2(截缩率)\n  B --> b3(标化率)\n  B --> b4(年龄别率)\n```\n\n:::\n\n::: {.column width=\"50%\"}\n\n```{mermaid}\n%%| fig-align: center\nflowchart TD\n  A[(可视化)] --> B(人口金字塔)\n  A --> C(线图)\n  A --> D(双向条形图)\n  A --> E(玫瑰图)\n  A --> F(哑铃图)\n  A --> G(癌症地图)\n```\n\n:::\n\n::::\n\n## 包的安装\n\n可以通过devtools安装\n\n```r\nlibrary(devtools)\ninstall_github(\"gigu003/canregtools\")\n```\n\n![](images/github.jpg)\n\n也可以通过remotes包进行安装\n\n```r\ninstall.packages(\"remotes\")\nlibrary(remotes)\ninstall_github(\"gigu003/canregtoools\")\n```\n\n## 读取数据\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\nlibrary(canregtools)\nfile <- system.file(\"extdata\", \"411721.xls\", package = \"canregtools\")\ndata <- read_canreg(file)\ndata\n```\n````\n\n::: {.cell-output .cell-output-stdout}\n```\n2200  cases were read from FB sheet.1470  cases were read from SW sheet.$areacode\n[1] \"411721\"\n\n$county\n[1] \"\"\n\n$area_type\n[1] \"\"\n\n$location\n[1] \"\"\n\n$year\n[1] 2016\n\n$FBcases\n# A tibble: 2,200 × 20\n   registr sex   age   birthda    inciden    topo  morp  beha  grad  basi  trib \n   <chr>   <chr> <chr> <date>     <date>     <chr> <chr> <chr> <chr> <chr> <chr>\n 1 174117… 2     72    1943-10-04 2016-04-11 C00.9 8070  3     9     7     01   \n 2 184117… 1     91    1925-02-02 2016-09-13 C01.9 8070  3     9     7     01   \n 3 184117… 1     74    1941-09-16 2016-04-14 C01.9 8070  3     9     7     01   \n 4 194117… 1     61    1954-08-13 2016-06-15 C02.9 8070  3     9     7     01   \n 5 174117… 2     8     2008-03-31 2016-05-05 C02.9 9591  3     9     7     01   \n 6 164117… 1     60    1955-11-22 2016-07-04 C03.9 8070  3     9     7     01   \n 7 184117… 1     80    1935-08-12 2016-04-03 C03.9 8070  3     9     7     01   \n 8 204117… 1     71    1944-06-13 2016-03-02 C05.1 8070  3     9     7     01   \n 9 174117… 1     65    1951-03-25 2016-12-28 C05.9 8010  3     3     7     01   \n10 174117… 1     63    1953-01-08 2016-05-10 C05.9 8070  3     9     7     01   \n# ℹ 2,190 more rows\n# ℹ 9 more variables: dlc <dttm>, deathda <dttm>, caus <chr>, marri <chr>,\n#   status <chr>, reportd <dttm>, treatment <chr>, firsttreat <chr>,\n#   icd10 <chr>\n\n$SWcases\n# A tibble: 1,470 × 10\n   registr  sex   age   birthda    topo  morp  beha  inciden    deathda    icd10\n   <chr>    <chr> <chr> <date>     <chr> <chr> <chr> <date>     <date>     <chr>\n 1 1641172… 1     65    1951-05-28 C02.9 8052  3     2012-09-03 2016-07-13 C02.9\n 2 1741170… 1     75    1941-10-01 C02.9 8070  3     2014-04-28 2016-12-10 C02.9\n 3 1741170… 1     67    1949-11-04 C03.0 8070  3     2015-10-04 2016-12-15 C03.0\n 4 1741170… 1     68    1948-01-15 C04.9 8070  3     2015-09-11 2016-07-29 C04.9\n 5 1741170… 1     63    1953-04-08 C06.0 8050  3     2012-11-08 2016-11-09 C06.0\n 6 1741170… 1     67    1948-12-12 C06.9 8070  3     2015-05-06 2016-07-23 C06.9\n 7 1741170… 1     66    1950-10-10 C06.9 8070  3     2015-04-08 2016-11-10 C06.9\n 8 1741170… 1     67    1949-03-10 C07.9 8430  3     2014-06-10 2016-06-06 C07  \n 9 1741170… 1     65    1950-07-07 C07.9 8562  3     2015-10-02 2016-03-14 C07  \n10 1741170… 2     84    1931-12-02 C09.9 8070  3     2016-05-16 2016-12-22 C09.9\n# ℹ 1,460 more rows\n\n$POP\n# A tibble: 38 × 4\n    year   sex agegrp   rks\n   <int> <int> <fct>  <dbl>\n 1  2016     1 0       5053\n 2  2016     1 1      17743\n 3  2016     1 5      25541\n 4  2016     1 10     32509\n 5  2016     1 15     30530\n 6  2016     1 20     34806\n 7  2016     1 25     36846\n 8  2016     1 30     38691\n 9  2016     1 35     40056\n10  2016     1 40     39252\n# ℹ 28 more rows\n\nattr(,\"class\")\n[1] \"canreg\" \"list\"  \n```\n:::\n:::\n\n\n## 常用数据处理函数\n\n### 年龄重新分组--cutage()\n\n\ncutage(\n  x,\n  \n  method = \"distance\",\n  \n  length = 5,\n  \n  maxage = 85,\n  \n  sep_zero = TRUE,\n  \n  breaks = c(seq(0, 85, 5)),\n  \n  labels = NULL,\n  \n  lang = \"cn\",\n  \n  label_tail = NULL,\n  \n  right = FALSE\n)\n\n\n## 常用数据处理函数\n\n### 年龄重新分组--cutage()\n\n::: {.panel-tabset}\n## distance方法  \n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\nlibrary(canregtools)\nage <- sample(0:101, 200, replace = TRUE)\nagegrp <- cutage(age, method = \"distance\", length = 5, maxage = 60, sep_zero = TRUE)\nas.data.frame(table(agegrp))\n```\n````\n\n::: {.cell-output .cell-output-stdout}\n```\n     agegrp Freq\n1      0 岁    0\n2    1-4 岁    6\n3    5-9 岁   15\n4  10-14 岁   10\n5  15-19 岁    7\n6  20-24 岁   11\n7  25-29 岁   10\n8  30-34 岁   11\n9  35-39 岁    8\n10 40-44 岁    8\n11 45-49 岁    9\n12 50-54 岁   10\n13 55-59 岁   14\n14   60+ 岁   81\n```\n:::\n:::\n\n\n## interval方法\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\nlibrary(canregtools)\nage <- sample(0:101, 200, replace = TRUE)\nagegrp <- cutage(age, method = \"interval\", breaks = seq(0, 85, 5),lang = \"en\")\nas.data.frame(table(agegrp))\n```\n````\n\n::: {.cell-output .cell-output-stdout}\n```\n      agegrp Freq\n1    0-4 yrs   12\n2    5-9 yrs    8\n3  10-14 yrs    7\n4  15-19 yrs    7\n5  20-24 yrs    7\n6  25-29 yrs    4\n7  30-34 yrs    7\n8  35-39 yrs   10\n9  40-44 yrs   16\n10 45-49 yrs   14\n11 50-54 yrs    7\n12 55-59 yrs    7\n13 60-64 yrs   10\n14 65-69 yrs   14\n15 70-74 yrs    7\n16 75-79 yrs   10\n17 80-84 yrs   10\n18   85+ yrs   43\n```\n:::\n:::\n\n:::\n\n## 常用数据处理函数\n\n### 扩充人口数据-- expand_age_pop()\n\n<br>\n\nexpand_age_pop(x, method = \"linear\")\n\n<br>\n\nx\tVector, population for each age group.\n\nmethod\tMethod for expanding, options are 'linear', 'constant', 'periodic',\nor 'natural'. Default is 'linear'.\n\n\n## 常用数据处理函数\n\n### 扩充人口数据-- expand_age_pop() \n\n::: {.cell output-location='slide'}\n\n````{.cell-code}\n```{{r}}\n#| output-location: slide\nage <- c(0, 1, seq(5, 85, 5))\npops <- c(5053, 17743, 25541, 32509, 30530, 34806, 36846, 38691, 40056,\n   39252, 37349, 30507, 26363, 21684, 15362, 11725, 7461, 3260, 915)\n\npop <- pops\npop[2] <- pop[2]/4\npop[3:19] <- pop[3:19]/5\n#把人口数据从5岁组扩充至1岁组\nage2 <- expand_age_pop(pops)\n#绘制拟合曲线\npar(family=\"STKaiti\")\nplot(age2, pch = 19, xlab= \"年龄组\", ylab = \"人口数\", type = \"l\")\nlines(age, pop, type = \"p\", col=\"red\")\n```\n````\n\n::: {.cell-output-display}\n![](index_files/figure-revealjs/unnamed-chunk-8-1.png){width=960}\n:::\n:::\n\n\n\n## 常用数据处理函数\n### ICDO3转换ICD10编码\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\ntopo <- c(\"C001\", \"C15.1\", \"C349\")\nmorp <- c(\"8140\", \"8000\", \"8070\")\nbeha <- rep(\"3\", 3)\nicdo3to10(topo, morp, beha)\n```\n````\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"C00.1\" \"C15.1\" \"C34.9\"\n```\n:::\n:::\n\n\n## 常用数据处理函数\n### 肿瘤的分类\n\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\nfile <- system.file(\"extdata\", \"411721.xls\", package = \"canregtools\")\ndata <- read_canreg(file)\nicd10 <- data$FBcases$icd10\nhead(icd10)\n```\n````\n\n::: {.cell-output .cell-output-stdout}\n```\n2200  cases were read from FB sheet.1470  cases were read from SW sheet.[1] \"C00.9\" \"C01\"   \"C01\"   \"C02.9\" \"C85.9\" \"C03.9\"\n```\n:::\n:::\n\n\n## 常用数据处理函数\n### 肿瘤的分类-- classify_icd10\n\n<br>\n\nclassify_icd10(icd10, type = \"big\", lang = \"cn\")\n\n## 常用数据处理函数\n### 肿瘤的分类-- classify_icd10\n\n::: {.panel-tabset}\n## 26类(中文)\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\nc1 <- classify_icd10(icd10, type = \"big\", lang = \"cn\")\nas.data.frame(table(c1))\n```\n````\n\n::: {.cell-output .cell-output-stdout}\n```\n             c1 Freq\n1          排除    0\n2          口腔   17\n3          鼻咽   10\n4          食管  241\n5            胃  207\n6        结直肠  141\n7            肝  263\n8          胆囊   42\n9          胰腺   41\n10           喉   13\n11           肺  463\n12 其他胸腔器官    5\n13           骨   19\n14 皮肤黑色素瘤    6\n15         乳房  176\n16       子宫颈   69\n17       子宫体   31\n18         卵巢   31\n19       前列腺   23\n20         睾丸    3\n21           肾   22\n22         膀胱   33\n23           脑   77\n24       甲状腺   49\n25       淋巴瘤   75\n26       白血病   57\n27         其他   86\n```\n:::\n:::\n\n\n## 59类(英文)\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\nc1 <- classify_icd10(icd10, type = \"small\", lang = \"en\")\nas.data.frame(table(c1))\n```\n````\n\n::: {.cell-output .cell-output-stdout}\n```\n                             c1 Freq\n1                      Excluded    0\n2                           Lip    1\n3                        Tongue    3\n4                         Mouth    5\n5               Salivary glands    4\n6                        Tonsil    1\n7              Other oropharynx    2\n8                   Nasopharynx   10\n9                   Hypopharynx    1\n10          Pharynx unspecified    0\n11                    Esophagus  241\n12                      Stomach  207\n13              Small intestine   13\n14                        Colon   74\n15                       Rectum   63\n16                         Anus    4\n17                        Liver  263\n18             Gallbladder etc.   42\n19                     Pancreas   41\n20             Nose,sinses etc.    4\n21                       Larynx   13\n22     Trachea, bronchus & lung  463\n23        Other thoracic organs    5\n24                         Bone   19\n25             Melanoma of skin    6\n26                   Other skin   16\n27                 Mesothelioma    0\n28               Kaposi sarcoma    0\n29      Connective &soft tissue   11\n30                       Breast  176\n31                        Vulva    3\n32                       Vagina    0\n33                 Cervix uteri   69\n34                 Corpus uteri   23\n35           Uterus unspecified    8\n36                        Ovary   31\n37  Other female genital organs    4\n38                     Placenta    5\n39                        Penis    4\n40                     Prostate   23\n41                       Testis    3\n42    Other male genital organs    0\n43                       Kidney   17\n44                 Renal pelvis    1\n45                       Ureter    2\n46                      Bladder   33\n47         Other urinary organs    2\n48                          Eye    2\n49         Brain,nervous system   77\n50                      Thyroid   49\n51                 Adrenal glad    4\n52              Other endocrine    2\n53             Hodgkin lymphoma    3\n54         Non-Hodgkin lymphoma   55\n55 Immunoproliferative diseases    0\n56             Multiple myeloma   17\n57            Lymphoid leukemia   10\n58             Myeloid leukemia   39\n59         Leukemia unspecified    8\n60        Other and unspecified   18\n```\n:::\n:::\n\n\n## 按系统分类(中文)\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\nc1 <- classify_icd10(icd10, type = \"system\", lang = \"cn\")\nas.data.frame(table(c1))\n```\n````\n\n::: {.cell-output .cell-output-stdout}\n```\n               c1 Freq\n1            排除    0\n2          唇口咽   27\n3        消化系统  949\n4        呼吸系统  515\n5  骨、软骨、皮肤   58\n6          乳腺癌  176\n7    女性生殖系统  143\n8    男性生殖系统   30\n9        泌尿系统   55\n10 眼、脑、甲状腺   94\n11       造血系统  113\n12           其他   40\n```\n:::\n:::\n\n\n:::\n\n\n## 常用数据处理函数\n### 儿童肿瘤的分类-- classify_childhood\n\n<br>\n\nclassify_childhood(topo, morp, type = \"main\", lang = \"cn\")\n\n\n## 常用数据处理函数\n### 儿童肿瘤的分类-- classify_childhood\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\nfbcases <- data$FBcases\nfbcases <- fbcases[fbcases$age <= 14,]\n\nclassify_childhood(fbcases$topo, fbcases$morp, lang = \"cn\")\n\nclassify_childhood(fbcases$topo, fbcases$morp, type = \"sub\", lang = \"en\")\n```\n````\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] XII. 其他和未特指          未分类或原位癌;           \n[3] V. 视网膜母细胞瘤          XI. 其他恶性上皮和黑色素瘤\n[5] XII. 其他和未特指          II. 淋巴瘤                \n13 Levels: I. 白血病 II. 淋巴瘤 III. 中枢神经系统 ... 未分类或原位癌;\n[1] XIIb. Other unspecified malignant tumors\n[2] Not Classified by ICCC or in situ       \n[3] V. Retinoblastoma                       \n[4] XIb. thyroid carcinomas                 \n[5] XIIb. Other unspecified malignant tumors\n[6] IIb. Non-Hodgkin except BL              \n49 Levels: Ia. Lymphod leukemias Ib. Acute myeloid Ic. CMD ... Not Classified by ICCC or in situ\n```\n:::\n:::\n\n\n\n## counts\n\n\n::: {.cell output-location='slide'}\n\n````{.cell-code}\n```{{r}}\n#| output-location: slide\nfile <- system.file(\"extdata\", \"411721.xls\", package = \"canregtools\")\ndata <- read_canreg(file)\nfbsw <- count_canreg(data, cutage_method = \"interval\")\nfbsw\n```\n````\n\n::: {.cell-output .cell-output-stdout}\n```\n2200  cases were read from FB sheet.1470  cases were read from SW sheet.[1] \"Processing data: 2200 FBcases.\"\n[1] \"Processing data: 1470 SWcases.\"\n[1] \"Processing POP data of year: 2016\"\n# A tibble: 208 × 11\n    year sex   agegrp   icd_cat   fbs   sws    mv    ub   sub   dco    rks\n   <dbl> <fct> <fct>    <fct>   <int> <int> <int> <int> <int> <int>  <int>\n 1  2016 男性  0-14 岁  口腔        0     0     0     0     0     0  80846\n 2  2016 男性  15-39 岁 口腔        1     0     1     0     1     0 180929\n 3  2016 男性  40-64 岁 口腔        5     2     5     0     3     0 155155\n 4  2016 男性  65+ 岁   口腔        7     8     7     0     3     0  38723\n 5  2016 男性  0-14 岁  鼻咽        0     0     0     0     0     0  80846\n 6  2016 男性  15-39 岁 鼻咽        2     0     2     0     2     0 180929\n 7  2016 男性  40-64 岁 鼻咽        2     6     2     0     2     0 155155\n 8  2016 男性  65+ 岁   鼻咽        3     1     3     0     3     0  38723\n 9  2016 男性  0-14 岁  食管        0     0     0     0     0     0  80846\n10  2016 男性  15-39 岁 食管        1     0     1     0     0     0 180929\n# ℹ 198 more rows\n```\n:::\n:::\n\n\n## 年龄别率\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\ncreate_age_rate(fbsw, event = sws, year, sex, icd_cat)\n```\n````\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 208 × 6\n    year sex   icd_cat agegrp   cases  rate\n   <dbl> <fct> <fct>   <fct>    <int> <dbl>\n 1  2016 男性  口腔    0-14 岁      0  0   \n 2  2016 男性  口腔    15-39 岁     0  0   \n 3  2016 男性  口腔    40-64 岁     2  1.29\n 4  2016 男性  口腔    65+ 岁       8 20.7 \n 5  2016 男性  鼻咽    0-14 岁      0  0   \n 6  2016 男性  鼻咽    15-39 岁     0  0   \n 7  2016 男性  鼻咽    40-64 岁     6  3.87\n 8  2016 男性  鼻咽    65+ 岁       1  2.58\n 9  2016 男性  食管    0-14 岁      0  0   \n10  2016 男性  食管    15-39 岁     0  0   \n# ℹ 198 more rows\n```\n:::\n:::\n\n\n## 质量控制报表\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\ncreate_quality(fbsw, year, sex)\n```\n````\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 2 × 7\n   year sex      mi    mv    ub   sub   dco\n  <dbl> <fct> <dbl> <dbl> <dbl> <dbl> <dbl>\n1  2016 男性   0.78  65.7  0.67  57.0  2.61\n2  2016 女性   0.54  76.2  0.3   59.4  1.88\n```\n:::\n:::\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\ncreate_quality(fbsw, year, sex, icd_cat)\n```\n````\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 52 × 8\n    year sex   icd_cat    mi    mv    ub    sub   dco\n   <dbl> <fct> <fct>   <dbl> <dbl> <dbl>  <dbl> <dbl>\n 1  2016 男性  口腔     0.77 100       0  53.8   0   \n 2  2016 男性  鼻咽     1    100       0 100     0   \n 3  2016 男性  食管     0.81  86.0     0  80.9   2.55\n 4  2016 男性  胃       0.79  91.1     0  63.0   2.22\n 5  2016 男性  结直肠   0.6   95.8     0  29.2   1.39\n 6  2016 男性  肝       0.9   26.7     0   9.44  4.44\n 7  2016 男性  胆囊     0.81  93.8     0  12.5   0   \n 8  2016 男性  胰腺     0.74  22.2     0  66.7   3.7 \n 9  2016 男性  喉       0.91 100       0  81.8   0   \n10  2016 男性  肺       0.85  52.5     0  89.4   2.5 \n# ℹ 42 more rows\n```\n:::\n:::\n\n\n## 标化率\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\nasr_rate(data, year, sex, icd_cat, lang = \"en\" )\n```\n````\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"Processing data: 2200 FBcases.\"\n[1] \"Processing data: 1470 SWcases.\"\n[1] \"Processing POP data of year: 2016\"\n# A tibble: 52 × 13\n    year sex   icd_cat  no_cases    cr cr_lower cr_upper asr_segi asr_lower_segi\n   <dbl> <fct> <fct>       <int> <dbl>    <dbl>    <dbl>    <dbl>          <dbl>\n 1  2016 Male  Oral ca…       13  2.85     1.52     4.88     2.73           1.34\n 2  2016 Male  Nasopha…        7  1.54     0.62     3.17     1.16           0.47\n 3  2016 Male  Esophag…      157 34.5     29.3     40.3     30.6           25.5 \n 4  2016 Male  Stomach       135 29.6     24.8     35.1     24.9           20.6 \n 5  2016 Male  Colon-r…       72 15.8     12.4     19.9     12.6            9.79\n 6  2016 Male  Liver         180 39.5     33.9     45.7     31.8           27.0 \n 7  2016 Male  Gallbla…       16  3.51     2.01     5.7      2.7            1.54\n 8  2016 Male  Pancreas       27  5.93     3.9      8.62     5.03           3.2 \n 9  2016 Male  Larynx         11  2.41     1.21     4.32     1.78           0.88\n10  2016 Male  Lung          320 70.2     62.7     78.4     61.0           53.8 \n# ℹ 42 more rows\n# ℹ 4 more variables: asr_upper_segi <dbl>, asr_china <dbl>,\n#   asr_lower_china <dbl>, asr_upper_china <dbl>\n```\n:::\n:::\n\n\n## 标化率\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\nasr_rate(data, year, icd_cat, type = \"system\", lang = \"en\" )\n```\n````\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"Processing data: 2200 FBcases.\"\n[1] \"Processing data: 1470 SWcases.\"\n[1] \"Processing POP data of year: 2016\"\n# A tibble: 11 × 12\n    year icd_cat       no_cases     cr cr_lower cr_upper asr_segi asr_lower_segi\n   <dbl> <fct>            <int>  <dbl>    <dbl>    <dbl>    <dbl>          <dbl>\n 1  2016 Lip,mouth an…       27   3.06     2.02     4.45     2.34           1.53\n 2  2016 Digestive sy…      949 108.     101.     115.      81.5           76.3 \n 3  2016 Respiratory …      515  58.4     53.4     63.7     43.6           39.8 \n 4  2016 Bone,cartila…       58   6.58     4.99     8.5      5.31           3.99\n 5  2016 Breast cancer      176  20.0     17.1     23.1     15.1           12.9 \n 6  2016 Female repro…      143  16.2     13.7     19.1     12.5           10.5 \n 7  2016 Male reprodu…       30   3.4      2.29     4.86     3.1            2.06\n 8  2016 Urinary syst…       55   6.24     4.7      8.12     5.14           3.8 \n 9  2016 Eyes,brain,t…       94  10.7      8.61    13.0      9              7.15\n10  2016 Hemopoietic …      113  12.8     10.6     15.4     11.2            9.09\n11  2016 Other               40   4.54     3.24     6.18     3.49           2.47\n# ℹ 4 more variables: asr_upper_segi <dbl>, asr_china <dbl>,\n#   asr_lower_china <dbl>, asr_upper_china <dbl>\n```\n:::\n:::\n\n\n## 简略寿命表\n\n\n::: {.cell output-location='slide'}\n\n````{.cell-code}\n```{{r}}\n#| output-location: slide\n\npx <- c(\n  20005, 86920, 102502, 151494, 182932,\n  203107, 240289, 247076, 199665, 163820,\n  145382, 86789, 69368, 51207, 39112, 20509,\n  12301, 6586, 1909\n)\ndx <- c(\n  156, 58, 47, 49, 48, 68, 120, 162, 160, 294,\n  417, 522, 546, 628, 891, 831, 926, 731, 269\n)\nmx <- dx / px\n\nlt <- lt(mx, sage = 0, agegrp = 5, sex = \"total\")\nlt$ex <- round(lt$ex, 2)\nlt\n```\n````\n\n::: {.cell-output .cell-output-stdout}\n```\n   age           mx          qx        lx          dx       Lx        Tx    ex\n1    0 0.0077980505 0.007741928 1.0000000 0.007741928 0.992803 75.704586 75.70\n2    1 0.0006672803 0.002664799 0.9922581 0.002644169 3.962606 74.711783 75.29\n3    5 0.0004585276 0.002290118 0.9896139 0.002266333 4.942630 70.749177 71.49\n4   10 0.0003234452 0.001615971 0.9873476 0.001595525 4.932909 65.806547 66.65\n5   15 0.0002623926 0.001311137 0.9857520 0.001292456 4.925658 60.873638 61.75\n6   20 0.0003347989 0.001672650 0.9844596 0.001646657 4.918346 55.947980 56.83\n7   25 0.0004993986 0.002494004 0.9828129 0.002451139 4.908182 51.029634 51.92\n8   30 0.0006556687 0.003273193 0.9803618 0.003208913 4.894108 46.121452 47.05\n9   35 0.0008013422 0.003999020 0.9771529 0.003907654 4.876386 41.227345 42.19\n10  40 0.0017946527 0.008934780 0.9732452 0.008695732 4.845356 36.350959 37.35\n11  45 0.0028683056 0.014243477 0.9645495 0.013738538 4.789775 31.505602 32.66\n12  50 0.0060145871 0.029645010 0.9508110 0.028186800 4.686406 26.715827 28.10\n13  55 0.0078710645 0.038625662 0.9226242 0.035636969 4.527592 22.029421 23.88\n14  60 0.0122639483 0.059566493 0.8869872 0.052834716 4.308133 17.501829 19.73\n15  65 0.0227807323 0.107998953 0.8341525 0.090087593 3.954552 13.193696 15.82\n16  70 0.0405187966 0.184638766 0.7440649 0.137383221 3.390605  9.239144 12.42\n17  75 0.0752784326 0.318795874 0.6066817 0.193407609 2.569230  5.848539  9.64\n18  80 0.1109930155 0.438228382 0.4132740 0.181108418 1.631710  3.279309  7.93\n19  85 0.1409114720 1.000000000 0.2321656 0.232165631 1.647599  1.647599  7.10\n```\n:::\n:::\n\n\n## 简略寿命表-->完全寿命表\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\nlx <- c(\n  100000, 99498.39, 99294.62, 99173.88, 99047.59, 98840.46,\n  98521.16, 98161.25, 97636.99, 96900.13, 95718.96, 93930.91,\n  91463.21, 87131.41, 80525.02, 70907.59, 58090.75, 41630.48,\n  24019.33\n)\nlx <- lx / 100000\nexpand_lifetable(lx)\n```\n````\n\n::: {.cell-output .cell-output-stdout}\n```\n$fitlx\n  [1] 1.000000e+00 9.949839e-06 9.943045e-06 9.937549e-06 9.933096e-06\n  [6] 9.929462e-06 9.926447e-06 9.923875e-06 9.921584e-06 9.919469e-06\n [11] 9.917388e-06 9.915591e-06 9.913472e-06 9.910964e-06 9.908052e-06\n [16] 9.904759e-06 9.901464e-06 9.897781e-06 9.893669e-06 9.889097e-06\n [21] 9.884046e-06 9.878288e-06 9.872129e-06 9.865659e-06 9.858964e-06\n [26] 9.852116e-06 9.845529e-06 9.838754e-06 9.831679e-06 9.824179e-06\n [31] 9.816125e-06 9.807054e-06 9.797288e-06 9.786818e-06 9.775630e-06\n [36] 9.763699e-06 9.751300e-06 9.737934e-06 9.723405e-06 9.707503e-06\n [41] 9.690013e-06 9.670577e-06 9.649185e-06 9.625694e-06 9.599970e-06\n [46] 9.571896e-06 9.540591e-06 9.506973e-06 9.471163e-06 9.433217e-06\n [51] 9.393091e-06 9.352558e-06 9.308709e-06 9.260472e-06 9.206717e-06\n [56] 9.146321e-06 9.076329e-06 8.998268e-06 8.911862e-06 8.816888e-06\n [61] 8.713141e-06 8.601651e-06 8.480514e-06 8.349054e-06 8.206597e-06\n [66] 8.052502e-06 7.885124e-06 7.705356e-06 7.513086e-06 7.308241e-06\n [71] 7.090759e-06 6.863093e-06 6.621824e-06 6.366129e-06 6.095344e-06\n [76] 5.809075e-06 5.503783e-06 5.184939e-06 4.853927e-06 4.512550e-06\n [81] 4.163048e-06 3.808109e-06 3.450856e-06 3.094805e-06 2.743805e-06\n [86] 2.401933e-06 2.073362e-06 1.762192e-06 1.472263e-06 1.206941e-06\n [91] 9.689196e-07 7.600301e-07 5.811051e-07 4.319038e-07 3.111229e-07\n [96] 2.164995e-07 1.450033e-07 9.309887e-08 5.704549e-08 3.319473e-08\n\n$fitmx\n  [1] 1.151795e+01 6.830210e-04 5.529797e-04 4.481607e-04 3.659114e-04\n  [6] 3.036867e-04 2.591035e-04 2.309476e-04 2.131515e-04 2.098278e-04\n [11] 1.812540e-04 2.137218e-04 2.529973e-04 2.938187e-04 3.324396e-04\n [16] 3.327221e-04 3.720199e-04 4.155588e-04 4.622586e-04 5.108472e-04\n [21] 5.827656e-04 6.236256e-04 6.555918e-04 6.789103e-04 6.947944e-04\n [26] 6.688121e-04 6.884115e-04 7.193483e-04 7.630738e-04 8.201671e-04\n [31] 9.245562e-04 9.963060e-04 1.069214e-03 1.143761e-03 1.221279e-03\n [36] 1.270722e-03 1.371621e-03 1.493135e-03 1.636784e-03 1.803296e-03\n [41] 2.007795e-03 2.214475e-03 2.437525e-03 2.675953e-03 2.928714e-03\n [46] 3.275876e-03 3.529858e-03 3.773867e-03 4.014544e-03 4.262741e-03\n [51] 4.324492e-03 4.699514e-03 5.195447e-03 5.821605e-03 6.581639e-03\n [56] 7.681911e-03 8.637699e-03 9.648934e-03 1.071424e-02 1.183659e-02\n [61] 1.287819e-02 1.418307e-02 1.562286e-02 1.720989e-02 1.895548e-02\n [66] 2.100484e-02 2.306238e-02 2.526936e-02 2.764363e-02 3.021026e-02\n [71] 3.263420e-02 3.578726e-02 3.937935e-02 4.346630e-02 4.810392e-02\n [76] 5.398562e-02 5.967772e-02 6.596999e-02 7.292571e-02 8.061481e-02\n [81] 8.911464e-02 9.851066e-02 1.088974e-01 1.203792e-01 1.330717e-01\n [86] 1.471025e-01 1.626126e-01 1.797581e-01 1.987113e-01 2.196630e-01\n [91] 2.428237e-01 2.684264e-01 2.967286e-01 3.280149e-01 3.626000e-01\n [96] 4.008316e-01 4.430943e-01 4.898131e-01 5.414578e-01 5.414578e-01\n```\n:::\n:::\n\n\n## 人口金字塔图\n\n\n::: {.cell output-location='slide'}\n\n````{.cell-code}\n```{{r}}\n#| output-location: slide\n#| fig-height: 6\nleft <- c(\n  5053, 17743, 25541, 32509, 30530, 34806, 36846, 38691, 40056,\n  39252, 37349, 30507, 26363, 21684, 15362, 11725, 7461, 3260, 915\n)\nright <- c(\n  4728, 15330, 22633, 27784, 28082, 32605, 32964, 35732, 36234,\n  37123, 34242, 29152, 24667, 18940, 15406, 12355, 10206, 5634,\n  2547\n)\nagegrp <- c(\n  \"0\", \"1-4\", \"5-9\", \"10-14\", \"15-19\", \"20-24\", \"25-29\", \"30-34\",\n  \"35-39\", \"40-44\", \"45-49\", \"50-54\", \"55-59\", \"60-64\", \"65-69\",\n  \"70-74\", \"75-79\", \"80-84\", \"85+\"\n)\npop <- data.frame(left = left, right = right, row.names = agegrp)\npar(family=\"STKaiti\", mar=c(0,0,0,0))\npyramid(pop, main = \"Population pyramid in China.\", csize = 0.8, cgap = 0.3)\n```\n````\n\n::: {.cell-output-display}\n![](index_files/figure-revealjs/unnamed-chunk-23-1.png){width=960}\n:::\n:::\n\n\n## 双向条形图\n\n::: {.cell output-location='slide'}\n\n````{.cell-code}\n```{{r}}\n#| output-location: slide\n#| fig-height: 5\nfile <- system.file(\"extdata\", \"411721.xls\", package = \"canregtools\")\ndata <- read_canreg(file)\nrate <- asr_rate(data, icd_cat, event = sws)\npar(family=\"STKaiti\", mar=c(0,0,0,0))\ndulbar_chart(rate[,c(1, 3, 6, 9, 10)])\n```\n````\n\n::: {.cell-output .cell-output-stdout}\n```\n2200  cases were read from FB sheet.1470  cases were read from SW sheet.[1] \"Processing data: 2200 FBcases.\"\n[1] \"Processing data: 1470 SWcases.\"\n[1] \"Processing POP data of year: 2016\"\n```\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-revealjs/unnamed-chunk-24-1.png){width=960}\n:::\n:::\n\n\n## 线图\n\n\n::: {.cell output-location='slide'}\n\n````{.cell-code}\n```{{r}}\n#| output-location: slide\n#| fig-height: 5\nfile <- system.file(\"extdata\", \"411721.xls\", package = \"canregtools\")\ndata <- read_canreg(file)\nfbsw <- count_canreg(data)\nage <- create_age_rate(fbsw, sex, event = sws)\npar(family=\"STKaiti\", mar=c(0,0,0,0))\nline_chart(age, agegrp, rate, sex)\n```\n````\n\n::: {.cell-output .cell-output-stdout}\n```\n2200  cases were read from FB sheet.1470  cases were read from SW sheet.[1] \"Processing data: 2200 FBcases.\"\n[1] \"Processing data: 1470 SWcases.\"\n[1] \"Processing POP data of year: 2016\"\n```\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-revealjs/unnamed-chunk-25-1.png){width=960}\n:::\n:::\n\n\n\n## 哑铃图\n\n\n::: {.cell output-location='slide'}\n\n````{.cell-code}\n```{{r}}\n#| output-location: slide\n#| fig-height: 5\nfile <- system.file(\"extdata\", \"411721.xls\", package = \"canregtools\")\ndata <- read_canreg(file)\nrate <- asr_rate(data,icd_cat)\npar(family=\"STKaiti\", mar=c(0,0,0,0))\ndumbbell_chart(rate, icd_cat, cr_lower, cr_upper)\n```\n````\n\n::: {.cell-output .cell-output-stdout}\n```\n2200  cases were read from FB sheet.1470  cases were read from SW sheet.[1] \"Processing data: 2200 FBcases.\"\n[1] \"Processing data: 1470 SWcases.\"\n[1] \"Processing POP data of year: 2016\"\n```\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-revealjs/unnamed-chunk-26-1.png){width=960}\n:::\n:::\n\n\n## 下一步计划\n\n<br>\n\n- 登记处合并运算功能\n- 基于Rmarkdown年度报告撰写模板\n- 基于Rmarkdown质量控制报告模板\n- 统计地图功能\n- 肿瘤登记质量控制监测面板\n\n##  {background-image=\"images/canregtools.jpg\"}\n\n<br>\n\n<br>\n\n<br>\n\n[地址：https://gigu003.github.io/canregtools/](https://gigu003.github.io/canregtools/)\n\n# 谢 谢 关 注 ! {background-color=\"lightblue\"  style=\"text-align: center;color: white;\"}\n\n陈 琼 博士\n\nchenq08@126.com\n\nhttps:://www.chenq.site/qsight/\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}