{
  "hash": "d0c5d82216b1bfc6f41e6ebad51ef637",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"canregtools\"\nsubtitle: \"An R package used in PBCRs\"\nauthor: \"Ô∏èQiong Chenüë®‚Äç‚öïÔ∏è Phd.\"\ndate: 2024-11-4\ndate-modified: last-modified\ndate-format: \"dddd MMM D, YYYY\"\ninstitute: \"üè•Henan Cancer Center\"\nformat:\n  revealjs:\n    slide-number: true\n    scrollable: false\n    smaller: true\n    sc-sb-title: h1\n    footer: \"https://slides.chenq.site\"\nrevealjs-plugins:\n  - attribution\nfilters:\n   - reveal-header\n   - reveal-auto-agenda\nauto-agenda:\n  bullets: numbered\n  heading: Contents\ntitle-slide-attributes:\n  data-background-color: \"lightblue\"\ncategories: [\"ËÇøÁò§ÁôªËÆ∞\", \"RËØ≠Ë®Ä\"]\naddress: \"ÂëºÂíåÊµ©Áâπ\"\n---\n\n\n\n## What we actually do in PBCR {.smaller}\n> A system designed to collect, store, and manage cancer cases within a population is crucial for monitoring cancer incidence, mortality, survival, and prevalence.\n\n- Data internal consistency check\n- Quality check (CI5, annual check of quality control for registry)\n- Calculation of statistical indicator\n- Data visualization\n- Reports\n\n## How to install\n\nInstall it from github repository\n```r\n# install the remotes package if doesn't installed\ninstall.packages(\"remotes) \nlibrary(remotes)\ninstall_github(\"gigu003/canregtools\")\n```\n\nInstall it from compiled local source package file\n```r\n# install the remotes package if doesn't installed\ninstall.packages(\"remotes) \nlibrary(remotes)\ninstall_local(\"canregtools_0.2.7.tar.gz\", type = \"source\")\n```\n\n\n\n\n# Single cancer registry\n## Raw data(call for data from NCC)\n\n## Reading canreg data\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(canregtools)\nfiles <- list.files(\"~/website/slides/outputs\", full.names = TRUE)\nfile <- files[1]\ndata <- read_canreg(file)\nclass(data)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"canreg\" \"list\"  \n```\n\n\n:::\n\n```{.r .cell-code}\nnames(data)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"areacode\" \"FBcases\"  \"SWcases\"  \"POP\"     \n```\n\n\n:::\n:::\n\n\n\n\n## canreg object with class of 'canreg' {.smaller}\n\n> 'canreg' is a list contains four elements including 'areacode', 'FBcases', 'SWcases', and 'POP'\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnames(data)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"areacode\" \"FBcases\"  \"SWcases\"  \"POP\"     \n```\n\n\n:::\n\n```{.r .cell-code}\ndata$areacode\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"410102\"\n```\n\n\n:::\n\n```{.r .cell-code}\nhead(data$FBcases)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 √ó 23\n  registr         name  id    sex   birthda    address addcode trib  occu  marri\n  <chr>           <chr> <chr> <chr> <date>     <chr>   <chr>   <chr> <chr> <chr>\n1 214105001664899 ËµµÊµ©‚Ä¶ 4105‚Ä¶ 1     1975-04-17 Ê≤≥ÂçóÁúÅ‚Ä¶ 410102‚Ä¶ 01    31    2    \n2 214108021590500 ËåÉÊôì‚Ä¶ 3708‚Ä¶ 2     1991-01-16 Ê≤≥ÂçóÁúÅ‚Ä¶ 410102‚Ä¶ 01    14    2    \n3 214101021723818 ËµµËéâ  4127‚Ä¶ 2     1962-10-15 Ê≤≥ÂçóÁúÅ‚Ä¶ 410102‚Ä¶ 01    00    2    \n4 214112021234655 ÊùéÁßÄ‚Ä¶ 4112‚Ä¶ 2     1951-03-09 ‰∏ΩÂüéÂ∞è‚Ä¶ 410102‚Ä¶ 01    49    2    \n5 214116241372902 ÂàòË¥µ‚Ä¶ 4101‚Ä¶ 1     1955-07-15 Ê≤≥ÂçóÁúÅ‚Ä¶ 410102‚Ä¶ 01    61    2    \n6 234110021050453 ÊØõÊ†π‚Ä¶ 4110‚Ä¶ 1     1939-12-15 Ê≤≥ÂçóÁúÅ‚Ä¶ 410102‚Ä¶ 01    28    5    \n# ‚Ñπ 13 more variables: inciden <date>, topo <chr>, morp <chr>, beha <chr>,\n#   grad <chr>, basi <chr>, icd10 <chr>, autoicd10 <chr>, lastcontact <dttm>,\n#   status <chr>, caus <chr>, deathda <date>, deadplace <chr>\n```\n\n\n:::\n:::\n\n\n\n## canreg object with class of 'canreg' {.smaller}\n\n> 'canreg' is a list contains four elements including 'areacode', 'FBcases', 'SWcases', and 'POP'\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnames(data)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"areacode\" \"FBcases\"  \"SWcases\"  \"POP\"     \n```\n\n\n:::\n\n```{.r .cell-code}\nhead(data$SWcases)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 √ó 23\n  registr         name  id    sex   birthda    address addcode trib  occu  marri\n  <chr>           <chr> <chr> <chr> <date>     <chr>   <chr>   <chr> <chr> <chr>\n1 174101001241467 ÁøüÁéâ‚Ä¶ 4101‚Ä¶ 2     1921-02-18 Ê≤≥ÂçóÁúÅ‚Ä¶ 410102‚Ä¶ 01    39    2    \n2 184101001562256 ÁéãÂÜç‚Ä¶ 5106‚Ä¶ 1     1935-05-15 Ê≤≥ÂçóÁúÅ‚Ä¶ 410102‚Ä¶ 01    80    2    \n3 184101001120018 Âº†ÁßÄ‚Ä¶ 4101‚Ä¶ 2     1941-02-16 ÈÉëÂ∑ûÂ∏Ç‚Ä¶ 410102‚Ä¶ 01    29    2    \n4 184101001561642 ÊùéÈïø‚Ä¶ 4101‚Ä¶ 1     1952-07-06 Ê≤≥ÂçóÁúÅ‚Ä¶ 410102‚Ä¶ 01    90    2    \n5 184101021600573 Ëë£Âª∫‚Ä¶ 4101‚Ä¶ 1     1947-08-21 Ê≤≥ÂçóÁúÅ‚Ä¶ 410102‚Ä¶ 01    85    2    \n6 184101001119830 Â≠ôÂØå‚Ä¶ 4101‚Ä¶ 1     1941-08-16 Ê≤≥ÂçóÁúÅ‚Ä¶ 410102‚Ä¶ 01    29    2    \n# ‚Ñπ 13 more variables: inciden <date>, topo <chr>, morp <chr>, beha <chr>,\n#   grad <chr>, basi <chr>, icd10 <chr>, autoicd10 <chr>, lastcontact <dttm>,\n#   status <chr>, caus <chr>, deathda <date>, deadplace <chr>\n```\n\n\n:::\n:::\n\n\n\n\n## canreg object with class of 'canreg' {.smaller}\n\n> 'canreg' is a list contains four elements including 'areacode', 'FBcases', 'SWcases', and 'POP'\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnames(data)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"areacode\" \"FBcases\"  \"SWcases\"  \"POP\"     \n```\n\n\n:::\n\n```{.r .cell-code}\nhead(data$POP)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 √ó 4\n   year   sex agegrp   rks\n  <int> <int> <fct>  <int>\n1  2021     1 0~      3850\n2  2021     1 1~     14405\n3  2021     1 5~     15176\n4  2021     1 10~    16227\n5  2021     1 15~    18685\n6  2021     1 20~    27799\n```\n\n\n:::\n:::\n\n\n\n\n## Counting 'canreg' data to 'fbswicd' data {.smaller}\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfbsw <- count_canreg(data, cancer_type = \"big\")\nclass(fbsw)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"fbswicd\" \"list\"   \n```\n\n\n:::\n\n```{.r .cell-code}\nnames(fbsw)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"areacode\" \"fbswicd\"  \"sitemorp\" \"pop\"     \n```\n\n\n:::\n\n```{.r .cell-code}\nhead(fbsw$fbswicd, 2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n    year   sex agegrp cancer   fbs   sws    mv    ub   sub m8000   dco\n   <int> <int> <fctr>  <int> <int> <int> <int> <int> <int> <int> <int>\n1:  2021     1   0 Â≤Å      0     0     0     0     0     0     0     0\n2:  2021     1   0 Â≤Å     60     3     0     2     1     1     1     0\n```\n\n\n:::\n\n```{.r .cell-code}\nhead(fbsw$sitemorp,2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n    year   sex cancer               site              morp\n   <int> <int>  <int>             <list>            <list>\n1:  2021     1     NA <data.frame[15x2]> <data.frame[8x2]>\n2:  2021     2    115  <data.frame[3x2]> <data.frame[9x2]>\n```\n\n\n:::\n\n```{.r .cell-code}\nhead(fbsw$pop,2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n    year   sex agegrp   rks\n   <int> <int> <fctr> <int>\n1:  2021     1   0 Â≤Å  3850\n2:  2021     1 1-4 Â≤Å 14405\n```\n\n\n:::\n:::\n\n\n\n\n## Summary the canreg data {.smaller}\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsumm <- summary(data)\nclass(summ)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"summary\" \"list\"   \n```\n\n\n:::\n\n```{.r .cell-code}\nnames(summ)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] \"areacode\"         \"fbs\"              \"inci\"             \"sws\"             \n [5] \"mort\"             \"mi\"               \"rks\"              \"rks_year\"        \n [9] \"inci_vars\"        \"miss_r_vars_inci\" \"mort_vars\"        \"miss_r_vars_mort\"\n```\n\n\n:::\n\n```{.r .cell-code}\npurrr::pluck(summ, \"mi\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.3805414\n```\n\n\n:::\n:::\n\n\n\n## Creating age standard rate {.smaller}\n\n\n::: {.cell}\n\n```{.r .cell-code}\nasr <- create_asr(fbsw, event = fbs, year, sex, cancer)\nasr\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 58 √ó 11\n    year   sex cancer no_cases     cr asr_cn2000 asr_wld85 truncr_cn2000\n   <int> <int>  <int>    <int>  <dbl>      <dbl>     <dbl>         <dbl>\n 1  2021     1      0       18   5.50       4.56      4.06          6.91\n 2  2021     1     60     1087 332.       275.      273.          430.  \n 3  2021     1     61     1068 326.       270.      269.          424.  \n 4  2021     1    101       18   5.50       4.65      4.91         10.4 \n 5  2021     1    102        5   1.53       1.23      1.45          2.63\n 6  2021     1    103       47  14.4       10.8      10.3          11.2 \n 7  2021     1    104       65  19.9       15.6      16.1          21.9 \n 8  2021     1    105       87  26.6       21.2      21.7          33.8 \n 9  2021     1    106       84  25.7       20.9      21.7          38.0 \n10  2021     1    107       21   6.41       5.19      5.57          9.84\n# ‚Ñπ 48 more rows\n# ‚Ñπ 3 more variables: truncr_wld85 <dbl>, cumur <dbl>, prop <dbl>\n```\n\n\n:::\n:::\n\n\n\n## Creating age standard rate  {.smaller}\n\n\n::: {.cell}\n\n```{.r .cell-code}\nasr <- create_asr(fbsw, event = fbs, year, sex, cancer)\nasr |> add_labels(lang = \"en\", label_type = \"abbr\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 58 √ó 13\n    year sex   cancer site            icd10 no_cases     cr asr_cn2000 asr_wld85\n   <int> <fct>  <int> <fct>           <fct>    <int>  <dbl>      <dbl>     <dbl>\n 1  2021 Male       0 <NA>            <NA>        18   5.50       4.56      4.06\n 2  2021 Male      60 All Cancers     ALL       1087 332.       275.      273.  \n 3  2021 Male      61 All Cancers ex‚Ä¶ ALLb‚Ä¶     1068 326.       270.      269.  \n 4  2021 Male     101 Oral Cavity & ‚Ä¶ C00-‚Ä¶       18   5.50       4.65      4.91\n 5  2021 Male     102 Nasopharynx     C11          5   1.53       1.23      1.45\n 6  2021 Male     103 Esophagus       C15         47  14.4       10.8      10.3 \n 7  2021 Male     104 Stomach         C16         65  19.9       15.6      16.1 \n 8  2021 Male     105 Colorectum      C18-‚Ä¶       87  26.6       21.2      21.7 \n 9  2021 Male     106 Liver           C22         84  25.7       20.9      21.7 \n10  2021 Male     107 Gallbladder     C23-‚Ä¶       21   6.41       5.19      5.57\n# ‚Ñπ 48 more rows\n# ‚Ñπ 4 more variables: truncr_cn2000 <dbl>, truncr_wld85 <dbl>, cumur <dbl>,\n#   prop <dbl>\n```\n\n\n:::\n:::\n\n\n\n## Creating quality indicators {.smaller}\n\n\n::: {.cell}\n\n```{.r .cell-code}\nquality <- create_quality(fbsw, year, sex, cancer)\nquality\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 58 √ó 14\n    year   sex cancer    rks   fbs    fbl   sws    swl    mi    mv   dco    ub\n   <int> <int>  <int>  <int> <int>  <dbl> <int>  <dbl> <dbl> <dbl> <dbl> <dbl>\n 1  2021     1      0 327403    18   5.5      1   0.31  0.06  61.1  0     0   \n 2  2021     1     60 327403  1087 332.     560 171.    0.52  76.5  1.47  1.75\n 3  2021     1     61 327403  1068 326.     554 169.    0.52  76.3  1.5   1.78\n 4  2021     1    101 327403    18   5.5     10   3.05  0.56  55.6  0     0   \n 5  2021     1    102 327403     5   1.53     4   1.22  0.8   40    0     0   \n 6  2021     1    103 327403    47  14.4     35  10.7   0.74  87.2  2.13  0   \n 7  2021     1    104 327403    65  19.8     55  16.8   0.85  73.8  1.54  0   \n 8  2021     1    105 327403    87  26.6     55  16.8   0.63  77.0  2.3   0   \n 9  2021     1    106 327403    84  25.7     77  23.5   0.92  66.7  4.76  0   \n10  2021     1    107 327403    21   6.41    16   4.89  0.76  85.7  0     0   \n# ‚Ñπ 48 more rows\n# ‚Ñπ 2 more variables: sub <dbl>, m8000 <dbl>\n```\n\n\n:::\n:::\n\n\n\n## Creating age specific rate  {.smaller}\n\n\n::: {.cell}\n\n```{.r .cell-code}\nagerate <- create_age_rate(fbsw, year, sex, cancer)\nagerate\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1,102 √ó 6\n    year   sex cancer agegrp   cases  rate\n   <int> <int>  <int> <fct>    <int> <dbl>\n 1  2021     1      0 0 Â≤Å         0  0   \n 2  2021     1      0 1-4 Â≤Å       0  0   \n 3  2021     1      0 10-14 Â≤Å     0  0   \n 4  2021     1      0 15-19 Â≤Å     0  0   \n 5  2021     1      0 20-24 Â≤Å     0  0   \n 6  2021     1      0 25-29 Â≤Å     0  0   \n 7  2021     1      0 30-34 Â≤Å     1  3.41\n 8  2021     1      0 35-39 Â≤Å     2  6.70\n 9  2021     1      0 40-44 Â≤Å     0  0   \n10  2021     1      0 45-49 Â≤Å     2  7.50\n# ‚Ñπ 1,092 more rows\n```\n\n\n:::\n:::\n\n\n\n\n## Creating age specific rate {.smaller}\n\n\n::: {.cell}\n\n```{.r .cell-code}\nagerate <- create_age_rate(fbsw, year, sex, cancer, format = \"wide\")\nagerate |> add_labels(lang = \"en\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 58 √ó 45\n    year sex   cancer site       icd10    f0    f1    f2    f3    f4    f5    f6\n   <int> <fct>  <int> <fct>      <fct> <int> <int> <int> <int> <int> <int> <int>\n 1  2021 Male       0 <NA>       <NA>     18     0     0     0     0     0     0\n 2  2021 Male      60 All Cance‚Ä¶ ALL    1087     3     3     0     2     5    14\n 3  2021 Male      61 All Cance‚Ä¶ ALLb‚Ä¶  1068     3     3     0     2     5    14\n 4  2021 Male     101 Oral Cavi‚Ä¶ C00-‚Ä¶    18     0     0     0     0     0     0\n 5  2021 Male     102 Nasophary‚Ä¶ C11       5     0     0     0     0     0     0\n 6  2021 Male     103 Esophagus  C15      47     0     0     0     0     0     0\n 7  2021 Male     104 Stomach    C16      65     0     0     0     0     0     0\n 8  2021 Male     105 Conlon, R‚Ä¶ C18-‚Ä¶    87     0     0     0     0     0     1\n 9  2021 Male     106 Liver      C22      84     0     1     0     0     0     0\n10  2021 Male     107 Gallbladd‚Ä¶ C23-‚Ä¶    21     0     0     0     0     0     0\n# ‚Ñπ 48 more rows\n# ‚Ñπ 33 more variables: f7 <int>, f8 <int>, f9 <int>, f10 <int>, f11 <int>,\n#   f12 <int>, f13 <int>, f14 <int>, f15 <int>, f16 <int>, f17 <int>,\n#   f18 <int>, f19 <int>, r0 <dbl>, r1 <dbl>, r2 <dbl>, r3 <dbl>, r4 <dbl>,\n#   r5 <dbl>, r6 <dbl>, r7 <dbl>, r8 <dbl>, r9 <dbl>, r10 <dbl>, r11 <dbl>,\n#   r12 <dbl>, r13 <dbl>, r14 <dbl>, r15 <dbl>, r16 <dbl>, r17 <dbl>,\n#   r18 <dbl>, r19 <dbl>\n```\n\n\n:::\n:::\n\n\n\n\n# Batch mode\n## Reading data\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfiles <- list.files(\"~/website/slides/outputs\", full.names = TRUE)\ndata <- read_canreg(files[1:10])\nclass(data)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"canregs\" \"list\"   \n```\n\n\n:::\n\n```{.r .cell-code}\nnames(data)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] \"410102\" \"410103\" \"410104\" \"410105\" \"410123\" \"410185\" \"410224\" \"410302\"\n [9] \"410303\" \"410304\"\n```\n\n\n:::\n:::\n\n\n\n## Summary the canregs data {.smaller}\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsumm <- summary(data)\nnames(summ)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] \"410102\" \"410103\" \"410104\" \"410105\" \"410123\" \"410185\" \"410224\" \"410302\"\n [9] \"410303\" \"410304\"\n```\n\n\n:::\n\n```{.r .cell-code}\nsumm1 <- cr_select(summ, inci>300, mi>0.4)\nnames(summ1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"410302\" \"410303\" \"410304\"\n```\n\n\n:::\n\n```{.r .cell-code}\nsumm2 <- cr_select(summ, inci>290|mort>150)\nnames(summ2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"410102\" \"410103\" \"410104\" \"410105\" \"410302\" \"410303\" \"410304\"\n```\n\n\n:::\n\n```{.r .cell-code}\nsumm3 <- cr_select(summ, index = c(\"410102\", \"410303\"))\nnames(summ3)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"410102\" \"410303\"\n```\n\n\n:::\n:::\n\n\n\n## Filter the canregs data\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata2 <- data |> cr_select(index = names(summ2))\nnames(data2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"410102\" \"410103\" \"410104\" \"410105\" \"410302\" \"410303\" \"410304\"\n```\n\n\n:::\n\n```{.r .cell-code}\nnames(summ2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"410102\" \"410103\" \"410104\" \"410105\" \"410302\" \"410303\" \"410304\"\n```\n\n\n:::\n:::\n\n\n\n## Counting canreg data {.smaller}\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfbsw <- count_canreg(data2)\nnames(fbsw)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"410102\" \"410103\" \"410104\" \"410105\" \"410302\" \"410303\" \"410304\"\n```\n\n\n:::\n:::\n\n\n\n\n## Creating age standard rate\n\n\n::: {.cell}\n\n```{.r .cell-code}\nasrs <- create_asr(fbsw, event = fbs, year, sex)\nhead(asrs)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$`410102`\n# A tibble: 2 √ó 11\n   year   sex cancer no_cases    cr asr_cn2000 asr_wld85 truncr_cn2000\n  <int> <int>  <dbl>    <int> <dbl>      <dbl>     <dbl>         <dbl>\n1  2021     1     60     1087  332.       275.      273.          430.\n2  2021     2     60     1462  411.       335.      315.          546.\n# ‚Ñπ 3 more variables: truncr_wld85 <dbl>, cumur <dbl>, prop <dbl>\n\n$`410103`\n# A tibble: 2 √ó 11\n   year   sex cancer no_cases    cr asr_cn2000 asr_wld85 truncr_cn2000\n  <int> <int>  <dbl>    <int> <dbl>      <dbl>     <dbl>         <dbl>\n1  2021     1     60     1236  376.       256.      248.          380.\n2  2021     2     60     1564  436.       319.      297.          526.\n# ‚Ñπ 3 more variables: truncr_wld85 <dbl>, cumur <dbl>, prop <dbl>\n\n$`410104`\n# A tibble: 2 √ó 11\n   year   sex cancer no_cases    cr asr_cn2000 asr_wld85 truncr_cn2000\n  <int> <int>  <dbl>    <int> <dbl>      <dbl>     <dbl>         <dbl>\n1  2021     1     60      743  327.       254.      249.          385.\n2  2021     2     60      912  360.       299.      280.          490.\n# ‚Ñπ 3 more variables: truncr_wld85 <dbl>, cumur <dbl>, prop <dbl>\n\n$`410105`\n# A tibble: 2 √ó 11\n   year   sex cancer no_cases    cr asr_cn2000 asr_wld85 truncr_cn2000\n  <int> <int>  <dbl>    <int> <dbl>      <dbl>     <dbl>         <dbl>\n1  2021     1     60     1877  406.       300.      286.          415.\n2  2021     2     60     2506  495.       380.      350.          604.\n# ‚Ñπ 3 more variables: truncr_wld85 <dbl>, cumur <dbl>, prop <dbl>\n\n$`410302`\n# A tibble: 2 √ó 11\n   year   sex cancer no_cases    cr asr_cn2000 asr_wld85 truncr_cn2000\n  <int> <int>  <dbl>    <int> <dbl>      <dbl>     <dbl>         <dbl>\n1  2021     1     60      298  359.       235.      231.          342.\n2  2021     2     60      278  322.       199.      190.          331.\n# ‚Ñπ 3 more variables: truncr_wld85 <dbl>, cumur <dbl>, prop <dbl>\n\n$`410303`\n# A tibble: 2 √ó 11\n   year   sex cancer no_cases    cr asr_cn2000 asr_wld85 truncr_cn2000\n  <int> <int>  <dbl>    <int> <dbl>      <dbl>     <dbl>         <dbl>\n1  2021     1     60      625  383.       280.      311.          275.\n2  2021     2     60      599  370.       235.      226.          335.\n# ‚Ñπ 3 more variables: truncr_wld85 <dbl>, cumur <dbl>, prop <dbl>\n```\n\n\n:::\n:::\n\n\n\n## Merge age standard rate(asrs)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nasrs2 <- asrs |> cr_merge()\nhead(asrs2,c(6,8))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 √ó 8\n  areacode  year   sex cancer no_cases    cr asr_cn2000 asr_wld85\n     <int> <int> <int>  <dbl>    <int> <dbl>      <dbl>     <dbl>\n1   410102  2021     1     60     1087  332.       275.      273.\n2   410102  2021     2     60     1462  411.       335.      315.\n3   410103  2021     1     60     1236  376.       256.      248.\n4   410103  2021     2     60     1564  436.       319.      297.\n5   410104  2021     1     60      743  327.       254.      249.\n6   410104  2021     2     60      912  360.       299.      280.\n```\n\n\n:::\n\n```{.r .cell-code}\nnames(asrs2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] \"areacode\"      \"year\"          \"sex\"           \"cancer\"       \n [5] \"no_cases\"      \"cr\"            \"asr_cn2000\"    \"asr_wld85\"    \n [9] \"truncr_cn2000\" \"truncr_wld85\"  \"cumur\"         \"prop\"         \n```\n\n\n:::\n:::\n\n\n\n## Creating quality indicators\n\n\n::: {.cell}\n\n```{.r .cell-code}\nqualities <- create_quality(fbsw, year, sex, collapse=F)\nqualities\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$`410102`\n# A tibble: 2 √ó 14\n   year   sex cancer    rks   fbs   fbl   sws   swl    mi    mv   dco    ub\n  <int> <int>  <dbl>  <int> <int> <dbl> <int> <dbl> <dbl> <dbl> <dbl> <dbl>\n1  2021     1     60 327403  1087  332.   560  171.  0.52  76.5  1.47  1.75\n2  2021     2     60 355707  1462  411.   410  115.  0.28  84.1  0.82  1.92\n# ‚Ñπ 2 more variables: sub <dbl>, m8000 <dbl>\n\n$`410103`\n# A tibble: 2 √ó 14\n   year   sex cancer    rks   fbs   fbl   sws   swl    mi    mv   dco    ub\n  <int> <int>  <dbl>  <int> <int> <dbl> <int> <dbl> <dbl> <dbl> <dbl> <dbl>\n1  2021     1     60 328415  1236  376.   676  206.  0.55  73.1  0.65  2.1 \n2  2021     2     60 358941  1564  436.   410  114.  0.26  76.6  1.02  1.98\n# ‚Ñπ 2 more variables: sub <dbl>, m8000 <dbl>\n\n$`410104`\n# A tibble: 2 √ó 14\n   year   sex cancer    rks   fbs   fbl   sws   swl    mi    mv   dco    ub\n  <int> <int>  <dbl>  <int> <int> <dbl> <int> <dbl> <dbl> <dbl> <dbl> <dbl>\n1  2021     1     60 227511   743  327.   371 163.   0.5   81.4  0.54  1.75\n2  2021     2     60 253077   912  360.   252  99.6  0.28  81.5  0.33  1.21\n# ‚Ñπ 2 more variables: sub <dbl>, m8000 <dbl>\n\n$`410105`\n# A tibble: 2 √ó 14\n   year   sex cancer    rks   fbs   fbl   sws   swl    mi    mv   dco    ub\n  <int> <int>  <dbl>  <int> <int> <dbl> <int> <dbl> <dbl> <dbl> <dbl> <dbl>\n1  2021     1     60 462738  1877  406.   793  171.  0.42  76.9  0.69  1.55\n2  2021     2     60 506456  2506  495.   555  110.  0.22  79.6  0.2   1.52\n# ‚Ñπ 2 more variables: sub <dbl>, m8000 <dbl>\n\n$`410302`\n# A tibble: 2 √ó 14\n   year   sex cancer   rks   fbs   fbl   sws   swl    mi    mv   dco    ub   sub\n  <int> <int>  <dbl> <int> <int> <dbl> <int> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl>\n1  2021     1     60 83010   298  359.   157  189.  0.53  69.8  0     1.01  63.8\n2  2021     2     60 86359   278  322.   105  122.  0.38  74.1  0.72  0.72  70.5\n# ‚Ñπ 1 more variable: m8000 <dbl>\n\n$`410303`\n# A tibble: 2 √ó 14\n   year   sex cancer    rks   fbs   fbl   sws   swl    mi    mv   dco    ub\n  <int> <int>  <dbl>  <int> <int> <dbl> <int> <dbl> <dbl> <dbl> <dbl> <dbl>\n1  2021     1     60 163005   625  383.   412  253.  0.66  76.8  1.12  0.96\n2  2021     2     60 161724   599  370.   252  156.  0.42  84.5  1.5   2.5 \n# ‚Ñπ 2 more variables: sub <dbl>, m8000 <dbl>\n\n$`410304`\n# A tibble: 2 √ó 14\n   year   sex cancer    rks   fbs   fbl   sws   swl    mi    mv   dco    ub\n  <int> <int>  <dbl>  <int> <int> <dbl> <int> <dbl> <dbl> <dbl> <dbl> <dbl>\n1  2021     1     60  99735   441  442.   242  243.  0.55  72.3  2.72  2.72\n2  2021     2     60 100963   359  356.   152  151.  0.42  79.4  2.51  1.11\n# ‚Ñπ 2 more variables: sub <dbl>, m8000 <dbl>\n\nattr(,\"class\")\n[1] \"qualities\" \"list\"     \n```\n\n\n:::\n:::\n\n\n\n## Merge quality indicators\n\n\n::: {.cell}\n\n```{.r .cell-code}\nqualities2 <- qualities |> cr_merge()\nhead(qualities2,c(6,12))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 √ó 12\n  areacode  year   sex cancer    rks   fbs   fbl   sws   swl    mi    mv   dco\n     <int> <int> <int>  <dbl>  <int> <int> <dbl> <int> <dbl> <dbl> <dbl> <dbl>\n1   410102  2021     1     60 327403  1087  332.   560 171.   0.52  76.5  1.47\n2   410102  2021     2     60 355707  1462  411.   410 115.   0.28  84.1  0.82\n3   410103  2021     1     60 328415  1236  376.   676 206.   0.55  73.1  0.65\n4   410103  2021     2     60 358941  1564  436.   410 114.   0.26  76.6  1.02\n5   410104  2021     1     60 227511   743  327.   371 163.   0.5   81.4  0.54\n6   410104  2021     2     60 253077   912  360.   252  99.6  0.28  81.5  0.33\n```\n\n\n:::\n\n```{.r .cell-code}\nnames(qualities2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] \"areacode\" \"year\"     \"sex\"      \"cancer\"   \"rks\"      \"fbs\"     \n [7] \"fbl\"      \"sws\"      \"swl\"      \"mi\"       \"mv\"       \"dco\"     \n[13] \"ub\"       \"sub\"      \"m8000\"   \n```\n\n\n:::\n:::\n\n\n\n# Reframe fbsws\n## Reframe fbsws\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata <- read_canreg(files[1:10])\nfbsws <- count_canreg(data)\nclass(fbsws)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"fbswicds\" \"list\"    \n```\n\n\n:::\n\n```{.r .cell-code}\nnames(fbsws)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] \"410102\" \"410103\" \"410104\" \"410105\" \"410123\" \"410185\" \"410224\" \"410302\"\n [9] \"410303\" \"410304\"\n```\n\n\n:::\n\n```{.r .cell-code}\nfbsw <- reframe_fbswicd(fbsws, area_type)\nclass(fbsw)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"fbswicd\" \"list\"   \n```\n\n\n:::\n:::\n\n\n\n## Ceating asr based on reframed fbsws\n\n\n::: {.cell}\n\n```{.r .cell-code}\nasr <- create_asr(fbsw, area_type, sex)\nhead(asr, c(6, 8))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 4 √ó 8\n   year   sex cancer area_type no_cases    cr asr_cn2000 asr_wld85\n  <dbl> <int>  <dbl> <fct>        <int> <dbl>      <dbl>     <dbl>\n1  9000     1     60 ÂüéÂ∏Ç          6307  373.       264.      257.\n2  9000     2     60 ÂüéÂ∏Ç          7680  421.       312.      290.\n3  9000     1     60 ÂÜúÊùë          2704  235.       176.      171.\n4  9000     2     60 ÂÜúÊùë          2936  265.       200.      187.\n```\n\n\n:::\n\n```{.r .cell-code}\nnames(asr)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] \"year\"          \"sex\"           \"cancer\"        \"area_type\"    \n [5] \"no_cases\"      \"cr\"            \"asr_cn2000\"    \"asr_wld85\"    \n [9] \"truncr_cn2000\" \"truncr_wld85\"  \"cumur\"         \"prop\"         \n```\n\n\n:::\n:::\n\n\n\n# Visualization\n## Draw pyramid plot\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(showtext)\nshowtext_auto()\ndata <- read_canreg(files[10])\nfbsw <- count_canreg(data)\ndraw_pyramid(fbsw, show_value = F)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-revealjs/unnamed-chunk-22-1.png){width=960}\n:::\n:::\n\n\n\n## Draw bar chart {.smaller}\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nasr <- create_asr(fbsw,year,sex,cancer) |> drop_total() |>\n  drop_others() |> add_labels(label_type = \"abbr\", lang = \"en\")\ndraw_barchart(asr, plot_var =cr, cate_var = site,\n              side_label = c(\"Male\",\"Female\"))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-revealjs/unnamed-chunk-23-1.png){width=960}\n:::\n:::\n\n\n\n\n## Draw bar chart {.smaller}\n\n\n\n::: {.cell .fig-column-page-right}\n\n```{.r .cell-code}\nlibrary(dplyr)\nasr1 <- create_asr(fbsw,year,sex,cancer,event = fbs) |> mutate(type=\"incidence\")\nasr2 <- create_asr(fbsw,year,sex,cancer,event = sws) |> mutate(type=\"mortality\")\nasr <- bind_rows(asr1, asr2) |> drop_others() |> drop_total() |> \n  add_labels(label_type = \"abbr\",lang = \"en\")\ndraw_barchart(asr, plot_var =cr, cate_var = site,group_var = type,\n              side_label = c(\"Male\",\"Female\"))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-revealjs/unnamed-chunk-24-1.png){width=960}\n:::\n:::\n\n\n\n\n## Draw line chart {.smaller}\n\n\n\n::: {.cell .fig-column-page-right}\n\n```{.r .cell-code}\nagerate <- create_age_rate(fbsw,sex) |> add_labels(lang=\"en\")\nnames(agerate)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"year\"   \"sex\"    \"cancer\" \"site\"   \"icd10\"  \"agegrp\" \"cases\"  \"rate\"  \n```\n\n\n:::\n\n```{.r .cell-code}\ndraw_line(agerate, agegrp, rate, sex)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-revealjs/unnamed-chunk-25-1.png){width=960}\n:::\n:::\n",
    "supporting": [
      "index_files/figure-revealjs"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}