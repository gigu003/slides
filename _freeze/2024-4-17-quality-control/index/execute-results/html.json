{
  "hash": "09febb4dbfa2014df0088206cb9764d0",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"质量控制和自动化报告\"\nsubtitle: \"质量控制-报告撰写\"\nauthor: \"陈琼\"\ndate: 2024-4-17\ndate-format: \"dddd MMM D, YYYY\"\naddress: \"安徽泾县\"\ncategories:\n  - 肿瘤登记\nformat:\n  revealjs:\n    #theme: [custom1.scss]\n    slide-number: true\n    scrollable: false\n    sc-sb-title: h1\n    footer: \"从质量控制到报告撰写\"\nrevealjs-plugins:\n  - attribution\nfilters:\n   - roughnotation\n   - reveal-header\n   - reveal-auto-agenda\nauto-agenda:\n  bullets: numbered\n  heading: 主要内容\nslide-level: 2\ntitle-slide-style: pandoc\ntitle-slide-attributes:\n  data-background-color: \"lightblue\"\n---\n\n\n# 质量控制应该怎么做?{background=\"lightblue\"}\n\n## Why ?\n\n> 确保肿瘤登记准确、完整、可靠, 从而为癌症防控、科学研究、医疗质量评估等提供真实、完整、有效、具有科学价值的基础数据。\n\n-   [肿瘤登记的质量控制是获取高质量数据的核心]{.important}\n\n-   使不同地区之间的数据具有可比性\n\n-   代表登记处所在地区的癌症人群\n\n-   使癌症数据真实有效\n\n## 个体水平的质控-内部一致性 {.smaller}\n\n> 肿瘤登记收集的变量或者变量组合之间存在一定的逻辑关系，通过对单个变量或变量组合之间的逻辑关系进行审查，以提高肿瘤登记数据有效性。\n\n::: columns\n::: {.column width=\"40%\"}\n::: callout-tip\n## 单个项目\n\n-   出生日期\n-   发病日期\n-   年龄、性别\n-   发病部位\n-   形态学\n-   行为和分级\n:::\n:::\n\n::: {.column width=\"40%\"}\n::: callout-important\n## 项目组合\n\n-   性别/部位\n-   部位/组织学\n-   年龄/部位/组织学\n-   行为/部位\n-   行为/组织学\n-   性别/组织学\n:::\n:::\n\n::: {.column width=\"20%\"}\n::: callout-caution\n## 校验结果\n\n-   正确✅\n-   警告⚠️\n-   错误❌\n:::\n:::\n:::\n\n\n## 逻辑核查-iarccrgtools{.smaller}\n\n:::{.columns} \n:::{.column width='60%'}\n- IARC/IACR CHECK Program--iarccrgtools^[Check and conversion programs for cancer registries (IARC/IACR Tools for Cancer Registries) J.Ferlay, C. Burkhard, S.Whelon, D.M. Parkin IARC Technical Report No. 42 Lyon, 2005]\n- R包: iarccrgtools [FinnishCancerRegistry\n/ iarccrgtools](https://github.com/FinnishCancerRegistry/iarccrgtools)\n\n```r\ndevtools::install_github(\n  \"FinnishCancerRegistry/iarccrgtools\",\n  ref = readline(\"enter latest tag on github: \")\n)\n```\n\n:::\n\n:::{.column width='40%'}\n::: {layout-ncol=1}\n![iarccrgtools](https://cdn.jsdelivr.net/gh/gigu003/db/images/iarc-tools.jpg){width=\"80%\" .lightbox}\n\n![R package](https://cdn.jsdelivr.net/gh/gigu003/db/images/iarc-r.jpg){width=\"80%\" .lightbox}\n:::\n\n:::\n:::\n\n\n## 质量控制指标体系{.smaller}\n\n> 可比性、有效性、时效性[^1]和完整性是当前肿瘤登记质量控制的主要指标[^2]\n\n::: columns\n::: {.column width=\"30%\"}\n\n```{mermaid}\nflowchart LR\n  B(可比性) --> b1(发病日期的定义)\n  B --> b2(多原发判断)\n  B --> b3(分类与编码)\n  B --> b4(死亡证明)\n```\n\n:::\n::: {.column width=\"30%\"}\n\n```{mermaid}\nflowchart LR\n  D(有效性) --> d1(组织学确诊比例)\n  D --> d2(只有死亡医学证明书比例)\n  D --> d3(部位不明比例)\n  D --> d4(数据内部一致性)\n```\n\n:::\n::: {.column width=\"40%\"}\n\n```{mermaid}\nflowchart LR\n  C(完整性) --> c1(死亡发病比)\n  C --> c3(组织学确诊比例)\n  C --> c4(不同时间发病率的稳定性)\n  C --> c5(年龄别发病率曲线)\n```\n\n:::\n:::\n\n[^1]:Bray, F. and Parkin, D.M. (2009) ‘Evaluation of data quality in the cancer registry: Principles and methods. part I: Comparability, validity and timeliness’, European Journal of Cancer, 45(5), pp. 747–755.\n\n[^2]:Parkin, D.M. and Bray, F. (2009) ‘Evaluation of data quality in the cancer registry: Principles and methods part II. completeness’, European Journal of Cancer, 45(5), pp. 756–764.\n\n\n## 可比性 - 发病时间的定义{.smaller}\n\n\n:::{.columns}\n\n:::{.column width=\"40%\"}\n> 癌症的发生是一个可能需要数十年的过程，而发病日期的定义则相对武断,因此,遵循统一的标准特别重要.\n\n- 应选择七个列出的事件中按时间顺序首先发生的日期作为发病日期。\n- 如果优先级较高的事件在最初选择的日期之后三个月内发生，则应优先考虑优先级较高事件的日期。\n:::\n\n:::{.column width=\"60%\"}\n![](https://cdn.jsdelivr.net/gh/gigu003/db/images/incidence-rule.jpg)\n:::\n:::\n\n\n::: aside\nSource：ENCR Recommendation ▪ Coding Incidence Date ▪ 2022 [https://encr.eu/sites/default/files/Recommendations/ENCR%20Recommendation%20DOI_Mar2022_0.pdf](https://encr.eu/sites/default/files/Recommendations/ENCR%20Recommendation%20DOI_Mar2022_0.pdf)\n:::\n\n## 可比性 - 分类与编码\n\n::: columns\n::: {.column width=\"50%\"}\n> 肿瘤登记采用**双编码系统**\n\n#### 分类标准\n\n-   ICD-O-3 ：数据收集\n-   ICD10 ：统计分析\n\n> 《肿瘤登记年报》采用ICD10进行肿瘤分类（@tbl-category）\n:::\n\n::: {.column width=\"50%\"}\n\n::: {#tbl-category .cell tbl-cap='常用癌症分类统计表（大类）'}\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table\" style=\"font-size: 10px; margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> 部位 </th>\n   <th style=\"text-align:left;\"> ICD10 </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> 口腔和咽 (除外鼻咽癌和喉) </td>\n   <td style=\"text-align:left;\"> C00-10,C12-14（除外C10.1） </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 鼻咽癌 </td>\n   <td style=\"text-align:left;\"> C11 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 食管 </td>\n   <td style=\"text-align:left;\"> C15 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 胃 </td>\n   <td style=\"text-align:left;\"> C16 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 结直肠肛门 </td>\n   <td style=\"text-align:left;\"> C18-21 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 肝脏 </td>\n   <td style=\"text-align:left;\"> C22 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 胆囊及其他 </td>\n   <td style=\"text-align:left;\"> C23-C24 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 胰腺 </td>\n   <td style=\"text-align:left;\"> C25 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 喉 </td>\n   <td style=\"text-align:left;\"> C32，C10.1 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 气管、支气管、肺 </td>\n   <td style=\"text-align:left;\"> C33-C34 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 骨 </td>\n   <td style=\"text-align:left;\"> C40-C41 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 乳房 </td>\n   <td style=\"text-align:left;\"> C50 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 子宫颈 </td>\n   <td style=\"text-align:left;\"> C53 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 子宫体及子宫部位不明 </td>\n   <td style=\"text-align:left;\"> C54-55 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 卵巢 </td>\n   <td style=\"text-align:left;\"> C56 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 前列腺 </td>\n   <td style=\"text-align:left;\"> C61 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 睾丸 </td>\n   <td style=\"text-align:left;\"> C62 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 肾及泌尿系统不明 </td>\n   <td style=\"text-align:left;\"> C64-66，68 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 膀胱 </td>\n   <td style=\"text-align:left;\"> C67 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 脑,神经系统 </td>\n   <td style=\"text-align:left;\"> C70-C72 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 甲状腺 </td>\n   <td style=\"text-align:left;\"> C73 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 淋巴瘤 </td>\n   <td style=\"text-align:left;\"> C81-85,88,90,96 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 白血病 </td>\n   <td style=\"text-align:left;\"> C91-C95 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 其它 </td>\n   <td style=\"text-align:left;\"> Other（除外以上） </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 所有部位合计 </td>\n   <td style=\"text-align:left;\"> ALL </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n:::\n:::\n\n## 可比性-多原发肿瘤 {.smaller}\n\n> 个体有发生一个以上癌症的可能，多部位原发癌纪录为新发病病例，与登记地区医疗水平有关，也与登记质量有关，登记处应注意多部位原发肿瘤病例资料的收集\n\n<br>\n\n-   北美地区采取了与全球其他地区不同的多元发判断规则\n-   SEER: <https://seer.cancer.gov/tools/mphrules/>[^3]\n-   IARC/ENUR: <https://www.encr.eu/sites/default/files/pdf/MPrules_july2004.pdf>[^4]\n\n[^3]: A review of the definition for multiple primary cancers in the United States. http://prdupl02.ynet.co.il/ forumfiles_2/ 19207389.pdf.\n\n[^4]: Working Group R. International rules for multiple primary cancers (ICD-0 third edition) Eur J Cancer Prev. 2005;14(4):307–308.\n\n## 可比性-IACR多原发癌规则 {.smaller}\n> 全球大部分地区采取了IARC的多原发癌判断规则\n\n::: columns\n::: {.column width=\"60%\"}\n\n<br>\n\n1. 两个或以上多原发癌的判断**不依赖时间**\n1. 每个原发癌起源一个原发部位或组织(非扩散、复发或转移)\n1. 肿瘤起源于在同一个或一对器官或组织时认为是一个肿瘤\n   1. 部分成组部位码认为是一个器官\n   1. 多灶肿瘤认为是一个肿瘤\n:::\n\n::: {.column width=\"40%\"}\n| ICDO3-Topo              | Site  |\n|-------------------------|-------|\n| C01, C02                | C02.9 |\n| C00, C03, C04, C05, C06 | C06.9 |\n| C09, C10, C12, C13, C14 | C14.0 |\n| C19, C20                | C20.9 |\n| C23, C24                | C24.9 |\n| C33, C34                | C34.9 |\n| C40, C41                | C41.9 |\n| C65, C66, C67, C68      | C68.9 |\n\n: ICDO3部位码分组\n:::\n:::\n\n\n## 可比性-IACR多原发癌规则 {.smaller}\n\n\n- 对于系统性肿瘤涉及到不同器官时,只记录一个(如Kaposi、血液造血系统肿瘤)\n- 不同的组织学应该被记录为两个或多个肿瘤^[Berg, J. W. (1982) Morphologic classification of human cancer. In: Schottenfeld, D. &\nFraumeni, J. F., Jr, eds, Cancer Epidemiology and Prevention, Philadelphia, Saunders, pp.\n74-89]\n\n![](https://cdn.jsdelivr.net/gh/gigu003/db/images/morp-group.jpg){width=70%}\n\n\n\n## 有效性-组织学确诊比例(MV%){.smaller}\n\n> MV%的绝对值可能没有意义, 只有通过与“预期值”进行比较才能除非与合理的“预期”值进行比较才有意义。\n\n<br>\n\n-   不同性别、部位MV%情况\n-   与相邻区域(区域平均值)比较\n-   与国家平均值的比较\n-   组织学确诊比例的连续性情况\n\n::: aside\n***MV%预期值***是根据登记处所在地区（医疗技术水平，当地临床实践）合理设定的。\n:::\n\n\n## 有效性-组织学确诊比例(MV%){.smaller}\n\n> 如何判断登记处的MV%与区域内的均值是否存在差异?\n\n基于二项分布, 存在 $E(y_i)=pd_i$ 和 $Var(y_i)=p(1p)d_i$, 参数可以做如下估计:\n\n:::{.columns}\n:::{.column width='40%'}\n$Z^2 = \\frac{(y_j - \\hat{p} d_j)^2}{\\hat{\\phi} \\hat{p}(1- \\hat{p}) d_j} \\approx \\chi_1^2$\n:::\n:::{.column width='30%'}\n$\\hat{p}=\\frac{\\sum_{i=1}^n y_i}{\\sum_{i=1}^n d_i}$\n:::\n:::{.column width='30%'}\n$\\hat(\\phi)=\\frac{1}{n-1}\\sum_{i=1}^n \\frac{(y_i-pd_i)^2}{d_ip(1-p)}$\n:::\n:::\n\n\n- $i$ 同一个国家或地区的不同登记处分别用i=1,...,n表示\n- $p$ 病理学诊断比例(MV%)\n- $y_i$ 登记处i的病理学诊断病例数\n- $d_i$ 登记处i的总病例数\n\n> 如果$Z^2 \\geq 3.84$ 则认为登记处MV%与区域均值存在有统计学意义的差异。\n\n## 有效性-只有死亡医学证明书比例(DCO%){.smaller}\n\n> 标记为DCO的记录指示该记录的数据质量较差，诸多信息存在缺失，比如诊断时间以死亡时间来代替，无法在生存分析时被利用。\n\n\n```{mermaid}\n%%| label: fig-dco\n%%| fig-cap: \"利用死亡证明发现肿瘤病例信息.\"\nflowchart LR\n  a(死亡证明提及癌症) --> b(与肿瘤登记数据库匹配)\n  b -->c(未登记)\n  b -->d(已登记)\n  c --> e1(从其他来源获取信息)\n  c --> e2(无其他来源)\n  e2 --> f1(未追踪到:DCO)\n  e2 --> f2(追踪到)\n  e2 --> f3(追踪到,非癌)\n```\n\n\n\n## 完整性 {auto-animate=\"true\" auto-animate-easing=\"ease-in-out\"}\n\n> 肿瘤登记收集到的癌症病人数占一定区域内所有诊断癌症病人的比例\n\n::: r-hstack\n::: {data-id=\"box1\" auto-animate-delay=\"0\" style=\"background: #2780e3; width: 200px; height: 150px; margin: 10px;\"}\n癌症患者\n:::\n\n::: {data-id=\"box2\" auto-animate-delay=\"0.1\" style=\"background: #3fb618; width: 200px; height: 150px; margin: 10px;\"}\n诊断患者\n:::\n\n::: {data-id=\"box3\" auto-animate-delay=\"0.2\" style=\"background: #e83e8c; width: 200px; height: 150px; margin: 10px;\"}\n肿瘤登记\n:::\n:::\n\n## 完整性 {auto-animate=\"true\" auto-animate-easing=\"ease-in-out\"}\n\n> 肿瘤登记收集到的癌症病人数占一定区域内所有诊断癌症病人的比例\n\n::: r-stack\n::: {data-id=\"box1\" style=\"background: #2780e3; width: 350px; height: 350px; border-radius: 200px;\"}\n癌症患者\n:::\n\n::: {data-id=\"box2\" style=\"background: #3fb618; width: 250px; height: 250px; border-radius: 200px;\"}\n诊断患者\n:::\n\n::: {data-id=\"box3\" style=\"background: #e83e8c; width: 150px; height: 150px; border-radius: 200px;\"}\n肿瘤登记\n:::\n:::\n\n## 完整性- 历史数据方法{.smaller}\n> 通过对比历史数据发病率发现异常波动,从而体现可能登记处完整性的变化。\n\n> 假设: 来自同一地区特定癌症的发病率倾向于相似。\n\n- 发病率随时间变化的稳定性\n- 比较不同人群癌症发病率\n- 年龄别发病率曲线\n- 儿童肿瘤发病率\n\n::: aside\n通过与**区域内标准值**进行比较是CI5评估数据质量的常用做法.\n:::\n\n## 完整性- 死亡发病比(M:I){.smaller}\n> M:I是反映完整的重要指标，它反映癌症生存情况，与该地区的经济、医疗等发展水平有关，当它***预期值***^[预期值通常是区域内的均值]存在差异时，往往提示完整性存在问题。\n\n$$M:I=\\frac{Mortality}{Incidence} \\approx1-5Survial$$\n\n- M:I 大于***预期值***提示完整性不足\n- M:I 小于***预期值***提示可能存在重卡\n\n::: aside\n注: 全死因数据的质量会影响M:I和完整性的关系.\n:::\n\n## 完整性-平均数据来源数\n## 完整性- 组织学确诊比例(MV%){.smaller}\n> MV%是有效性评估的指标, 但是通过与预期值比较,也可以判断其完整性,过高的MV%提示数据过度依赖病理诊断，可能存在完整性不足。\n\n<br>\n\n- 同一登记处的MV%的历史变化情况\n- MV%与预期值的比较\n- 不同癌种MV%与预期值的比较\n\n::: aside\n注：预期值可以是国家或省级的MV%均值，也可以是相似地区（城市或农村）的均值。\n:::\n\n## 完整性- 组织学确诊比例(MV%){.smaller}\n> 如何判断MV%与预期值是否存在差异？\n\n:::{.columns}\n:::{.column width='40%'}\n$Z^2 = \\frac{(m_j - \\hat{\\theta} d_j)}{\\hat{\\phi}n_j\\hat{\\theta}} \\approx \\chi_1^2$\n:::\n:::{.column width='30%'}\n$\\hat{\\theta}=\\frac{\\sum_{i=1}^n m_i}{\\sum_{i=1}^n d_i}$\n:::\n:::{.column width='30%'}\n$\\hat(\\phi)=\\frac{1}{n-1}\\sum_{i=1}^n \\frac{(m_i-\\hat{\\theta}d_i)^2}{n_i\\hat{\\theta}}$\n:::\n:::\n\n<br>\n\n- i指示不同登记处的编号, i=1,....,n\n- $d_i$登记处i的发病记录数\n- $m_i$登记处i的死亡记录数\n\n::: aside\n注：$Z^2\\geq3.84$提示差异存在统计学意义。\n:::\n\n# 可视化批量化的质控报告?{background=\"lightblue\"}\n\n## 基本理念{.smaller}\n> 通过可视化的方法,尽量简单的肿瘤登记数据中存在的问题展示出来.\n\n- 人口数据\n- 总体发病数、死亡数\n- 总体发病率、死亡率\n- 不同部位癌症发病率、死亡率\n- 年龄别发病率、死亡率\n- 癌种数\n- 病理诊断比例的时间变化和区域比较\n- 死亡发病比的时间变化和区域比较\n- 只有死亡医学证明书比例的时间变化的区域比较\n\n## 人口总数\n![](https://cdn.jsdelivr.net/gh/gigu003/db/images/quality/pop-total.jpg)\n\n## 人口比例\n![](https://cdn.jsdelivr.net/gh/gigu003/db/images/quality/pop-ratio.jpg)\n\n\n## 人口结构\n![](https://cdn.jsdelivr.net/gh/gigu003/db/images/quality/pyramid.jpg)\n\n## 人口结构\n![](https://cdn.jsdelivr.net/gh/gigu003/db/images/quality/pyramid.gif){width='80%' fig-align=\"center\"}\n\n## 癌症发病和死亡总数\n![](https://cdn.jsdelivr.net/gh/gigu003/db/images/quality/total.jpg){fig-align=\"center\"}\n\n## 总体癌症发病率\n![](https://cdn.jsdelivr.net/gh/gigu003/db/images/quality/incidence.jpg){fig-align=\"center\"}\n\n## 不同部位癌症发病率\n![](https://cdn.jsdelivr.net/gh/gigu003/db/images/quality/incidence-sites.jpg){width='75%' fig-align=\"center\"}\n\n## 年龄别癌症发病率\n![](https://cdn.jsdelivr.net/gh/gigu003/db/images/quality/incidence-age.jpg){width='75%' fig-align=\"center\"}\n\n## 总体癌症死亡率\n![](https://cdn.jsdelivr.net/gh/gigu003/db/images/quality/mortality.jpg){width='75%' fig-align=\"center\"}\n\n## 不同部位癌症死亡率\n![](https://cdn.jsdelivr.net/gh/gigu003/db/images/quality/mortality-sites.jpg){width='75%' fig-align=\"center\"}\n\n## 年龄别癌症死亡率\n![](https://cdn.jsdelivr.net/gh/gigu003/db/images/quality/mortality-age.jpg){width='75%' fig-align=\"center\"}\n\n## 儿童肿瘤发病率\n![](https://cdn.jsdelivr.net/gh/gigu003/db/images/quality/childhood-trend.jpg){width='75%' fig-align=\"center\"}\n\n## 儿童肿瘤发病率\n![](https://cdn.jsdelivr.net/gh/gigu003/db/images/quality/childhood-iarc.jpg){width='75%' fig-align=\"center\"}\n\n## 癌症种类数量\n![](https://cdn.jsdelivr.net/gh/gigu003/db/images/quality/cancers.jpg){width='75%' fig-align=\"center\"}\n\n## 病理诊断比例\n![](https://cdn.jsdelivr.net/gh/gigu003/db/images/quality/mv-trend.jpg){width='75%' fig-align=\"center\"}\n\n## 病理诊断比例\n![](https://cdn.jsdelivr.net/gh/gigu003/db/images/quality/mv-com.jpg){width='75%' fig-align=\"center\"}\n\n## 死亡发病比\n![](https://cdn.jsdelivr.net/gh/gigu003/db/images/quality/mi-trend.jpg){width='75%' fig-align=\"center\"}\n\n## 死亡发病比\n![](https://cdn.jsdelivr.net/gh/gigu003/db/images/quality/mi-com.jpg){width='75%' fig-align=\"center\"}\n\n## 只有死亡医学证明书比例\n![](https://cdn.jsdelivr.net/gh/gigu003/db/images/quality/dco-trend.jpg){width='75%' fig-align=\"center\"}\n\n## 只有死亡医学证明书比例\n![](https://cdn.jsdelivr.net/gh/gigu003/db/images/quality/dco-com.jpg){width='75%' fig-align=\"center\"}\n\n## 质量控制报告{.smaller}\n> 我们定期(每季度)生成每个登记处的质量控制报告,并发布至网络直报信息系统。\n\n- 可以通过网页、手机查看\n- 报告可以基于县级生成\n\n![](https://cdn.jsdelivr.net/gh/gigu003/db/images/quality/report.jpg){width='75%' fig-align=\"center\"}\n\n## 质量控制列表\n![](https://cdn.jsdelivr.net/gh/gigu003/db/images/quality/report-prov.jpg){width='75%' fig-align=\"center\"}\n\n## 怎么实现{.smaller}\n> 基于Rmarkdown的可重复性报告\n\n- 软件： R语言\n- R包： Rmarkdown ggplot2 cowplot tidyverse\n- 思路： 统计分析相关指标，在Rmarkdown中把相关指标可视化并制作成报告模板，基于基本模板批量生成报告。\n\n## 未来方向{.smaller}\n> 让肿瘤登记报告生成更简单, 越简单越好！！！\n\n缺点：\n\n- 程序移植性不强\n- 依赖程序包较多\n\n解决：\n\n- 工具化，比如R包\n- 市级报告模板\n- 基于单位的报告模板\n\n\n\n## Some Work in progress !!!{.smaller}\n> [canregtools 一个用于肿瘤登记数据分析、可视化和自动化报告的R包。](https://canregtools.chenq.site)\n\n<img src=\"https://cdn.jsdelivr.net/gh/gigu003/db/images/logo.png\" alt=\"canregtools\" style=\"position: absolute; top: 0; right: 0; width: 100px;\">\n\n目前实现的函数：\n\n:::{.columns}\n:::{.column width=\"34%\"}\n- read_canreg()\n- read_map()\n- clean_canreg()\n- count_canreg()\n- ageadjust()\n- create_asr()\n- create_age_rate()\n- create_quality()\n\n:::\n:::{.column width=\"33%\"}\n- cutage()\n- expand_age_pop()\n- expand_lifetable()\n- calc_age()\n- check_id()\n- classify_icd10()\n- classify_childhood()\n- tidy_address()\n- lt()\n:::\n:::{.column width=\"33%\"}\n- pyramid()\n- line_chart()\n- create_map()\n- dulbar_chart()\n- dumbbell_chart()\n- tidy_age()\n- tidy_occu()\n- tidy_sex()\n:::\n:::\n\n::: aside\n网址: https://canregtools.chenq.site\n:::\n\n# 自动化的肿瘤登记年报输出{background=\"lightblue\"}\n\n## 为什么?{.smaller}\n\n> 肿瘤登记处的主要目标之一就是产生肿瘤发病、死亡、生存相关的统计指标, 并通过一定的渠道发布数据,促进数据的共享和利用（专业人员和大众）,从而促进癌症防控政策的产生。\n\n- 了解疾病负担\n- 支持病因学研究\n- 预后研究\n- 为癌症防控政策提供基础数据\n\n\n## 肿瘤登记报告流程{.smaller}\n\n\n```{mermaid}\n%%| label: fig-report\n%%| fig-cap: 肿瘤登记报告流程\n%%| fig-align: center\nflowchart TD\n  A(数据来源单位) --> B(县区级登记处)\n  B --> C(市级登记处)\n  C --> D(省级质量控制)\n  D --> B\n  B --> A\n  D --> C\n  D --> F(综合评估)\n  F --> G(年报撰写及发布)\n```\n\n\n## 年报该如何撰写?\n>把统计分析数据转换为文字的过程。\n\n\n```{mermaid}\nflowchart LR\n  A(统计分析) --> B(制作表格)\n  B --> C(绘制统计图)\n  C --> D(专家撰写)\n  D --> E(初稿)\n    E --> F(审核定版)\n```\n\n\n\n::: columns\n::: {.column width=\"40%\"}\n::: callout-tip\n## 年报特点\n- 客观描述\n- 要求文字描述风格的一致性\n- 有图有表\n- 无讨论，无观点\n- 需要专家码字\n:::\n:::\n\n::: {.column width=\"40%\"}\n::: callout-important\n## 自动化？\n- Scientific writing？\n- 可重复性报告\n- Rmarkdown\n- Quarto\n:::\n:::\n:::\n\n## 可重复性报告技术\n>基于现有年报的特点,以及随着可重复性报告技术的成熟,可以实现自动化撰写的需求?\n\n:::{.callout-note}\n## 思路\n利用Bookdown包把统计结果进行展现，包括文字描述和可视化展现(各种统计图表)\n:::\n\n\n## 可重复性报告技术\n![](../2023-9-23-rural-canreg/images/report.jpg)\n\n\n## 可重复性报告技术{.smaller}\n> Bookdown程序由按照章节区分的Rmd文件组成，每个Rmd文件可以输出相应章节的文字描述，从而形成最终的文本。\n\n::: {.columns}\n:::{.column width=\"30%\"}\n1. index.Rmd\n1. 01-summary.Rmd\n1. 02-method.Rmd\n1. 03-quality.Rmd\n1. 04-total_cancer.Rmd\n1. 05-eachsite.Rmd\n:::\n:::{.column width=\"20%\"}\n- 行内代码插入数据\n- 文字描述\n:::\n:::{.column width=\"50%\"}\n![](https://cdn.jsdelivr.net/gh/gigu003/db/images/quality/codes.jpg){width='75%' fig-align=\"center\"}\n\n:::\n:::\n\n## 可重复性报告技术{.smaller}\n\n![](https://cdn.jsdelivr.net/gh/gigu003/db/images/quality/letters.jpg){width='75%' fig-align=\"center\"}\n\n## 表格如何实现？\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata<-inciden\nheader<-data.frame(\n    col_keys=colnames(data),\n    second=c(\"地区\",\"性别\",\"发病数\",\"发病率\",\"中标率\",\"世标率\",\"累积率\\n0-74(%)\"))\ndata%>%flextable()%>%\n  set_header_df( mapping = header, key = \"col_keys\" )%>%\n  compose(j=4,value=as_paragraph(\"发病率\\n(1/10\",as_sup(\"5\"),\")\"),part=\"header\")%>%\n  compose(j=5,value=as_paragraph(\"中标率\\n(1/10\",as_sup(\"5\"),\")\"),part=\"header\")%>%\n  compose(j=6,value=as_paragraph(\"世标率\\n(1/10\",as_sup(\"5\"),\")\"),part=\"header\")%>%\n  colformat_num(j=4:7,digits = 5.2)%>%\n  set_caption(caption= paste(year.data,\"年河南省肿瘤登记地区恶性肿瘤（C00-C96）发病主要指标\",\"\"))%>% \n  align(align=\"center\",part=\"all\")%>%\n  bold(bold=TRUE,part=\"header\")%>%\n  width(j=1:2,width=0.5)%>%\n  width(j=3:7,width=1.0)%>%\n  theme_booktabs()\n```\n:::\n\n\n\n## 表格如何实现？\n![](https://cdn.jsdelivr.net/gh/gigu003/db/images/quality/tables.jpg){fig-align=\"center\"}\n\n## 批量化生成各章节统计图\n\n\n::: {.cell}\n\n```{.r .cell-code}\nyearpub<-2023\nreport<-haven::read_sas(\"./report.sas7bdat\")\nareacode1 <- c(\"410902\",\"411202\",\"411303\",\"411502\",\"419001\",\"411002\")\nareacode2 <- c(\"410901\",\"411001\",\"411201\",\"411301\",\"411501\")\nreport <-report%>%\n  filter(city %in% c(\"11\",\"2\",\"33\")|areacode %in% areacode1,\n         !(areacode %in% areacode2))%>%\n  mutate(year = as.numeric(year),\n         city = as.numeric(city))\nsource(\"./rscripts/gen_annual_report_plot.R\")\n```\n:::\n\n\n## 批量化生成各章节统计图{.smaller}\n\n![](../2023-9-23-rural-canreg/images/charts.jpg){fig-align=\"center\"}\n\n\n## 生成年报只需一次点击 {.smaller}\n> 大约需要一分钟的时间!!!\n\n::: {.columns}\n::: {.column width=\"30%\"}\n- 一次点击Build\n- 同时输出多种形式\n  - Word\n  - PDF\n  - Epub\n  - 网页\n:::\n\n::: {.column width=\"70%\"}\n![](https://cdn.jsdelivr.net/gh/gigu003/db/images/quality/gen-bookk.gif)\n:::\n:::\n\n## 线上发布{.smaller}\n> 在线发布的年报更容易传播和共享\n\n\n::: {.cell}\n<iframe src=\"https://chenq.site/report/2021/\" width=\"960\" height=\"400px\" data-external=\"1\"></iframe>\n:::\n\n\n## 现有方法\n\n::: columns\n::: {.column width=\"50%\"}\n::: callout-tip\n## 不足之处\n- 可移植性不足\n- 需要了解一点编程知识\n- 整合性不足\n:::\n:::\n\n::: {.column width=\"50%\"}\n::: callout-important\n## 待开发\n- R包\n- 输出Fact Sheet（按照癌种、人群）\n:::\n:::\n:::\n\n## 现有肿瘤登记年报的特点{.smaller}\n> 随着肿瘤登记处数量的增加以及数据质量的提升,国家及大部分省份开始发布国家级或省级的肿瘤登记年报。\n\n- 以传统书籍的形式出版\n- 以白皮书的形式发布报告\n- 把传统书籍搬到线上（线上年报）\n- 价格较高\n- 不利于数据共享和传播\n\n> 我们真的需要每年发布纸质年报吗？\n\n\n\n\n\n# 谢谢关注！{.no-auto-agenda}\n\n\n::: {.cell}\n<style type=\"text/css\">\n.qrcode {\n    display: flex;\n    justify-content: space-around;\n  }\n\n  .qrcode img {\n    width: 28%; \n  }\n  \n  .column {\n  display: flex;\n  justify-content: space-around; /* 将子元素横向居中 */\n}\n\n</style>\n:::\n\n\n<br>\n\n{{< qrcode https://slides.chenq.site/2024-4-17-quality-control/index.html width=150 height=150 text=\"本次幻灯\">}}\n\n{{< qrcode https://slides.chenq.site width=150 height=150 text=\"所有幻灯\">}}\n\n{{< qrcode https://chenq.site width=150 height=150 text=\"个人网站\">}}\n\n:::{.columns}\n:::{.column width='10%'}\n:::\n:::{.column width='20%'}\n   本次幻灯\n:::\n\n:::{.column width='10%'}\n:::\n:::{.column width='20%'}\n   所有幻灯\n:::\n\n:::{.column width='10%'}\n:::\n:::{.column width='30%'}\n   个人网站\n:::\n:::\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../site_libs/kePrint-0.0.1/kePrint.js\"></script>\n<link href=\"../site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\n"
      ],
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}