---
title: "Rè¯­è¨€ä¿ƒè¿›é«˜æ•ˆç‡è‚¿ç˜¤ç™»è®°æŠ¥å‘Š"
subtitle: "åŸºäºR Markdown / Quartoçš„å¯é‡å¤æ€§æŠ¥å‘Šæ’°å†™"
author: "é™ˆç¼"
date: 2023-5-16
date-modified: last-modified
date-format: "dddd MMM D, YYYY"
institute: "ğŸ¥æ²³å—çœç™Œç—‡ä¸­å¿ƒ\næ²³å—çœè‚¿ç˜¤åŒ»é™¢"
address: "éƒ‘å·"
format: 
  revealjs:
    theme: [custom.scss]
    #width: 1600
    #height: 900
    slide-number: true
    smaller: true
    scrollable: true
    #number-sections: true
    footer: "æ²³å—çœäººç¾¤è‚¿ç˜¤ç™»è®°"
    subtitle-as-header: true
    #sc-sb-title: true
filters:
  - reveal-header
slide-level: 2
title-slide-style: pandoc
crossref:
  fig-title: å›¾     
  tbl-title: è¡¨     
  #title-delim: ""
  tbl-prefix: è¡¨
  fig-prefix: å›¾
title-slide-attributes:
  data-background-color: "lightblue"
---

# è‚¿ç˜¤ç™»è®°å·¥ä½œä»‹ç» {background-color="lightblue"}



## äººç¾¤è‚¿ç˜¤ç™»è®°çš„ç›®çš„å’Œæ„ä¹‰

<br>

> è‚¿ç˜¤ç™»è®°æ˜¯ç³»ç»Ÿæ€§ã€ç»å¸¸æ€§æœé›†æœ‰å…³è‚¿ç˜¤åŠè‚¿ç˜¤æ‚£è€…ä¿¡æ¯çš„ç»Ÿè®¡åˆ¶åº¦ã€‚

</br>


-   äº†è§£ç™Œç—‡å‘ç—…ã€æ­»äº¡ã€ç”Ÿå­˜æƒ…å†µ

-   æŒæ¡ç™Œç—‡ç–¾ç—…è´Ÿæ‹…ä¸å˜åŒ–è¶‹åŠ¿

-   äº†è§£ç™Œç—‡åœ¨ä¸åŒåœ°åŒºå’Œäººç¾¤ä¸­çš„åˆ†å¸ƒç‰¹å¾


## äººç¾¤è‚¿ç˜¤ç™»è®°çš„ç›®çš„å’Œæ„ä¹‰

<br>

> è‚¿ç˜¤ç™»è®°æ˜¯ç³»ç»Ÿæ€§ã€ç»å¸¸æ€§æ”¶é›†æœ‰å…³è‚¿ç˜¤åŠè‚¿ç˜¤æ‚£è€…ä¿¡æ¯çš„ç»Ÿè®¡åˆ¶åº¦ã€‚

</br>

-   ä¸ºåˆ¶å®šç™Œç—‡é˜²æ§ç­–ç•¥ä¸æªæ–½ã€è§„åˆ’ä¸è®¡åˆ’æä¾›ç§‘å­¦ä¾æ®

-   ä¸ºç™Œç—‡çš„ä¸´åºŠç ”ç©¶æä¾›ä¿¡æ¯

-   ä¸ºç™Œç—‡é˜²æ§æ•ˆæœè¯„ä»·æä¾›æ•°æ®æ”¯æŒ


## æ²³å—çœè‚¿ç˜¤ç™»è®°å·¥ä½œè¿›å±•


<br>

:::: {.columns}

::: {.column width="50%"}

- è‚¿ç˜¤ç™»è®°å·¥ä½œè¦†ç›–130ä¸ªå¿åŒº
- è¾¾åˆ°æ•°æ®åˆ©ç”¨æ ‡å‡†çš„ç™»è®°å¤„è¾¾åˆ°42ä¸ªï¼Œè¦†ç›–å…¨çœ32%çš„äººå£
- è¿ç»­10å¹´å‡ºç‰ˆã€Šæ²³å—çœè‚¿ç˜¤ç™»è®°å¹´æŠ¥ã€‹

:::

::: {.column width="50%"}

```{r}
#| label: map
#| fig-cap: æ²³å—çœè‚¿ç˜¤ç™»è®°åœ°åŒºè¦†ç›–æƒ…å†µ
#| fig-align: center
#| fig-width: 10
knitr::include_graphics("../2023-4-20-cancer-registration/images/map.png")
```

:::

::::




## ç»„ç»‡æ¶æ„

<br>

:::: {.columns}

::: {.column width="33%"}
#### çœçº§ç™»è®°å¤„

*æ²³å—çœç™Œç—‡ä¸­å¿ƒ*

:::{.callout-note}
## èŒè´£

- åˆ¶å®šå…¨çœå·¥ä½œè®¡åˆ’ã€å®æ–½æ–¹æ¡ˆ
- å»ºç«‹å’Œå®Œå–„è‚¿ç˜¤ç™»è®°ä¿¡æ¯ç³»ç»Ÿ
- æŠ€æœ¯æŒ‡å¯¼ã€äººå‘˜åŸ¹è®­ã€è´¨é‡æ§åˆ¶å’Œè€ƒæ ¸è¯„ä»·
- ç£å¯¼æ£€æŸ¥
- æ•°æ®åˆ†æå’ŒæŠ¥å‘Š 

:::
:::

::: {.column width="33%"}

#### å¸‚çº§ç™»è®°å¤„

*å¸‚çº§CDC/è‚¿ç˜¤åŒ»é™¢*


:::{.callout-note}
## èŒè´£
- å¸‚çº§æŠ€æœ¯æŒ‡å¯¼ã€äººå‘˜åŸ¹è®­
- è´¨é‡æ§åˆ¶
- ç£å¯¼æ£€æŸ¥
- æ•°æ®åˆ†æå’ŒæŠ¥å‘Š
:::



:::


::: {.column width="33%"}

#### å¿åŒºçº§ç™»è®°å¤„

*å¿åŒºçº§CDC*

:::{.callout-note}
## èŒè´£

- æŠ€æœ¯æŒ‡å¯¼ã€äººå‘˜åŸ¹è®­
- è´¨é‡æ§åˆ¶
- ç£å¯¼æ£€æŸ¥
- ç»Ÿè®¡åˆ†æå’ŒæŠ¥å‘Š
  
:::

:::

::::


::: footer
æ•°æ®æ¥æº: æ²³å—çœè‚¿ç˜¤ç™»è®°ç®¡ç†åŠæ³•ï¼ˆè±«å«2015(10å·)æ–‡ä»¶ï¼‰
:::

## æ”¶é›†æ•°æ®å†…å®¹

> è‚¿ç˜¤ç™»è®°æ”¶é›†ä¸€å®šäººç¾¤ä¸­æ‰€æœ‰æ¶æ€§è‚¿ç˜¤ã€ä¸­æ¢ç¥ç»ç³»ç»Ÿè‰¯æ€§è‚¿ç˜¤ä»¥åŠåŸä½ç™Œã€‚ <br>

</br>

::: columns
::: {.column width="33%"}
#### è‚¿ç˜¤æ”¶é›†èŒƒå›´(ICD10)

-   C00-C97
-   D32-D33
-   D42-D43
-   D45-D47
-   åŸä½ç™Œ
:::

::: {.column width="33%"}
#### äººå£æ•°æ®

> ä»¥å¿åŒºä¸ºå•ä½æ”¶é›†ç™»è®°å¤„è¦†ç›–äººç¾¤åˆ†å¹´é¾„ã€åˆ†æ€§åˆ«æˆ·ç±äººå£æ•°
:::

::: {.column width="33%"}
#### å¯¿å‘½è¡¨æ•°æ®

> ä»¥å¿åŒºä¸ºå•ä½æ”¶é›†ç™»è®°å¤„è¦†ç›–äººç¾¤åˆ†å¹´é¾„ã€åˆ†æ€§åˆ«å…¨æ­»å› æ­»äº¡æ•°ä»¥ä¼°è®¡å¯¿å‘½è¡¨
:::
:::

## æ•°æ®é¡¹ç›®

::: columns
::: {.column width="30%"}
> è‚¿ç˜¤ç™»è®°æ”¶é›†çš„å˜é‡åŒ…æ‹¬ä»¥ä¸‹7ä¸ªéƒ¨åˆ†ï¼ˆ@fig-itemsï¼‰

-   ä¸ªäººè¯†åˆ«ä¿¡æ¯
-   äººå£å­¦ä¿¡æ¯
-   è‚¿ç˜¤ä¿¡æ¯
-   æ²»ç–—ä¿¡æ¯
-   éšè®¿ä¿¡æ¯
-   é¢„åä¿¡æ¯
-   ä¿¡æ¯æ¥æº
:::

::: {.column width="70%"}
```{mermaid}
%%| label: fig-items
%%| fig-cap: äººç¾¤è‚¿ç˜¤ç™»è®°æ”¶é›†æ•°æ®é¡¹ç›®
classDiagram
    class ä¸ªäººè¯†åˆ«ä¿¡æ¯ {
    ç™»è®°å¤„ç¼–å·
    èº«ä»½è¯å·
    å§“å
    æˆ·ç±åœ°å€
    å¸¸ä½åœ°å€
}
    class äººå£å­¦ä¿¡æ¯ {
    æ€§åˆ«
    å¹´é¾„
    å‡ºç”Ÿæ—¥æœŸ
    å©šå§»çŠ¶æ€
    èŒä¸š
    æ°‘æ—
}
    class è‚¿ç˜¤ä¿¡æ¯ {
    å‘ç—…æ—¥æœŸ
    è¯Šæ–­ä¾æ®
    åŸå‘éƒ¨ä½ICDO3
    å½¢æ€å­¦ICDO3
    è¡Œä¸ºICDO3
    åˆ†çº§ICDO3
    ä¸´åºŠåˆ†æœŸ/TNMåˆ†æœŸ
    å¤šåŸå‘çŠ¶æ€
    åŒè¾¹æ€§
}
    class æ²»ç–—ä¿¡æ¯ {
    æ²»ç–—æ–¹æ³•
}
    class éšè®¿ç›¸å…³ä¿¡æ¯ {
    è”ç³»ç”µè¯
    è”ç³»äºº
    è”ç³»äººç”µè¯
    å¸¸ä½åœ°å€
}
    class ç»“å±€ä¿¡æ¯ {
    æœ€åæ¥è§¦æ—¥æœŸ
    ç”Ÿå­˜çŠ¶æ€
    æ­»äº¡æ—¥æœŸ
    æ­»äº¡åŸå› 
    æ­»äº¡åœ°ç‚¹
}
    class ä¿¡æ¯æ¥æº {
    æŠ¥å‘ŠåŒ»é™¢
    ä½é™¢å·/é—¨è¯Šå·
    æŠ¥å‘ŠåŒ»å¸ˆ
    æŠ¥å‘Šæ—¥æœŸ
}

    ä¸ªäººè¯†åˆ«ä¿¡æ¯ --|> äººå£å­¦ä¿¡æ¯
    ä¸ªäººè¯†åˆ«ä¿¡æ¯ --|> è‚¿ç˜¤ä¿¡æ¯
    ä¸ªäººè¯†åˆ«ä¿¡æ¯ --|> æ²»ç–—ä¿¡æ¯
    ä¸ªäººè¯†åˆ«ä¿¡æ¯ --|> éšè®¿ç›¸å…³ä¿¡æ¯
    ä¸ªäººè¯†åˆ«ä¿¡æ¯ --|> ç»“å±€ä¿¡æ¯
    ä¸ªäººè¯†åˆ«ä¿¡æ¯ --|> ä¿¡æ¯æ¥æº
```
:::
:::

## æ•°æ®æ¥æº

> è‚¿ç˜¤ç™»è®°å¼ºè°ƒ**å¤šæºä¸ŠæŠ¥**ã€æ•°æ®æ¥æºäºåŒ»é™¢ã€åŒ»ä¿ç³»ç»Ÿã€å¿-ä¹¡-æ‘åŒ»å¸ˆç½‘ã€å…¨æ­»å› æ•°æ®ç­‰ã€‚ï¼ˆ@fig-1 ï¼‰

```{mermaid}
%%| label: fig-1
%%| fig-cap: è‚¿ç˜¤ç™»è®°æ•°æ®æ¥æºæ¸ é“
%%| fig-align: center
flowchart TD
  A[(è‚¿ç˜¤ç™»è®°æ•°æ®åº“)] --> B(åŒ»é™¢)
  A --> B
  A --> C(å¿-ä¹¡-æ‘ä¸‰çº§åŒ»å¸ˆç½‘ç»œ)
  A --> D(åŒ»ç–—ä¿é™©)
  A --> E(æ­»å› ç›‘æµ‹)
  A --> F(æ®¡è‘¬ç³»ç»Ÿ)
  A --> G(å…¬å®‰ç³»ç»Ÿ)
  B --> b1(ä½é™¢æ‚£è€…æ•°æ®)
  B --> b2(é—¨è¯Šæ‚£è€…æ•°æ®)
  B --> b3(ç—…æ¡ˆéƒ¨é—¨)
  B --> b4(ç—…ç†è¯Šæ–­éƒ¨é—¨)
  D --> d1(æ–°å†œåˆ)
  D --> d2(åŸé•‡åŒ»ä¿)
  D --> d3(èŒå·¥åŒ»ä¿)
```


## è‚¿ç˜¤åˆ†ç±»ä¸ç¼–ç 

::: columns
::: {.column width="50%"}
<br>

> è‚¿ç˜¤ç™»è®°é‡‡ç”¨ICDO3å’ŒICD10**åŒç¼–ç ç³»ç»Ÿ**

#### ICD-O-3ï¼šæ•°æ®æ”¶é›†

  - åŸå‘éƒ¨ä½
  - å½¢æ€å­¦
  - è¡Œä¸º
  - åˆ†çº§

####  ICD10 ï¼šæ•°æ®ç»Ÿè®¡åˆ†æ

>  ã€Šè‚¿ç˜¤ç™»è®°å¹´æŠ¥ã€‹é‡‡ç”¨ICD10è¿›è¡Œè‚¿ç˜¤åˆ†ç±»ï¼ˆ@tbl-categoryï¼‰

:::

::: {.column width="50%"}
```{r}
#| label: tbl-category
#| tbl-cap: å¸¸ç”¨ç™Œç—‡åˆ†ç±»ç»Ÿè®¡è¡¨ï¼ˆå¤§ç±»ï¼‰
library(haven)
library(dplyr)
library(kableExtra)
names_ <- c("éƒ¨ä½","ç¼–ç èŒƒå›´(ICD10)")
 haven::read_sas("../2023-4-20-cancer-registration/data/category2.sas7bdat") %>%
   kbl(col.names = c("éƒ¨ä½","ICD10")) %>% 
   kable_styling(font_size = 12)
```
:::
:::



## è´¨é‡æ§åˆ¶

:::: {.columns}

::: {.column width="40%"}

:::{.callout-tip}
## è´¨é‡æ§åˆ¶çš„æ„ä¹‰
 - ä½¿ä¸åŒåœ°åŒºä¹‹é—´çš„æ•°æ®å…·æœ‰å¯æ¯”æ€§
 - ä»£è¡¨ç™»è®°å¤„æ‰€åœ¨åœ°åŒºçš„ç™Œç—‡äººç¾¤
 - ä½¿ç™Œç—‡æ•°æ®çœŸå®æœ‰æ•ˆ
:::

::: aside
é‡‡ç”¨IARC/IACRå›½é™…è´¨é‡æ§åˆ¶æ ‡å‡†
:::

:::

::: {.column width="60%"}

```{mermaid}
%%| label: fig-quality
%%| fig-cap: è‚¿ç˜¤ç™»è®°è´¨é‡æ§åˆ¶æŒ‡æ ‡ä½“ç³»
%%| fig-align: center
flowchart LR
  A[è´¨é‡æ§åˆ¶æŒ‡æ ‡] --> B(å¯æ¯”æ€§)
  A --> C(å®Œæ•´æ€§)
  A --> D(æœ‰æ•ˆæ€§)
  A --> E(æ—¶æ•ˆæ€§)
  B --> b1(å‘ç—…çš„å®šä¹‰)
  B --> b2(å¤šåŸå‘åˆ¤æ–­)
  B --> b3(åˆ†ç±»ä¸ç¼–ç )
  B --> b4(æ­»äº¡è¯æ˜)
  C --> c1(æ­»äº¡å‘ç—…æ¯”M:I)
  C --> c2(åªæœ‰æ­»äº¡åŒ»å­¦è¯æ˜ä¹¦æ¯”ä¾‹DCO%)
  C --> c3(ç»„ç»‡å­¦ç¡®è¯Šæ¯”ä¾‹MV%)
  C --> c4(ä¸åŒæ—¶é—´å‘ç—…ç‡çš„ç¨³å®šæ€§)
  C --> c5(å¹´é¾„åˆ«å‘ç—…ç‡æ›²çº¿)
  D --> d1(ç»„ç»‡å­¦ç¡®è¯Šæ¯”ä¾‹)
  D --> d2(åªæœ‰æ­»äº¡åŒ»å­¦è¯æ˜ä¹¦æ¯”ä¾‹DC\%)
  D --> d3(éƒ¨ä½ä¸æ˜æ¯”ä¾‹UB%)
  D --> d4(æ•°æ®å†…éƒ¨ä¸€è‡´æ€§)
```

:::

::::



## è´¨é‡æ§åˆ¶
<br>

> è‚¿ç˜¤ç™»è®°æ”¶é›†çš„å˜é‡æˆ–è€…å˜é‡ç»„åˆä¹‹é—´å­˜åœ¨ä¸€å®šçš„é€»è¾‘å…³ç³»ï¼Œé€šè¿‡å¯¹å•ä¸ªå˜é‡æˆ–å˜é‡ç»„åˆä¹‹é—´çš„é€»è¾‘å…³ç³»è¿›è¡Œå®¡æŸ¥ï¼Œä»¥æé«˜è‚¿ç˜¤ç™»è®°æ•°æ®æœ‰æ•ˆæ€§ã€‚


:::: {.columns}

::: {.column width="40%"}

:::{.callout-tip}

## å•ä¸ªé¡¹ç›®

- å‡ºç”Ÿæ—¥æœŸ
- å‘ç—…æ—¥æœŸ
- å¹´é¾„ã€æ€§åˆ«
- å‘ç—…éƒ¨ä½
- å½¢æ€å­¦
- è¡Œä¸ºå’Œåˆ†çº§
:::

:::

::: {.column width="40%"}

:::{.callout-important}

## é¡¹ç›®ç»„åˆ

- æ€§åˆ«/éƒ¨ä½
- éƒ¨ä½/ç»„ç»‡å­¦å­¦
- å¹´é¾„/éƒ¨ä½/ç»„ç»‡å­¦
- è¡Œä¸º/éƒ¨ä½
- è¡Œä¸º/ç»„ç»‡å­¦
- æ€§åˆ«/ç»„ç»‡å­¦
:::

:::


::: {.column width="20%"}

:::{.callout-caution}

## æ ¡éªŒç»“æœ

- æ­£ç¡®âœ…
- è­¦å‘Šâš ï¸
- é”™è¯¯âŒ
:::

:::
::::


## è‚¿ç˜¤ç™»è®°æŠ¥å‘Šæµç¨‹

<br>

```{mermaid}
%%| label: fig-report
%%| fig-cap: è‚¿ç˜¤ç™»è®°æŠ¥å‘Šæµç¨‹
%%| fig-align: center
flowchart LR
  A(æ•°æ®æ¥æºå•ä½) --> B(å¿åŒºçº§ç™»è®°å¤„)
  B --> C(å¸‚çº§ç™»è®°å¤„)
  C --> D(çœçº§ç™»è®°å¤„)
  D --> E(è´¨é‡æ§åˆ¶)
  E --> B
  B --> A
  E --> C
  E --> F(ç»¼åˆè¯„ä¼°)
  F --> G(å¹´æŠ¥æ’°å†™åŠå‘å¸ƒ)
```

<br>

:::: {.columns}

::: {.column width="50%"}

### ä¸»è¦å†…å®¹

- è´¨é‡æ§åˆ¶æŠ¥å‘Šæ’°å†™
- è‚¿ç˜¤ç™»è®°æŠ¥å‘Šæ’°å†™

:::

::: {.column width="50%"}

### ç‰¹ç‚¹

- ç™»è®°å¤„æ•°é‡å¤š(130ä¸ªå¿åŒº)
- å¿åŒºçº§ä¸“ä¸šäººå‘˜èƒ½åŠ›ä¸è¶³
- è´¨æ§æŠ¥å‘Šåé¦ˆè‡³å¸‚çº§å’Œå¿åŒºçº§


:::

::::

## æ–‡å­¦ç¼–ç¨‹å’Œå¯èƒ½é‡å¤æ€§æŠ¥å‘Šæ¦‚å¿µçš„å¼•å…¥

> **æ–‡å­¦ç¼–ç¨‹**:å¼ºè°ƒä»¥è‡ªç„¶è¯­è¨€å‘ˆç°è®¡ç®—é€»è¾‘ï¼Œä»¥æ–‡æœ¬æè¿°å’Œè®¡ç®—ä»£ç ç›¸äº’æ··åˆçš„æ–¹å¼ï¼Œä»è®¡ç®—æœºä»£ç çš„æ‰§è¡Œé€»è¾‘è¿‡æ¸¡åˆ°äººçš„æ€ç»´é€»è¾‘ã€‚

> **å¯é‡å¤æ€§æŠ¥å‘Š**:åˆ©ç”¨ä»£ç æŠŠæ•°æ®åˆ†æè¿‡ç¨‹å’ŒæŠ¥å‘Šæ’°å†™è¿‡ç¨‹ä¸²èµ·æ¥ï¼Œæœ€ç»ˆç”Ÿæˆå¯é‡å¤æ€§çš„æŠ¥å‘Šã€‚

<br>

- åŸºäº*åŸå§‹æ•°æ®*æ›´æ–°æŠ¥å‘Š
- æŠ¥å‘Šçš„*æ‰¹é‡åŒ–*ç”Ÿæˆ
- å¤šç§æ ¼å¼è¾“å‡º(htmlã€docx)


# åŸºäºR Markdown / Quarto çš„å¯é‡å¤æ€§æŠ¥å‘Š {background-color="lightblue"}


## Markdown

<br>

> å®ƒå…è®¸äººä»¬ä½¿ç”¨æ˜“è¯»æ˜“å†™çš„**çº¯æ–‡æœ¬æ ¼å¼**ç¼–å†™æ–‡æ¡£ï¼Œç„¶åè½¬æ¢æˆæœ‰æ•ˆçš„ XHTMLï¼ˆæˆ–è€…HTMLï¼‰æ–‡æ¡£ã€‚

<br>

- è½»é‡çº§æ ‡è®°è¯­è¨€
- è½»é‡åŒ–ã€æ˜“è¯»æ˜“å†™ã€å¯¹å›¾ç‰‡ã€è¡¨æ ¼ã€æ•°å­¦å…¬å¼æ”¯æŒ
- Githubã€Redditã€Diasporaã€Stack Exchangeã€OpenStreetMapã€SourceForgeã€ç®€ä¹¦ç­‰ï¼Œç”šè‡³è¿˜èƒ½è¢«ä½¿ç”¨æ¥æ’°å†™ç”µå­ä¹¦



## R Markdown

<br>

> R MarkdownæŠŠ*æŠ¥å‘Šæ–‡æœ¬*å’Œ*ç»Ÿè®¡è®¡ç®—ä»£ç *æ•´åˆèµ·æ¥ï¼Œä»è€Œå®ç°ä¸€æ¬¡è¾“å…¥å¤šç§æ ¼å¼è¾“å‡º(HTMLã€PDFã€WORDç­‰)ã€‚

<br>

- YAML å…ƒæ•°æ®è®¾ç½®
- ä»£ç å—ï¼ˆRã€Pythonç­‰ï¼‰
- Markdownæ–‡æœ¬



## R Markdown

### YAMLå…ƒæ•°æ®

```yaml
---
title: "æ²³å—çœæ¶æ€§è‚¿ç˜¤2017-2019å¹´5å¹´ç›¸å¯¹ç”Ÿå­˜ç‡"
authors:
  - name: é™ˆç¼
    affiliations:
      - ref: zlyy
  - name: å¼ æ˜éœ
    affiliations:
      - ref: zlyy
      - ref: lzu
  - name: éƒ­å…°ä¼Ÿ
    affiliations:
      - ref: zlyy
  - name: éƒ‘é»é˜³
    affiliations:
      - ref: zlyy
  - name: åˆ˜çº¯äºš
    affiliations:
      - ref: zlyy
  - name: ç‹ä¸€å…ˆ
    affiliations:
      - ref: zlyy
  - name: åˆ˜èŒµ
    affiliations:
      - ref: zlyy
  - name: ç‹çº¢
    affiliations:
      - ref: zlyy
  - name: å¾æ…§èŠ³
    affiliations:
      - ref: zlyy
  - name: åº·ç‘å
    affiliations:
      - ref: zlyy
  - name: ç‹æ½‡æ¨
    affiliations:
      - ref: zlyy
  - name: åˆ˜æ›™æ­£
    affiliations:
      - ref: zlyy
  - name: å¼ éŸ¶å‡¯
    affiliations:
      - ref: zlyy
    corresponding: true
    email: shaokaizhang@126.com
affiliations:
  - id: zlyy
    name: éƒ‘å·å¤§å­¦é™„å±è‚¿ç˜¤åŒ»é™¢(æ²³å—çœè‚¿ç˜¤åŒ»é™¢)ï¼Œç–¾ç—…é¢„é˜²æ§åˆ¶ç§‘ï¼›æ²³å—çœè‚¿ç˜¤é˜²æ§å·¥ç¨‹ç ”ç©¶ä¸­å¿ƒï¼›æ²³å—çœè‚¿ç˜¤é¢„é˜²å›½é™…è”åˆå®éªŒå®¤ï¼Œéƒ‘å·ï¼Œ450008ã€‚
    city: éƒ‘å·
    state: æ²³å—çœ
  - id: lzu
    name: å…°å·å¤§å­¦å…¬å…±å«ç”Ÿå­¦é™¢
    city: å…°å·
    state: ç”˜è‚ƒçœ
filters:
  - authors-block

#prefer-html: true
execute: 
  echo: false
  warning: false
  message: false
  tbl-cap-location: top
#lang: zh
crossref:
  fig-title: å›¾     
  tbl-title: è¡¨     
  title-delim: ""
  tbl-prefix: è¡¨

format: 
  docx: 
    number-sections: true
    number-depth: 3
    reference-doc: chinese.docx

bibliography: survival17-19.bib
csl: "zhonghua.csl"
editor_options: 
  chunk_output_type: console
---
```



## R Markdown

### ä»£ç å—

:::: {.columns}

::: {.column width="50%"}

```{r}
#| label: tbl-table1
#| tbl-cap-location: top
#| tbl-cap: "æ¥å—ä¸åŒè¯ç‰©æ²»ç–—äººç¾¤åŸºæœ¬ç‰¹å¾åˆ†æ"
#| warning: false
#| eval: false
#| message: false
#| echo: fenced

library(gtsummary)

trial %>% select(age, grade, response, trt) %>% 
   tbl_summary(by=trt) %>% 
  add_p() %>% 
  add_overall() %>% 
  add_n() %>% 
  bold_labels() 
```

:::

::: {.column width="50%"}

```{r}
knitr::include_graphics("images/table.jpg")
```

:::

::::


## R Markdown

### Markdownæ–‡æœ¬

```yaml
**é€šè®¯ä½œè€…**ï¼šå¼ éŸ¶å‡¯ï¼ŒEmail: shaokaizhang\@126.com

ã€**æ‘˜è¦**ã€‘

**ç›®çš„** åˆ©ç”¨æ²³å—çœäººç¾¤è‚¿ç˜¤ç™»è®°æ•°æ®åˆ†ææ²³å—çœäººç¾¤ç™Œç—‡5å¹´ç›¸å¯¹ç”Ÿå­˜ç‡ã€‚

**æ–¹æ³•** æå–æ²³å—çœè‚¿ç˜¤ç™»è®°æ•°æ®åº“ä¸­25ä¸ªè‚¿ç˜¤ç™»è®°å¤„è¯Šæ–­æ—¥æœŸåœ¨2014å¹´1æœˆ1æ—¥è‡³2019å¹´12æœˆ31æ—¥ä¹‹é—´ä»¥åŠ2014å¹´ä¹‹å‰è¯Šæ–­ä½†æ˜¯2019å¹´12æœˆ31æ—¥ä¹‹å‰ä»ç„¶å­˜æ´»çš„ç™Œç—‡ç—…ä¾‹ï¼ˆICD10ç¼–ç èŒƒå›´ï¼šC00-C97ã€D32-D33ã€D42-D43å’ŒD45-D47ï¼‰ï¼Œéšè®¿æˆªæ­¢æ—¥æœŸè®¾å®šä¸º2019å¹´12æœˆ31æ—¥ï¼Œåˆ©ç”¨ç°æ—¶ç”Ÿå­˜åˆ†ææ³•å’ŒRè¯­è¨€"periodR"åŒ…çš„EdererIIæ³•è®¡ç®—ç™Œç—‡çš„5å¹´ç›¸å¯¹ç”Ÿå­˜ç‡ã€‚

**ç»“æœ** 2017-2019å¹´æœŸé—´ï¼Œæ²³å—çœ0-14å²å„¿ç«¥ç™Œç—‡çš„5å¹´ç›¸å¯¹ç”Ÿå­˜ç‡ä¸º62.5%ï¼Œ15å²åŠä»¥ä¸Šæˆäººç™Œç—‡5å¹´ç›¸å¯¹ç”Ÿå­˜ç‡ä¸º44.2%ï¼Œå¹´é¾„æ ‡åŒ–åä¸º40.7%ã€‚æ€»ä½“ç™Œç—‡5å¹´ç”Ÿå­˜ç‡å‘ˆç°å¥³æ€§é«˜äºç”·æ€§ï¼ˆ47.1% VS 34.4%, *P*\<0.01ï¼‰ã€åŸå¸‚åœ°åŒºé«˜äºå†œæ‘åœ°åŒºï¼ˆ46.4% VS 39.2%, *P*\<0.01ï¼‰çš„ç‰¹ç‚¹ã€‚åœ¨ä¸åŒå‘ç—…éƒ¨ä½çš„ç™Œç—‡æ‚£è€…ä¸­ï¼Œç”²çŠ¶è…ºç™Œã€ç¾ä¸¸ç™ŒåŠä¹³è…ºç™Œå…·æœ‰æœ€é«˜çš„5å¹´ç›¸å¯¹ç”Ÿå­˜ç‡ï¼Œåˆ†åˆ«ä¸º86.4%ã€74.4%å’Œ73.1%ï¼›è‚ç™Œã€èƒ°è…ºç™Œã€è‚ºç™Œå…·æœ‰æœ€ä½çš„5å¹´ç›¸å¯¹ç”Ÿå­˜ç‡ï¼Œåˆ†åˆ«ä¸º19.1%ã€20.5%å’Œ24.3%ã€‚

**ç»“è®º** æ²³å—çœå„¿ç«¥åŠæˆäººç™Œç—‡æ‚£è€…æ€»ä½“5å¹´ç›¸å¯¹ç”Ÿå­˜ç‡ä»ç„¶è¾ƒä½ï¼Œåº”æ ¹æ®æ²³å—çœç™Œç—‡æµè¡Œæƒ…å†µåŠä¸åŒç™Œç—‡çš„ç”Ÿå­˜ç‡æ•°æ®è°ƒæ•´å’Œä¼˜åŒ–ç™Œç—‡é˜²æ§ç­–ç•¥å’Œæªæ–½ã€‚

ã€**å…³é”®è¯**ã€‘ ç™Œç—‡ï¼›ç™Œç—‡é˜²æ§ï¼›ç°æ—¶ç”Ÿå­˜åˆ†æï¼›5å¹´ç›¸å¯¹ç”Ÿå­˜ç‡ï¼›æ²³å—çœ

The 5-year relative survival among cancer patients diagnosed during 2017-2019 in Henan Province, China {.unnumbered}

Qiong Chen$^1$, Mingxia Zhang$^12$, Lanwei Guo$^1$, Liyang Zheng$^1$, Yixian Wang$^1$, Yin Liu$^1$, Hong Wang$^1$, Huifang Xu$^1$, Ruihua Kang$^1$, Xiaoyang Wang$^1$, Shuzheng Liu$^1$, Shaokai Zhang$^1$

$^1$ The Affiliated Cancer Hospital of Zhengzhou University & Henan Cancer Hospital, Zhengzhou 450008, Chinaã€‚ $^2$ School of Public Health, Lanzhou University.

**Corresponding** toï¼šShaokai Zhangï¼ŒEmail:shaokaizhang\@126.com

**Abstract** 

**Objective** To analyze the 5-year relative survival rate of cancer in the population of Henan Province using cancer registration data. 

**Methods** Cancer cases were extracted from the cancer registration database of Henan Province with the diagnosis date between January 1, 2014 and December 31, 2019, and those diagnosed before 2014 but still alive by December 31, 2019 were included. The follow-up date was set as December 31, 2019. The 5-year relative survival rate of cancer was calculated using the period survival analysis method and the Ederer II method in the R package "periodR". 

**Results** The 5-year cancer relative survival rate in children aged 0-14 in Henan Province was 62.5% during 2017-2019, while that in adults aged 15 and above was 44.2%, age-standardized to 40.7%. The overall cancer 5-year survival rate was higher in females than in males (47.1% vs 34.4%, *P*\<0.01) and in urban areas than in rural areas (46.4% vs 39.2%, *P*\<0.01). Among patients with different cancer sites, thyroid cancer, testicular cancer, and breast cancer had the highest 5-year relative survival rates, which were 86.4%, 74.4%, and 73.1%, respectively. Liver cancer, pancreatic cancer, and lung cancer had the lowest 5-year relative survival rates, which were 19.1%, 20.5%, and 24.3%, respectively. 

**Conclusion** The overall 5-year relative survival rate of cancer in children and adults in Henan Province is still low, and cancer prevention and control strategies and measures should be adjusted and optimized according to the cancer incidence and survival rate data in Henan Province.

**Keywords**: Cancer; cancer control; period survival; 5-year relative survival; Henan
```


## R Markdown {background-color="lightblue"}

> R é€šè¿‡ä¸€ç³»åˆ—åŒ…å®ç°äº†æ–‡å­¦ç¼–ç¨‹çš„ä¸»è¦åŠŸèƒ½ã€‚

:::: {.columns}

::: {.column width="30%"}

- rmarkdown
- knitr
- bookdown
- blogdown
- thesisdown
- posterdown
- distill
- xaringan
- tinytex

:::

::: {.column width="70%"}

```{r}
knitr::include_graphics("images/rmd-packages.png")
```

:::

::::


## Pandoc

> Pandocæ˜¯ä½¿ç”¨Haskellè¯­è¨€ç¼–å†™çš„ä¸€æ¬¾è·¨å¹³å°ã€è‡ªç”±å¼€æºåŠå‘½ä»¤è¡Œç•Œé¢çš„æ ‡è®°è¯­è¨€è½¬æ¢å·¥å…·ï¼Œå¯å®ç°ä¸åŒæ ‡è®°è¯­è¨€é—´çš„æ ¼å¼è½¬æ¢ã€‚


::: {style="font-size: 70%;"}

- HTMLæ ¼å¼ï¼šåŒ…æ‹¬XHTMLï¼ŒHTML5åŠHTML slide
- æ–‡å­—å¤„ç†è½¯ä»¶æ ¼å¼ï¼šåŒ…æ‹¬docxã€odtã€OpenDocument XML
- ç”µå­ä¹¦æ ¼å¼ï¼šåŒ…æ‹¬EPUBï¼ˆç¬¬2ç‰ˆåŠç¬¬3ç‰ˆï¼‰ã€FictionBook2
- æŠ€æœ¯æ–‡æ¡£æ ¼å¼ï¼šåŒ…æ‹¬DocBookã€GNU TexInfoã€Groff manpagesã€Haddock
- é¡µé¢å¸ƒå±€æ ¼å¼ï¼šInDesign ICML
- å¤§çº²å¤„ç†æ ‡è®°è¯­è¨€æ ¼å¼ï¼šOPML
- TeXæ ¼å¼ï¼šåŒ…æ‹¬LaTeXã€ConTeXtã€LaTeX Beamer
- PDFæ ¼å¼ï¼šéœ€è¦LaTeXæ”¯æŒ
- è½»é‡çº§æ ‡è®°è¯­è¨€æ ¼å¼ï¼šåŒ…æ‹¬Markdownã€reStructuredTextã€textileã€Org-Modeã€MediaWikiæ ‡è®°è¯­è¨€ã€AsciiDoc
- è‡ªå®šä¹‰æ ¼å¼ï¼šå¯ä½¿ç”¨luaè‡ªå®šä¹‰è½¬æ¢è§„åˆ™

:::



## Quarto ä¸‹ä¸€ä»£ R Markdown

<br>

> QuartoÂ® is an open-source scientific and technical publishing system built on Pandoc.

<br>

```{r}
knitr::include_graphics("https://quarto.org/docs/get-started/hello/images/rstudio-qmd-how-it-works.png")
```


## Quartoç‰¹ç‚¹

- å®ƒå¯ä»¥ç‹¬ç«‹äºRã€Rstudioæˆ–è€…å…¶ä»–è½¯ä»¶å¦‚pythonç­‰ç¼–ç¨‹æˆ–ç»Ÿè®¡è½¯ä»¶ï¼Œæ”¯æŒåœ¨Macosã€Linuxã€Windowsç³»ç»Ÿè¿è¡Œï¼›
- Quartoç»§æ‰¿äº†ä¸€äº›RmdåŒ…çš„ç‰¹ç‚¹ã€å¦‚blogdownã€bookdownã€xaringanç­‰ï¼›
- åœ¨ç”Ÿæˆwebsiteã€blogã€bookã€slidesç­‰å„ç§æ ¼å¼ä¸­æœ‰äº†ç»Ÿä¸€çš„è¯­æ³•ï¼Œç¼©å°äº†ä½¿ç”¨è€…çš„å­¦ä¹ æˆæœ¬ï¼›
- æ”¯æŒçš„è¯­è¨€åŒ…æ‹¬Rã€Pythonã€Juliaå’ŒObservableï¼›
- quartoæœ‰äº†æ–°çš„æ–‡æ¡£æ ¼å¼ï¼Œæ–‡æ¡£æ‰©å±•åä¸ºâ€œ.qmdâ€, ä»£ç å—é€‰é¡¹çš„å½¢å¼æœ‰äº†å˜åŒ–ã€‚
- æ”¯æŒç§‘æŠ€å†™ä½œçš„ç‰¹å¾ï¼Œå¦‚å…¬å¼ã€å¼•ç”¨ã€äº¤å‰å¼•ç”¨ã€å›¾ã€è¡¨ç­‰ã€‚

## ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ Quarto / R Markdown ?

```{mermaid}
%%| label: fig-1
%%| fig-cap: æŠ¥å‘Šæ’°å†™æµç¨‹
%%| fig-align: center
flowchart LR
  A[(æ•°æ®æ¸…æ´—)] --> B(ç»Ÿè®¡åˆ†æ)
  B --> C{ç»“æœåˆæ­¥è¯„ä¼°}
  C --> B
  C --> D(ç»Ÿè®¡åˆ¶è¡¨)
  D --> E[æŠ¥å‘Šæ’°å†™]
  E -- å‘ç°ä¸åˆç†ç»“æœ --> B
  E --> F[å‡ºç‰ˆæµç¨‹]
  F --> G[ä¸“å®¶æ„è§]
  G -- å»ºè®®é‡æ–°ç»Ÿè®¡ --> B
  G -- ä¸éœ€è¦é‡æ–°ç»Ÿè®¡ --> E
  G --> H[æ­£å¼å‡ºç‰ˆ]
```

:::: {.columns}

::: {.column width="50%"}


:::{.callout-tip}

## å¯èƒ½å­˜åœ¨çš„æƒ…å½¢

- ç»Ÿè®¡åˆ†æ(SASã€Rã€SPSSã€EXCEL)
- æ•°æ®å¯è§†åŒ–å±•ç°(Rã€SASã€EXCEL)
- æ’°å†™æŠ¥å‘Š(WORDã€WPSã€å…¶å®ƒæ–‡å­—å¤„ç†è½¯ä»¶)
- å›¾è¡¨äº¤å‰å¼•ç”¨
- å‚è€ƒæ–‡çŒ®çš„å¼•ç”¨(Zoteroã€Endnoteã€Mendley)

:::

:::

::: {.column width="50%"}

:::{.callout-tip}

## å­˜åœ¨çš„é—®é¢˜

- ç»Ÿè®¡è¿‡ç¨‹ä¸æŠ¥å‘Šæ’°å†™çš„å‰²è£‚
- å­˜åœ¨é‡å¤æ€§å·¥ä½œçš„å¯èƒ½ 

:::

:::

::::


## åº”ç”¨åœºæ™¯

<br>

:::: {.columns}

::: {.column width="30%"}
- ç§‘æŠ€è®ºæ–‡æ’°å†™
- ä¹¦ç±ç¼–å†™
- å¹»ç¯ç‰‡åˆ¶ä½œ
- åšå®¢
- ç½‘ç«™
:::

::: {.column width="70%"}

```{r}
knitr::include_url("https://www.chenq.site/qsight")
```

:::

::::



## åº”ç”¨åœºæ™¯

<br>

:::: {.columns}

::: {.column width="30%"}
- ç§‘æŠ€è®ºæ–‡æ’°å†™
- ä¹¦ç±ç¼–å†™
- å¹»ç¯ç‰‡åˆ¶ä½œ
- åšå®¢
- ç½‘ç«™
:::

::: {.column width="70%"}

```{r}
knitr::include_url("https://www.chenq.site/slides/2023-5-11-system")
```

:::

::::


## åº”ç”¨åœºæ™¯

<br>

:::: {.columns}

::: {.column width="30%"}
- ç§‘æŠ€è®ºæ–‡æ’°å†™
- ä¹¦ç±ç¼–å†™
- å¹»ç¯ç‰‡åˆ¶ä½œ
- åšå®¢
- ç½‘ç«™
:::

::: {.column width="70%"}

```{r}
knitr::include_graphics("images/paper.jpg")
```

:::

::::


## åº”ç”¨åœºæ™¯

<br>

:::: {.columns}

::: {.column width="30%"}
- ç§‘æŠ€è®ºæ–‡æ’°å†™
- ä¹¦ç±ç¼–å†™
- å¹»ç¯ç‰‡åˆ¶ä½œ
- åšå®¢
- ç½‘ç«™
:::

::: {.column width="70%"}

```{r}
knitr::include_url("https://www.chenq.site/report/2021")
```

:::

::::

# è‚¿ç˜¤ç™»è®°æŠ¥å‘Šçš„å®é™…åº”ç”¨åˆ†äº« {background-color="lightblue"}

## Cancer Incidence in Five Continents-IARC

### YAMLå…ƒæ•°æ®è®¾ç½®

```yaml
--- 
title: "æ²³å—çœã€Šäº”å¤§æ´²å‘ç—…ç‡ç¬¬12å·ã€‹æ•°æ®ä¸ŠæŠ¥å®¡æ ¸ç¨‹åº"
subtitle: "ç™»è®°å¤„ï¼š"
author: 
- "2013-2017å¹´"
- "Qiong Chen @ Henan Cancer Center/Henan Cancer Hospital"
date: ""
output:
  prettydoc::html_pretty:
    theme: cayman
    number_section: TRUE
    highlight: github
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
editor_options: 
  chunk_output_type: console
---
```

## Cancer Incidence in Five Continents-IARC

### ä»£ç å—

```{r}
#| eval: false
#| echo: true
knitr::opts_chunk$set(
	echo = FALSE,
	warning = FALSE,
	fig.width=10,
	fig.height=8
)
library(dplyr)
library(knitr)
library(kableExtra)
library(reshape2)
library(ggplot2)
library(tidyr)

period<-20132017

#ç‡çš„ç»Ÿè®¡å­¦æ£€éªŒ
report <- report%>%
  group_by(year,sex,code)%>%
  mutate(y_ics2000=sum(ics2000)/n(),
         a_ics2000=sum((ics2000-sum(ics2000)/n())^2/var_ics2000)/(n()-1),
         a_ics2000=ifelse(a_ics2000<=1,1,a_ics2000),
         z_ics2000=(ics2000-sum(ics2000)/n())^2/(a_ics2000*var_ics2000),
        
         y_dcs2000=sum(dcs2000)/n(),
         a_dcs2000=sum((dcs2000-sum(dcs2000)/n())^2/var_dcs2000)/(n()-1),
         a_dcs2000=ifelse(a_dcs2000<=1,1,a_dcs2000),
         z_dcs2000=(dcs2000-sum(dcs2000)/n())^2/(a_dcs2000*var_dcs2000),
         
         y_iws85=sum(iws85)/n(),
         a_iws85=sum((iws85-sum(iws85)/n())^2/var_iws85)/(n()-1),
         a_iws85=ifelse(a_iws85<=1,1,a_iws85),
         z_iws85=(iws85-sum(iws85)/n())^2/(a_iws85*var_iws85),
         
         y_dws85=sum(dws85)/n(),
         a_dws85=sum((dws85-sum(dws85)/n())^2/var_dws85)/(n()-1),
         a_dws85=ifelse(a_dws85<=1,1,a_dws85),
         z_dws85=(dws85-sum(dws85)/n())^2/(a_dws85*var_dws85),
         
         mvn=b5+b6+b7,
         p1=(b5+b6+b7)/fhj,
         p=sum(mvn)/sum(fhj),
         a_mv=sum((mvn-p*fhj)^2/(fhj*p1*(1-p1)))/(n()-1),
         z_mv=(mvn-p*fhj)^2/(a_mv*p1*(1-p1)*fhj),
        
         a_mi=sum(shj)/sum(fhj),
         aa_mi=sum((shj-a_mi*fhj)^2/((shj+fhj)*a_mi))/(n()-1),
         z_mi=(shj-a_mi*fhj)^2/(aa_mi*(shj+fhj)*a_mi),
         

diff2_ics2000=ifelse(z_ics2000>3.84 & ics2000/y_ics2000>1, paste0(">","(",round(ics2000/y_ics2000,1),")"),
              ifelse(z_ics2000>3.84 & ics2000/y_ics2000<1, paste0("<","(",round(ics2000/y_ics2000,1),")"),"")),
diff2_dcs2000=ifelse(z_dcs2000>3.84 & dcs2000/y_dcs2000>1, paste0(">","(",round(dcs2000/y_dcs2000,1),")"),
              ifelse(z_dcs2000>3.84 & dcs2000/y_dcs2000<1, paste0("<","(",round(dcs2000/y_dcs2000,1),")"),"")),
diff2_iws85=ifelse(z_iws85>3.84 & iws85/y_iws85>1, paste0(">","(",round(iws85/y_iws85,1),")"),
            ifelse(z_iws85>3.84 & iws85/y_iws85<1, paste0("<","(",round(iws85/y_iws85,1),")"),"")),
diff2_dws85=ifelse(z_dws85>3.84 & dws85/y_dws85>1, paste0(">","(",round(dws85/y_dws85,1),")"),
            ifelse(z_dws85>3.84 & dws85/y_dws85<1, paste0("<","(",round(dws85/y_dws85,1),")"),"")),
         
         diff_mi=ifelse(z_mi>3.84 & mi/a_mi>1,paste0(">","(",round(mi/a_mi,1),")"),
                        ifelse(z_mi>3.84 & mi/a_mi<1,paste0("<","(",round(mi/a_mi,1),")"),"")),
         diff_mv=ifelse(z_mv>3.84 & p1/p>1,paste0(">","(",round(p1/p,1),")"),
                        ifelse(z_mv>3.84 & p1/p<1,paste0("<","(",round(p1/p,1),")"),""))
         
         )%>%
  ungroup()%>%
  select(-a_ics2000,-z_ics2000,-a_dcs2000,-z_dcs2000,-y_iws85,-a_iws85,-z_iws85,-y_dws85,-a_dws85,-z_dws85,-mvn,-a_mv,-z_mv,-aa_mi,-z_mi)



quality <- haven::read_sas("Y:/CanReg/statistic/code/create_report/codedata/quality.sas7bdat")
quality <- quality %>% mutate(city=ifelse(city==0,2,1),city=as.character(city))
site <- unique(registry[registry$name==state,c("areacode")]$areacode)

#levels <- c(110,104,103,106,112,105,113,120,115,116,119,122)
#labels <- c("è‚º","èƒƒ","é£Ÿç®¡","è‚","ä¹³æˆ¿","ç»“ç›´è‚ ","å®«é¢ˆ","ç”²çŠ¶è…º","åµå·¢","å‰åˆ—è…º","è„‘","ç™½è¡€ç—…")

levels=c(122,121,120,119,113,112,105,103,106,104,110,62)
labels=c("ç™½è¡€ç—…","æ·‹å·´ç˜¤","ç”²çŠ¶è…º","è„‘","å®«é¢ˆ","ä¹³æˆ¿","ç»“ç›´è‚ ","é£Ÿç®¡","è‚","èƒƒ","è‚º","æ‰€æœ‰éƒ¨ä½")


years<-report[report$areacode==site&!(report$year%in%c("20132017","20182022")),c("year")]$year
max<-as.numeric(max(years))
min<-as.numeric(min(years))
caption2<-paste0("å›¾ä¸­>(O/E)æˆ–<(O/E)è¡¨ç¤ºç™»è®°å¤„æŒ‡æ ‡ä¸åŒæœŸæ²³å—çœå„ç™»è®°å¤„çš„å¹³å‡å€¼ç›¸æ¯”å…·æœ‰ç»Ÿè®¡å­¦æ„ä¹‰\n(O/E)è¡¨ç¤ºç™»è®°å¤„æŒ‡æ ‡ä¸å¹³å‡å€¼æŒ‡æ ‡çš„æ¯”å€¼")


pop <- report%>%filter(areacode==site,sex=="åˆè®¡",code==62,year=="2017")%>%select(rhj)
pop <-pop$rhj

mv <- report%>%filter(areacode==site,sex=="åˆè®¡",code==62,year=="20132017")%>%select(mv)
mv <-mv$mv

mi <- report%>%filter(areacode==site,sex=="åˆè®¡",code==62,year=="20132017")%>%select(mi)
mi <-mi$mi

cr_color_block <- function() {
  theme_classic()+
  theme(
    legend.title= element_blank(),
    legend.position= "top",
    strip.text= element_text(size=10,face="bold.italic"),
    strip.background= element_rect(color="white",size=0),
    axis.line= element_blank(),
    axis.ticks= element_blank(),
    axis.title= element_blank(),
    axis.text= element_text(size=11,face="bold.italic"),
    axis.text.x= element_text(size=11,face="bold.italic",angle = 90),
    plot.title= element_text(face="bold", size=14, hjust = 0.5),
    plot.subtitle = element_text(face="bold",size=10,hjust=0.5),
    plot.caption = element_text(size=8)
  )
}


cr_grid <- function() {
  theme_light()+
  theme(
    legend.title= element_blank(),
    legend.position= "bottom",
    strip.text= element_text(size=10,face="bold.italic"),
    strip.background= element_rect(color="white",size=0),
    axis.line.y= element_blank(),
    axis.ticks.y= element_blank(),
    axis.title= element_blank(),
    axis.text= element_text(size=9,face="bold.italic"),
    plot.title= element_text(face="bold", size=14, hjust = 0.5),
    plot.subtitle=element_text(face="bold.italic",size=12,hjust=0.5),
    # add border 1)
    panel.border = element_rect(colour = "blue", fill = NA, linetype = 2),
    # color background 2)
    panel.background = element_rect(fill = "aliceblue"),
    # modify grid 3)
    panel.grid.major.x = element_line(colour = "steelblue", linetype = 3, size = 0.5),
    panel.grid.minor.x = element_blank(),
    panel.grid.major.y =  element_line(colour = "steelblue", linetype = 3, size = 0.5),
    panel.grid.minor.y = element_blank()
  )
}

```

## Cancer Incidence in Five Continents-IARC

### ä»£ç å—

```{r}
#| eval: false
#| echo: true
for (i in min:max) {
 report %>%
  filter(areacode==site, code==62, !(sex=="åˆè®¡"), year==i)%>%
  select(year,sex,r0:r85)%>%
  gather("agegrp","rks",-year,-sex)%>%
  mutate(agegrp=as.numeric(gsub("[^0-9]", "", agegrp)),
         rks=ifelse(sex=="ç”·æ€§",-rks,rks),
         agegrp=factor(agegrp,labels = c("0","1-4","5-9","10-14","15-19","20-24","25-29","30-34","35-39","40-44","45-49","50-54","55-59","60-64","65-69","70-74","75-79","80-84","85+")))%>%
  group_by(sex)%>%
  mutate(rks=round(rks/sum(rks),2),
         rks=ifelse(sex=="ç”·æ€§",-rks,rks))%>%
  ggplot(aes(x=factor(agegrp),y=rks,fill=sex)) +
  geom_bar(stat = "identity",position = "identity",color="black",size=0.25)+
  coord_flip()+
  theme_classic()+
  xlab("")+
  ylab("")+
  scale_y_continuous(limits = c(-0.12,0.12),breaks=seq(-0.12,0.12,0.02),labels = function(x) paste0(abs(x) * 100, '%'))+
  labs(title="å†å¹´äººå£é‡‘å­—å¡”å˜åŒ–æƒ…å†µ",subtitle=paste(i))+
  theme(legend.position = c(0.1,0.9),
        legend.title = element_blank(),
        strip.text = element_text(size=10, face="bold.italic"),
        strip.background = element_rect(color="white", size=0),
        axis.text=element_text(size=10),
        axis.title=element_text(size=12, face="bold"),
        plot.title = element_text(face="bold", size=14, hjust = 0.5),
        plot.subtitle=element_text(face="bold",size=13,hjust=0.8,colour="tomato"))->p
  plot(p)
}

```

## Cancer Incidence in Five Continents-IARC

### Markdownæ–‡æœ¬

```md
# åŸºæœ¬æƒ…å†µä»‹ç»

è‚¿ç˜¤ç™»è®°å¤„æ‹Ÿä¸ŠæŠ¥è‡³å¹´è‚¿ç˜¤ç™»è®°æ•°æ®è‡³äº”å¤§æ´²å‘ç—…ç‡ç¬¬12å·ã€‚

æ²³å—çœè‚¿ç˜¤ç™»è®°å¤„æŒ‰ç…§ã€Šäº”å¤§æ´²å‘ç—…ç‡ã€‹æ”¶å½•æ•°æ®å®¡æ ¸æ ‡å‡†å¯¹æ²³å—çœå„ç™»è®°å¤„æ‹Ÿä¸ŠæŠ¥å¹´ä»½èŒƒå›´çš„æ•°æ®è´¨é‡è¿›è¡Œäº†å›¾å½¢åŒ–å±•ç¤ºï¼Œå„ç™»è®°å¤„å¯æ ¹æ®å®¡æ ¸ç»“æœå®Œå–„æ ¸å®æœ¬ç™»è®°å¤„æ•°æ®ï¼

>æœ¬ç»“æœåˆ†å¦‚ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼š

>1. åŸºæœ¬æƒ…å†µä»‹ç» 
>1. äººå£æ•°æ®å®¡æ ¸
>1. æ€»ä½“ç™Œç—‡å‘ç—…æ­»äº¡æƒ…å†µ
>1. ä¸»è¦éƒ¨ä½ç™Œç—‡å‘ç—…æ­»äº¡æƒ…å†µ
>1. å¹´é¾„åˆ«ç‡
>1. å„¿ç«¥è‚¿ç˜¤å‘ç—…ç‡/æ­»äº¡ç‡
>1. ä¸»è¦è´¨é‡æ§åˆ¶æŒ‡æ ‡æƒ…å†µ(ç™»è®°ç™Œç§æ•°ã€MV%ã€M:Iã€DCO%)

# äººå£æ•°æ®å®¡æ ¸

>äººå£æ•°æ®è´¨é‡å¯¹äºè‚¿ç˜¤ç™»è®°æ•°æ®è´¨é‡è‡³å…³é‡è¦ï¼Œæœ¬ç¨‹åºå¯¹äºäººå£æ•°æ®çš„å®¡æ ¸ä»**äººå£æ€»æ•°**ã€**äººå£æ€§åˆ«æ¯”ä¾‹**ã€ä»¥>åŠ**äººå£é‡‘å­—å¡”**ç­‰ä¸‰ä¸ªæ–¹é¢è¿›è¡Œã€‚

## äººå£æ€»æ•°å˜åŒ–æƒ…å†µ

```

## Cancer Incidence in Five Continents-IARC

```{r}

knitr::include_url("https://www.chenq.site/slides/2023-5-16-canreg-report/example.html",height = "600px")
```

## Cancer Incidence in Five Continents-IARC

### æŠ¥å‘Šè¾“å‡ºçš„æ‰¹é‡åŒ–

```{r}
#| eval: false
#| echo: true

###äº”å¤§æ´²æ•°æ®å®¡æ ¸ç¨‹åº#
library(dplyr)
library(RODBC)
state.name<-c("å¼€å°å¸‚ç¥¥ç¬¦åŒº","æ´›é˜³å¸‚åŸåŒº","å­Ÿæ´¥å¿","æ–°å®‰å¿","æ ¾å·å¿","åµ©å¿","æ±é˜³å¿",
              "å®œé˜³å¿","åƒå¸ˆå¸‚","é²å±±å¿","æ—å·å¸‚","é¹¤å£å¸‚åŸåŒº","è¾‰å¿å¸‚","æ¿®é˜³å¸‚åé¾™åŒº",
              "æ¿®é˜³å¿","æ¼¯æ²³å¸‚éƒ¾åŸåŒº","æ¼¯æ²³å¸‚å¬é™µåŒº","æ¼¯æ²³å¸‚æºæ±‡åŒº","ä¸‰é—¨å³¡å¸‚æ¹–æ»¨åŒº","æ–¹åŸå¿",
              "å†…ä¹¡å¿","ç¢å¿","è™åŸå¿","ç½—å±±å¿","æ²ˆä¸˜å¿","éƒ¸åŸå¿","è¥¿å¹³å¿","æµæºå¸‚")

db<-file.path("../create_report/Codedata/code.mdb") 
channel<-odbcConnectAccess2007(db)
data<-sqlFetch(channel,"registry")
data1<-data%>%filter(!(is.na(CI512)))

report<-haven::read_sas("../create_report/tmpdata/report.sas7bdat")
pro<-report%>%filter(name %in% c("å…¨çœ"))
report<-report%>%filter((name %in% state.name))
registry<- report%>%
  select(areacode,name)%>%
  filter(!(substr(areacode,1,1)=="9"))%>%
  distinct(.keep_all = TRUE)

for (state in state.name) {
  areacode<-registry[registry$name==state,c("areacode")]$areacode
  dir.create(paste0("./Output/CI5check/",areacode,state))
  rmarkdown::render(
    input = './Rmd_template/CI5check.Rmd',
    output_file = 'index.html',
    output_dir = paste0("./Output/CI5check/",areacode,state)
  )
}
```

## Cancer Incidence in Five Continents-IARC

### æŠ¥å‘Šè¾“å‡ºçš„æ‰¹é‡åŒ–

:::: {.columns}

::: {.column width="50%"}

```{r}
knitr::include_graphics("images/list.png")
```

:::

::: {.column width="50%"}

```{r}
knitr::include_graphics("images/list2.png")
```

:::

::::


## åŸºäºbookdownæ’°å†™ã€Šè‚¿ç˜¤ç™»è®°å¹´æŠ¥ã€‹

### _bookdown.yml

```{r}
#| eval: false
#| echo: true
book_filename: bookdown
clean: [packages.bib, bookdown.bbl]
delete_merged_file: true
new_session: true
language:
  label:
    fig: "å›¾ "
    tab: "è¡¨ "
  ui:
    edit: "ç¼–è¾‘"
    chapter_name: ["ç¬¬ ", " ç« "]
```

## åŸºäºbookdownæ’°å†™ã€Šè‚¿ç˜¤ç™»è®°å¹´æŠ¥ã€‹

### _output.yml

```{r}
#| eval: false
#| echo: true
bookdown::gitbook:
  css: css/style.css
  config:
    toc:
      collapse: none
      before: |
        <li><a href="./">2021æ²³å—çœè‚¿ç˜¤ç™»è®°å¹´æŠ¥</a></li>
      after: |
        <li><a href="https://chenq.site" target="blank">Qiong Chen</a></li>
    search: yes
    sharing:
      github: yes
      weibo: yes
bookdown::markdown_document2:
  base_format: officedown::rdocx_document
  lists:
    ol.style: Default ol
    ul.style: Default ul
  tables:
    conditional:
      first_row: true
      first_column: true
      last_row: false
      last_column: false
      no_hband: false
      no_vband: true
```

## åŸºäºbookdownæ’°å†™ã€Šè‚¿ç˜¤ç™»è®°å¹´æŠ¥ã€‹
### yamlå…ƒæ•°æ®

```yaml
--- 
title: "2022æ²³å—çœè‚¿ç˜¤ç™»è®°å¹´æŠ¥"
author: "ä¸»ç¼– å¼ å»ºåŠŸ å¼ éŸ¶å‡¯"
date: 2022-4-1
output:
  html_document:
    df_print: paged
  bookdown::word_document2: 
    toc: yes
    reference_docx: "./data/format.docx"
  pdf_document: default
always_allow_html: yes
bibliography:
- book.bib
- packages.bib
description: æ²³å—çœè‚¿ç˜¤ç™»è®°å¹´æŠ¥
documentclass: ctexbook
colorlinks: yes
site: bookdown::bookdown_site
biblio-style: apalike
---
```

## åŸºäºbookdownæ’°å†™ã€Šè‚¿ç˜¤ç™»è®°å¹´æŠ¥ã€‹
### æŠ¥å‘Šæ–‡æœ¬æ’°å†™



:::: {.columns}

::: {.column width="30%"}

- index.Rmd
- 01summary.Rmd
- 02-method.Rmd
- 03-quality.Rmd
- 04-total_cancer.Rmd
- 05-eachsite.Rmd

:::

::: {.column width="70%"}

```{r}
knitr::include_graphics("images/page.jpg")
```

:::

::::

## åŸºäºbookdownæ’°å†™ã€Šè‚¿ç˜¤ç™»è®°å¹´æŠ¥ã€‹
### å›¾è¡¨æ‰¹é‡ç”Ÿæˆ

```{r}
#| eval: false
#| echo: true

#####
# å¹´åº¦æ•°æ®å®¡æ ¸##
#####

library(dplyr)
library(reshape2)
require(ggplot2)
library(ggsci)
library(cowplot)
library(stringr)
library(ggpubr)
library(extrafont)
#font_import() # å¯¼å…¥ç³»ç»Ÿä¸­å·²ç»å®‰è£…çš„å­—ä½“ï¼ŒåŒ…æ‹¬ä¸­æ–‡å­—ä½“
# æ¢å¤é»˜è®¤çš„ä¸»é¢˜è®¾ç½®
loadfonts() # åŠ è½½å·²ç»å¯¼å…¥çš„å­—ä½“
#font <- "SimHei" # æŒ‡å®šä¸­æ–‡å­—ä½“ï¼Œè¿™é‡Œä½¿ç”¨é»‘ä½“ï¼ˆSimHeiï¼‰
theme_set(theme_bw(base_family = "STKaiti"))



####
#ç”Ÿæˆç¬¬äº”ç« å„ç™Œç§å¹´é¾„åˆ«ç‡å›¾#
###

age_specific_rate <- report%>%
  filter(city=="33",code>=101&code<=122|code==62)%>%
  select(areacode,sex,code,icd,by,i0:i85,d0:d85)%>%
  melt(id.vars=c("areacode","sex","code","icd","by"),
       variable.name = "type",
       value.name="rate") %>%
  mutate(order=code-100,
         age=as.numeric(ifelse(substr(type,1,1)=="i",gsub("i","",type),gsub("d","",type))),
         type=ifelse(substr(type,1,1)=="i","incidence","mortality"))

age_specific_rate2<-age_specific_rate%>%
  filter(code==62)%>%
  mutate(sex=ifelse(areacode=="510000",paste0("åŸå¸‚",sex),
                    ifelse(areacode=="520000",paste0("å†œæ‘",sex),sex)))%>%
  filter(!(areacode=="500000"))%>%
  mutate(areacode="530000")


age_specific_rate<-age_specific_rate%>%
  filter(!((code %in% 112:115)&(sex %in% c("åˆè®¡","ç”·æ€§"))),!(code==116&sex%in%c("åˆè®¡","å¥³æ€§")))

Age_specific_rate<-rbind(age_specific_rate,age_specific_rate2)%>%
  mutate(order=ifelse(order==-38,0,order))%>%
  filter(!(sex %in% c("åŸå¸‚åˆè®¡","å†œæ‘åˆè®¡")))


for (i in 0:22){
  plot <- Age_specific_rate[Age_specific_rate$order==i,]
  if (i %in% c(12:16)){
    ct <- plot%>%mutate(areacode=factor(areacode,labels =c("å…¨çœ","åŸå¸‚","å†œæ‘")))%>%group_by(type)%>%group_split()
  } else {
    ct <- plot%>%group_by(type,areacode)%>%group_split()
  }

  icd<-plot[1,c("icd")]

  p<- lapply(ct,function(x) {
    type<-x[1,c("type")]
    if (i %in% c(12:16)){
      p<-ggplot(x,aes(x=age,y=rate,group=areacode))+geom_line(aes(colour=areacode),size=1.2)
    } else {
      p<-ggplot(x,aes(x=age,y=rate,group=sex))+geom_line(aes(colour=sex),size=1.2)
    }
    p<-p+scale_x_continuous(breaks = c(0,10,20,30,40,50,60,70,80))+
      theme_classic()+
      xlab("å¹´é¾„(å²)")+
      ylab(ifelse(type=="incidence",expression(paste("å¹´é¾„åˆ«å‘ç—…ç‡ï¼ˆ1/", 10^5,")")),expression(paste("å¹´é¾„åˆ«æ­»äº¡ç‡ï¼ˆ1/", 10^5,")"))))+
      scale_color_lancet()+
      theme(
        text=element_text(family = "STKaiti"),
        legend.position=c(0.2,0.8),
        legend.title=element_blank(),
        axis.text = element_text(face="bold"),
        axis.title.y = element_text(face="bold"),
        axis.line=element_line(size=0.5,colour="black"),
        axis.ticks = element_line(size=0.5,colour="black"))

  })

  if (i==0){
    p_com1<-plot_grid(p[[1]],p[[2]],p[[3]],p[[4]],labels=c("å…¨çœ","åŸå¸‚","å†œæ‘","åŸå¸‚å’Œå†œæ‘"),label_size=13,label_x=0.35,align="hv",ncol=2,nrow=2,byrow=TRUE)
    p_com2<-plot_grid(p[[5]],p[[6]],p[[7]],p[[8]],labels=c("å…¨çœ","åŸå¸‚","å†œæ‘","åŸå¸‚å’Œå†œæ‘"),label_size=13,label_x=0.35,align="hv",ncol=2,nrow=2,byrow=TRUE)
    loca2 <- paste("./images/Chapter4-","2.png",sep="")
    loca3 <- paste("./images/Chapter4-","6.png",sep="")
    ggsave(loca2,p_com1,width=8,height=6.6,device="png")
    ggsave(loca3,p_com2,width=8,height=6.6,device="png")
  } else if(i %in% c(12:16)){
    p_comx<-plot_grid(p[[1]],p[[2]],labels=c("å‘ç—…","æ­»äº¡"), lable_size=13,label_x=0.35,ncol=2,nrow=1,align="hv")
    loca <- paste("./images/Chapter5-",i,"-1.png",sep="")
    ggsave(loca,p_comx,width=8,height=3.3,device="png")
  }
  else {
    p_com<-plot_grid(p[[1]],p[[4]],p[[2]],p[[5]],p[[3]],p[[6]],labels=c("å…¨çœ å‘ç—…","å…¨çœ æ­»äº¡","åŸå¸‚ å‘ç—…","åŸå¸‚ æ­»äº¡","å†œæ‘ å‘ç—…","å†œæ‘ æ­»äº¡"),label_size=13,label_x=0.35,align="hv",ncol=2,nrow=3,byrow=TRUE)
    #p_com<-add_sub(p_com, paste("ICD10:",icd),x=0.07, y=0,vjust=0,hjust=0)
    loca <- paste("./images/Chapter5-",i,"-1.png",sep="")
    ggsave(loca,p_com,width=8,height=10,device="png")
  }
}

####
#ç”Ÿæˆç¬¬äº”ç« å„ç™Œç§ä¸åŒåœ°åŒºå‘ç—…ç‡å’Œæ­»äº¡ç‡é¡ºä½å›¾#
####

area_rate <- report%>%
  filter(!(city=="33"),code>=101&code<=122)%>%
  select(areacode,city,name,sex,code,icd,by,ics2000,dcs2000)%>%
  melt(id.vars=c("areacode","city","name","sex","code","icd","by"),
       variable.name = "type",
       value.name="rate") %>%
  mutate(order=code-100,
         city=ifelse(city==11,1,city),
         type=ifelse(type=="ics2000","å‘ç—…ç‡","æ­»äº¡ç‡"),
         rate=ifelse(sex=="ç”·æ€§",-rate,rate),
         )%>%
  filter(!((code %in% 112:115)& sex %in% c("åˆè®¡","ç”·æ€§")),
         !(code==116&sex%in%c("åˆè®¡","å¥³æ€§")))

#è‡ªå®šä¹‰ä¸»é¢˜
theme_nb <- function(..., bg='white'){
  theme_classic(...) +
    theme(
      text=element_text(family = "STKaiti"),
      legend.position=c(0.7,0.1),
      legend.title=element_blank(),
      axis.line.y=element_blank(),
      axis.title.y =element_blank(),
      axis.ticks.y = element_blank(),
      axis.text.x = element_text(size=12),
      axis.text.y = element_text(size=12),
      legend.text = element_text(size=12),
      axis.title.x =element_text(face="bold",size=14))
}

for (i in c(1:22)){
  plot <- area_rate[area_rate$order==i,]
  ct <- plot%>%group_by(city)%>%group_split()

  icd<-plot[1,c("icd")]

  if (i %in% c(1:11,17:22)) {
    p<- lapply(ct,function(x) {
      top_value <-  max(abs(x$rate))

      xx <-x%>%filter(sex=="å¥³æ€§")%>%
        arrange(type,rate)%>%
        mutate(name=factor(name,unique(name)),type=factor(type,levels=c("æ­»äº¡ç‡","å‘ç—…ç‡")))
      p2<-ggplot(data=xx,aes(y=name))+
        geom_bar(aes(x=rate,fill=factor(type)),stat = "identity",position = "dodge")+
        scale_fill_manual(values=c('#e31a1c','#4169E1'))+
        scale_x_continuous(position = "top",limits=c(0,top_value))+
        xlab(expression(paste("å¥³æ€§ç‡ï¼ˆ1/", 10^5,"ï¼‰")))+
        scale_y_discrete(position = "right")+
        theme_nb()

      xx <-x%>%filter(sex=="ç”·æ€§")%>%mutate(rate2=abs(rate))%>%arrange(type,rate2)%>%mutate(name=factor(name,unique(name)),type=factor(type,levels=c("æ­»äº¡ç‡","å‘ç—…ç‡")))
      p1<-ggplot(data=xx,aes(x=name))+
        geom_bar(aes(y=rate,fill=factor(type)),stat = "identity",position = "dodge")+
        scale_fill_manual(values=c('#e31a1c','#4169E1'))+
        scale_y_continuous(position = "right",limits=c(-top_value,0),labels=abs)+
        ylab(expression(paste("ç”·æ€§ç‡ï¼ˆ1/", 10^5,"ï¼‰")))+
        coord_flip()+
        theme_nb()+
        theme(legend.position="none")
      p3<-plot_grid(p1,p2,labels=c("",""),ncol=2)
      return(p3)
    })

  } else {
    #åˆ¶ä½œå•æ€§åˆ«ç™Œç§å›¾
    p<- lapply(ct,function(x) {
      top_value <-  max(abs(x$rate))
      xx <-x%>%mutate(rate2=abs(rate))%>%arrange(type,rate2)%>%mutate(name=factor(name,unique(name)),type=factor(type,levels=c("æ­»äº¡ç‡","å‘ç—…ç‡")))
      px<-ggplot(data=xx,mapping = aes(y=name))+
        geom_bar(mapping=aes(x=rate2,fill=factor(type)),stat = "identity",position = "dodge")+
        scale_fill_manual(values=c('#e31a1c','#4169E1'))+
        scale_x_continuous(position = "top",limits=c(0,top_value))+
        scale_y_discrete(position = "left")+
        xlab(expression(paste("ä¸­æ ‡ç‡ï¼ˆ1/", 10^5,"ï¼‰")))+
        theme_nb()
      return(px)
    })
  }

  loca2 <- paste("./images/Chapter5-",i,"-2.png",sep="")
  loca3 <- paste("./images/Chapter5-",i,"-3.png",sep="")
  ggsave(loca2,p[[1]],width=8,height=4,device="png")
  ggsave(loca3,p[[2]],width=8,height=10,device="png")
}



####
#ç”Ÿæˆç¬¬å››ç«  å‰10è‚¿ç˜¤ é¡ºä½åŠæ„æˆå›¾#
####

t1 <- report%>%
  filter( city=="33",code>=101&code<=122)%>%
  select(areacode,name,sex,code,icd,by,ihj,fcon)%>%
  mutate(type="incidence")%>%
  rename(rate=ihj,constitute=fcon)

t2 <- report%>%
  filter( city=="33",code>=101&code<=122)%>%
  select(areacode,name,sex,code,icd,by,dhj,scon)%>%
  mutate(type="mortality")%>%
  rename(rate=dhj,constitute=scon)

total_rank<-rbind(t1,t2)%>%
  mutate(by=ifelse(code==110,"è‚º",
                   ifelse(code==119,"è„‘",
                          ifelse(code==105,"ç»“ç›´è‚ ",
                                 ifelse(code==107,"èƒ†å›Š",
                                        ifelse(code==117,"è‚¾",
                                               ifelse(code==121,"æ·‹å·´ç˜¤",by)))))),
         cate=paste0(by,"(",icd,")"),
         cate=ifelse(code==121,"æ·‹å·´ç˜¤",cate),
         sex=factor(sex,levels=c("åˆè®¡","ç”·æ€§","å¥³æ€§"),labels=c("åˆè®¡","ç”·æ€§","å¥³æ€§")))


mycolor<- c('#1f78b4','#a6cee3','#33a02c','#b2df8a','#e31a1c','#fb9a99','#ff7f00','#fdbf6f','#6a3d9a','#cab2d6','#ffff99')

for (i in c("incidence","mortality")) {
  for (j in c("å…¨çœ","åŸå¸‚åœ°åŒº","å†œæ‘åœ°åŒº")) {
    plot <- total_rank[total_rank$type==i & total_rank$name==j,]
    ct <- plot%>%group_by(sex)%>%group_split()
    p<- lapply(ct,function(x) {

      xx <-x%>%arrange(rate)%>%mutate(cate=factor(cate,unique(cate)))%>%slice(13:22)
      yy<-ggplot(xx,aes(y=cate))+geom_bar(aes(x=rate),fill=ifelse(i=="incidence","#1f78b4","#e31a1c"),stat = "identity")+theme_void()+
        scale_x_continuous(position = "top")+
        xlab(ifelse(i=="incidence",expression(paste("å‘ç—…ç‡ï¼ˆ1/", 10^5,")")),expression(paste("æ­»äº¡ç‡ï¼ˆ1/", 10^5,")"))))+
        scale_y_discrete(position = "left",labels=function(x) str_wrap(x, width=20))+
        theme(
          #plot.background = element_rect(fill="white",color="white"),
          text=element_text(family = "STKaiti"),
          axis.text.x = element_text(size=9),
          axis.text.y = element_text(size=9),
          axis.line.y=element_blank(),
          axis.title.y =element_blank(),
          axis.title.x =element_text(face="bold",size=12),
          axis.ticks.y = element_blank()
        )


      xx <-xx%>%arrange(desc(constitute))%>%mutate(cate=factor(cate,unique(cate)))
      xx2<-xx%>%mutate(constitute=round(100-sum(constitute),2))%>%
        distinct(areacode,name,sex,constitute,type)%>%
        mutate(cate="å…¶å®ƒ",code=62,by="å…¶å®ƒ",rate=50,icd="other")
      xx<-rbind(xx,xx2)

      zz <- ggplot(xx,aes(x="",y=constitute,fill=cate))+
        geom_bar(width=1,stat="identity",color="white")+
        coord_polar("y",start=0)+
        theme_void()+
        scale_fill_manual(values= mycolor)+
        #geom_text(aes(x=1.2,label=as.character(constitute)),position = position_stack(vjust=0.5),size=2)+
        theme(
          #plot.background = element_rect(fill="white",color="white"),
          text=element_text(family = "STKaiti"),
          legend.title=element_blank(),
          legend.text = element_text(size = 9),
          legend.position ="right",
          legend.direction = "vertical",
          axis.title.x = element_blank(),
          axis.title.y = element_blank(),
          panel.border = element_blank(),
          panel.grid=element_blank(),
          plot.margin = unit(c(0,1,0,0), "lines"),
          axis.ticks = element_blank(),
          plot.title=element_text(size=14, face="bold")
        )

      com1<-plot_grid(yy,zz,ncol=2,labels=c("","æ„æˆ"),label_x=0.2,label_y=0.2,label_size=12,rel_widths=c(1,1))
      return(com1)
    })

    pp<-plot_grid(p[[1]],p[[2]],p[[3]],ncol=1,labels=c("åˆè®¡","ç”·æ€§","å¥³æ€§"),label_size=13,label_x=0.45,align="hv")

    kk<- ifelse(i=="incidence" & j=="å…¨çœ",3,
                ifelse(i=="incidence" & j=="åŸå¸‚åœ°åŒº",4,
                       ifelse(i=="incidence" & j=="å†œæ‘åœ°åŒº",5,
                              ifelse(i=="mortality" & j=="å…¨çœ",7,
                                     ifelse(i=="mortality" & j=="åŸå¸‚åœ°åŒº",8,
                                            ifelse(i=="mortality" & j=="å†œæ‘åœ°åŒº",9,))))))

    loca2 <- paste("./images/Chapter4-",kk,".png",sep="")
    ggsave(loca2,pp,width=6,height=8,device = "png")

  }}
```

## åŸºäºbookdownæ’°å†™ã€Šè‚¿ç˜¤ç™»è®°å¹´æŠ¥ã€‹
### å›¾è¡¨æ‰¹é‡ç”Ÿæˆ

```{r}
knitr::include_graphics("images/pics.jpg")
```

## åŸºäºbookdownæ’°å†™ã€Šè‚¿ç˜¤ç™»è®°å¹´æŠ¥ã€‹

```{r}
knitr::include_url("https://www.chenq.site/report/2021/")
```


## å­¦ä¹ èµ„æº

- [R Markdown](https://rmarkdown.rstudio.com)
- [bookdown](https://bookdown.org/yihui/bookdown/)
- [Quartoå®˜ç½‘](https://quarto.org)
- [Github: Awesome-quarto](https://github.com/mcanouil/awesome-quarto)
- [Revealjs slides](https://rstudio-conf-2022.github.io/get-started-quarto/materials/05-presentations.html#/presentations)
- [ç»Ÿè®¡ä¹‹éƒ½](https://cosx.org/)

# è°¢ è°¢ å…³ æ³¨ ! {background-color="lightblue"}

é™ˆ ç¼

chenq08@126.com

{{< qrcode https://www.chenq.site/qsight qr2 width=60 height=60 colorDark='#0011bb' >}}