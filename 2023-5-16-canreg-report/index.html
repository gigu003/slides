<!DOCTYPE html>
<html lang="en"><head>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-html/tabby.min.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-html-68b329da9893e34099c7d8ad5cb9c940.min.css" rel="stylesheet" append-hash="true" data-mode="light">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-79bb3942e891885f9f7af119cd221462.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/quarto-contrib/reveal-header-1.0.0/add_header.js" defer="true"></script>
<link href="../site_libs/quarto-contrib/reveal-header-1.0.0/add_header.css" rel="stylesheet">
<link href="../site_libs/quarto-contrib/grid-no-htext-1.0.0/grid_no_htext.css" rel="stylesheet">
<script src="../site_libs/quarto-contrib/qrcodejs-v1.0.0/qrcode.js"></script><meta charset="utf-8">
  <meta name="generator" content="quarto-1.6.9">

  <meta name="author" content="陈琼">
  <title>普癌新声 – R语言促进高效率肿瘤登记报告</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="../site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="../site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; font-weight: bold; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="../site_libs/revealjs/dist/theme/quarto-21697dbe75926e491dc6ba711266e54b.css">
  <link href="../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">

  .callout {
    margin-top: 1em;
    margin-bottom: 1em;  
    border-radius: .25rem;
  }

  .callout.callout-style-simple { 
    padding: 0em 0.5em;
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
    display: flex;
  }

  .callout.callout-style-default {
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
  }

  .callout .callout-body-container {
    flex-grow: 1;
  }

  .callout.callout-style-simple .callout-body {
    font-size: 1rem;
    font-weight: 400;
  }

  .callout.callout-style-default .callout-body {
    font-size: 0.9rem;
    font-weight: 400;
  }

  .callout.callout-titled.callout-style-simple .callout-body {
    margin-top: 0.2em;
  }

  .callout:not(.callout-titled) .callout-body {
      display: flex;
  }

  .callout:not(.no-icon).callout-titled.callout-style-simple .callout-content {
    padding-left: 1.6em;
  }

  .callout.callout-titled .callout-header {
    padding-top: 0.2em;
    margin-bottom: -0.2em;
  }

  .callout.callout-titled .callout-title  p {
    margin-top: 0.5em;
    margin-bottom: 0.5em;
  }
    
  .callout.callout-titled.callout-style-simple .callout-content  p {
    margin-top: 0;
  }

  .callout.callout-titled.callout-style-default .callout-content  p {
    margin-top: 0.7em;
  }

  .callout.callout-style-simple div.callout-title {
    border-bottom: none;
    font-size: .9rem;
    font-weight: 600;
    opacity: 75%;
  }

  .callout.callout-style-default  div.callout-title {
    border-bottom: none;
    font-weight: 600;
    opacity: 85%;
    font-size: 0.9rem;
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-default div.callout-content {
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-simple .callout-icon::before {
    height: 1rem;
    width: 1rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 1rem 1rem;
  }

  .callout.callout-style-default .callout-icon::before {
    height: 0.9rem;
    width: 0.9rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 0.9rem 0.9rem;
  }

  .callout-title {
    display: flex
  }
    
  .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  .callout.no-icon::before {
    display: none !important;
  }

  .callout.callout-titled .callout-body > .callout-content > :last-child {
    padding-bottom: 0.5rem;
    margin-bottom: 0;
  }

  .callout.callout-titled .callout-icon::before {
    margin-top: .5rem;
    padding-right: .5rem;
  }

  .callout:not(.callout-titled) .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  /* Callout Types */

  div.callout-note {
    border-left-color: #4582ec !important;
  }

  div.callout-note .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEU0lEQVRYCcVXTWhcVRQ+586kSUMMxkyaElstCto2SIhitS5Ek8xUKV2poatCcVHtUlFQk8mbaaziwpWgglJwVaquitBOfhQXFlqlzSJpFSpIYyXNjBNiTCck7x2/8/LeNDOZxDuEkgOXe++553zfefee+/OYLOXFk3+1LLrRdiO81yNqZ6K9cG0P3MeFaMIQjXssE8Z1JzLO9ls20MBZX7oG8w9GxB0goaPrW5aNMp1yOZIa7Wv6o2ykpLtmAPs/vrG14Z+6d4jpbSKuhdcSyq9wGMPXjonwmESXrriLzFGOdDBLB8Y6MNYBu0dRokSygMA/mrun8MGFN3behm6VVAwg4WR3i6FvYK1T7MHo9BK7ydH+1uurECoouk5MPRyVSBrBHMYwVobG2aOXM07sWrn5qgB60rc6mcwIDJtQrnrEr44kmy+UO9r0u9O5/YbkS9juQckLed3DyW2XV/qWBBB3ptvI8EUY3I9p/67OW+g967TNr3Sotn3IuVlfMLVnsBwH4fsnebJvyGm5GeIUA3jljERmrv49SizPYuq+z7c2H/jlGC+Ghhupn/hcapqmcudB9jwJ/3jvnvu6vu5lVzF1fXyZuZZ7U8nRmVzytvT+H3kilYvH09mLWrQdwFSsFEsxFVs5fK7A0g8gMZjbif4ACpKbjv7gNGaD8bUrlk8x+KRflttr22JEMRUbTUwwDQScyzPgedQHZT0xnx7ujw2jfVfExwYHwOsDTjLdJ2ebmeQIlJ7neo41s/DrsL3kl+W2lWvAga0tR3zueGr6GL78M3ifH0rGXrBC2aAR8uYcIA5gwV8zIE8onoh8u0Fca/ciF7j1uOzEnqcIm59sEXoGc0+z6+H45V1CvAvHcD7THztu669cnp+L0okAeIc6zjbM/24LgGM1gZk7jnRu1aQWoU9sfUOuhrmtaPIO3YY1KLLWZaEO5TKUbMY5zx8W9UJ6elpLwKXbsaZ4EFl7B4bMtDv0iRipKoDQT2sNQI9b1utXFdYisi+wzZ/ri/1m7QfDgEuvgUUEIJPq3DhX/5DWNqIXDOweC2wvIR90Oq3lDpdMIgD2r0dXvGdsEW5H6x6HLRJYU7C69VefO1x8Gde1ZFSJLfWS1jbCnhtOPxmpfv2LXOA2Xk2tvnwKKPFuZ/oRmwBwqRQDcKNeVQkYcOjtWVBuM/JuYw5b6isojIkYxyYAFn5K7ZBF10fea52y8QltAg6jnMqNHFBmGkQ1j+U43HMi2xMar1Nv0zGsf1s8nUsmUtPOOrbFIR8bHFDMB5zL13Gmr/kGlCkUzedTzzmzsaJXhYawnA3UmARpiYj5ooJZiUoxFRtK3X6pgNPv+IZVPcnwbOl6f+aBaO1CNvPW9n9LmCp01nuSaTRF2YxHqZ8DYQT6WsXT+RD6eUztwYLZ8rM+rcPxamv1VQzFUkzFXvkiVrySGQgJNvXHJAxiU3/NwiC03rSf05VBaPtu/Z7/B8Yn/w7eguloAAAAAElFTkSuQmCC');
  }

  div.callout-note.callout-style-default .callout-title {
    background-color: #dae6fb
  }

  div.callout-important {
    border-left-color: #d9534f !important;
  }

  div.callout-important .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEKklEQVRYCcVXTWhcVRS+575MJym48A+hSRFr00ySRQhURRfd2HYjk2SSTokuBCkU2o0LoSKKraKIBTcuFCoidGFD08nkBzdREbpQ1EDNIv8qSGMFUboImMSZd4/f9zJv8ibJMC8xJQfO3HPPPef7zrvvvnvviIkpC9nsw0UttFunbUhpFzFtarSd6WJkStVMw5xyVqYTvkwfzuf/5FgtkVoB0729j1rjXwThS7Vio+Mo6DNnvLfahoZ+i/o32lULuJ3NNiz7q6+pyAUkJaFF6JwaM2lUJlV0MlnQn5aTRbEu0SEqHUa0A4AdiGuB1kFXRfVyg5d87+Dg4DL6m2TLAub60ilj7A1Ec4odSAc8X95sHh7+ZRPCFo6Fnp7HfU/fBng/hi10CjCnWnJjsxvDNxWw0NfV6Rv5GgP3I3jGWXumdTD/3cbEOP2ZbOZp69yniG3FQ9z1jD7bnBu9Fc2tKGC2q+uAJOQHBDRiZX1x36o7fWBs7J9ownbtO+n0/qWkvW7UPIfc37WgT6ZGR++EOJyeQDSb9UB+DZ1G6DdLDzyS+b/kBCYGsYgJbSQHuThGKRcw5xdeQf8YdNHsc6ePXrlSYMBuSIAFTGAtQo+VuALo4BX83N190NWZWbynBjhOHsmNfFWLeL6v+ynsA58zDvvAC8j5PkbOcXCMg2PZFk3q8MjI7WAG/Dp9AwP7jdGBOOQkAvlFUB+irtm16I1Zw9YBcpGTGXYmk3kQIC/Cds55l+iMI3jqhjAuaoe+am2Jw5GT3Nbz3CkE12NavmzN5+erJW7046n/CH1RO/RVa8lBLozXk9uqykkGAyRXLWlLv5jyp4RFsG5vGVzpDLnIjTWgnRy2Rr+tDKvRc7Y8AyZq10jj8DqXdnIRNtFZb+t/ZRtXcDiVnzpqx8mPcDWxgARUqx0W1QB9MeUZiNrV4qP+Ehc+BpNgATsTX8ozYKL2NtFYAHc84fG7ndxUPr+AR/iQSns7uSUufAymwDOb2+NjK27lEFocm/EE2WpyIy/Hi66MWuMKJn8RvxIcj87IM5Vh9663ziW36kR0HNenXuxmfaD8JC7tfKbrhFr7LiZCrMjrzTeGx+PmkosrkNzW94ObzwocJ7A1HokLolY+AvkTiD/q1H0cN48c5EL8Crkttsa/AXQVDmutfyku0E7jShx49XqV3MFK8IryDhYVbj7Sj2P2eBxwcXoe8T8idsKKPRcnZw1b+slFTubwUwhktrfnAt7J++jwQtLZcm3sr9LQrjRzz6cfMv9aLvgmnAGvpoaGLxM4mAEaLV7iAzQ3oU0IvD5x9ix3yF2RAAuYAOO2f7PEFWCXZ4C9Pb2UsgDeVnFSpbFK7/IWu7TPTvBqzbGdCHOJQSxiEjt6IyZmxQyEJHv6xyQsYk//moVFsN2zP6fRImjfq7/n/wFDguUQFNEwugAAAABJRU5ErkJggg==');
  }

  div.callout-important.callout-style-default .callout-title {
    background-color: #f7dddc
  }

  div.callout-warning {
    border-left-color: #f0ad4e !important;
  }

  div.callout-warning .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAETklEQVRYCeVWW2gcVRg+58yaTUnizqbipZeX4uWhBEniBaoUX1Ioze52t7sRq6APio9V9MEaoWlVsFasRq0gltaAPuxms8lu0gcviE/FFOstVbSIxgcv6SU7EZqmdc7v9+9mJtNks51NTUH84ed889/PP+cmxP+d5FIbMJmNbpREu4WUkiTtCicKny0l1pIKmBzovF2S+hIJHX8iEu3hZJ5lNZGqyRrGSIQpq15AzF28jgpeY6yk6GVdrfFqdrD6Iw+QlB8g0YS2g7dyQmXM/IDhBhT0UCiRf59lfqmmDvzRt6kByV/m4JjtzuaujMUM2c5Z2d6JdKrRb3K2q6mA+oYVz8JnDdKPmmNthzkAk/lN63sYPgevrguc72aZX/L9C6x09GYyxBgCX4NlvyGUHOKELlm5rXeR1kchuChJt4SSwyddZRXgvwMGvYo4QSlk3/zkHD8UHxwVJA6zjZZqP8v8kK8OWLnIZtLyCAJagYC4rTGW/9Pqj92N/c+LUaAj27movwbi19tk/whRCIE7Q9vyI6yvRpftAKVTdUjOW40X3h5OXsKCdmFcx0xlLJoSuQngnrJe7Kcjm4OMq9FlC7CMmScQANuNvjfP3PjGXDBaUQmbp296S5L4DrpbrHN1T87ZVEZVCzg1FF0Ft+dKrlLukI+/c9ENo+TvlTDbYFvuKPtQ9+l052rXrgKoWkDAFnvh0wTOmYn8R5f4k/jN/fZiCM1tQx9jQQ4ANhqG4hiL0qIFTGViG9DKB7GYzgubnpofgYRwO+DFjh0Zin2m4b/97EDkXkc+f6xYAPX0KK2I/7fUQuwzuwo/L3AkcjugPNixC8cHf0FyPjWlItmLxWw4Ou9YsQCr5fijMGoD/zpdRy95HRysyXA74MWOnscpO4j2y3HAVisw85hX5+AFBRSHt4ShfLFkIMXTqyKFc46xdzQM6XbAi702a7sy04J0+feReMFKp5q9esYLCqAZYw/k14E/xcLLsFElaornTuJB0svMuJINy8xkIYuL+xPAlWRceH6+HX7THJ0djLUom46zREu7tTkxwmf/FdOZ/sh6Q8qvEAiHpm4PJ4a/doJe0gH1t+aHRgCzOvBvJedEK5OFE5jpm4AGP2a8Dxe3gGJ/pAutug9Gp6he92CsSsWBaEcxGx0FHytmIpuqGkOpldqNYQK8cSoXvd+xLxXADw0kf6UkJNFtdo5MOgaLjiQOQHcn+A6h5NuL2s0qsC2LOM75PcF3yr5STuBSAcGG+meA14K/CI21HcS4LBT6tv0QAh8Dr5l93AhZzG5ZJ4VxAqdZUEl9z7WJ4aN+svMvwHHL21UKTd1mqvChH7/Za5xzXBBKrUcB0TQ+Ulgkfbi/H/YT5EptrGzsEK7tR1B7ln9BBwckYfMiuSqklSznIuoIIOM42MQO+QnduCoFCI0bpkzjCjddHPN/F+2Yu+sd9bKNpVwHhbS3LluK/0zgfwD0xYI5dXuzlQAAAABJRU5ErkJggg==');
  }

  div.callout-warning.callout-style-default .callout-title {
    background-color: #fcefdc
  }

  div.callout-tip {
    border-left-color: #02b875 !important;
  }

  div.callout-tip .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAADr0lEQVRYCe1XTWgTQRj9ZjZV8a9SPIkKgj8I1bMHsUWrqYLVg4Ue6v9BwZOxSYsIerFao7UiUryIqJcqgtpimhbBXoSCVxUFe9CTiogUrUp2Pt+3aUI2u5vdNh4dmMzOzHvvezuz8xNFM0mjnbXaNu1MvFWRXkXEyE6aYOYJpdW4IXuA4r0fo8qqSMDBU0v1HJUgVieAXxzCsdE/YJTdFcVIZQNMyhruOMJKXYFoLfIfIvVIMWdsrd+Rpd86ZmyzzjJmLStqRn0v8lzkb4rVIXvnpScOJuAn2ACC65FkPzEdEy4TPWRLJ2h7z4cArXzzaOdKlbOvKKX25Wl00jSnrwVxAg3o4dRxhO13RBSdNvH0xSARv3adTXbBdTf64IWO2vH0LT+cv4GR1DJt+DUItaQogeBX/chhbTBxEiZ6gftlDNXTrvT7co4ub5A6gp9HIcHvzTa46OS5fBeP87Qm0fQkr4FsYgVQ7Qg+ZayaDg9jhg1GkWj8RG6lkeSacrrHgDaxdoBiZPg+NXV/KifMuB6//JmYH4CntVEHy/keA6x4h4CU5oFy8GzrBS18cLJMXcljAKB6INjWsRcuZBWVaS3GDrqB7rdapVIeA+isQ57Eev9eCqzqOa81CY05VLd6SamW2wA2H3SiTbnbSxmzfp7WtKZkqy4mdyAlGx7ennghYf8voqp9cLSgKdqNfa6RdRsAAkPwRuJZNbpByn+RrJi1RXTwdi8RQF6ymDwGMAtZ6TVE+4uoKh+MYkcLsT0Hk8eAienbiGdjJHZTpmNjlbFJNKDVAp2fJlYju6IreQxQ08UJDNYdoLSl6AadO+fFuCQqVMB1NJwPm69T04Wv5WhfcWyfXQB+wXRs1pt+nCknRa0LVzSA/2B+a9+zQJadb7IyyV24YAxKp2Jqs3emZTuNnKxsah+uabKbMk7CbTgJx/zIgQYErIeTKRQ9yD9wxVof5YolPHqaWo7TD6tJlh7jQnK5z2n3+fGdggIOx2kaa2YI9QWarc5Ce1ipNWMKeSG4DysFF52KBmTNMmn5HqCFkwy34rDg05gDwgH3bBi+sgFhN/e8QvRn8kbamCOhgrZ9GJhFDgfcMHzFb6BAtjKpFhzTjwv1KCVuxHvCbsSiEz4CANnj84cwHdFXAbAOJ4LTSAawGWFn5tDhLMYz6nWeU2wJfIhmIJBefcd/A5FWQWGgrWzyORZ3Q6HuV+Jf0Bj+BTX69fm1zWgK7By1YTXchFDORywnfQ7GpzOo6S+qECrsx2ifVQAAAABJRU5ErkJggg==');
  }

  div.callout-tip.callout-style-default .callout-title {
    background-color: #ccf1e3
  }

  div.callout-caution {
    border-left-color: #fd7e14 !important;
  }

  div.callout-caution .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAACV0lEQVRYCdVWzWoUQRCuqp2ICBLJXgITZL1EfQDBW/bkzUMUD7klD+ATSHBEfAIfQO+iXsWDxJsHL96EHAwhgzlkg8nBg25XWb0zIb0zs9muYYWkoKeru+vn664fBqElyZNuyh167NXJ8Ut8McjbmEraKHkd7uAnAFku+VWdb3reSmRV8PKSLfZ0Gjn3a6Xlcq9YGb6tADjn+lUfTXtVmaZ1KwBIvFI11rRXlWlatwIAAv2asaa9mlB9wwygiDX26qaw1yYPzFXg2N1GgG0FMF8Oj+VIx7E/03lHx8UhvYyNZLN7BwSPgekXXLribw7w5/c8EF+DBK5idvDVYtEEwMeYefjjLAdEyQ3M9nfOkgnPTEkYU+sxMq0BxNR6jExrAI31H1rzvLEfRIdgcv1XEdj6QTQAS2wtstEALLG1yEZ3QhH6oDX7ExBSFEkFINXH98NTrme5IOaaA7kIfiu2L8A3qhH9zRbukdCqdsA98TdElyeMe5BI8Rs2xHRIsoTSSVFfCFCWGPn9XHb4cdobRIWABNf0add9jakDjQJpJ1bTXOJXnnRXHRf+dNL1ZV1MBRCXhMbaHqGI1JkKIL7+i8uffuP6wVQAzO7+qVEbF6NbS0LJureYcWXUUhH66nLR5rYmva+2tjRFtojkM2aD76HEGAD3tPtKM309FJg5j/K682ywcWJ3PASCcycH/22u+Bh7Aa0ehM2Fu4z0SAE81HF9RkB21c5bEn4Dzw+/qNOyXr3DCTQDMBOdhi4nAgiFDGCinIa2owCEChUwD8qzd03PG+qdW/4fDzjUMcE1ZpIAAAAASUVORK5CYII=');
  }

  div.callout-caution.callout-style-default .callout-title {
    background-color: #ffe5d0
  }

  </style>
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
  <script src="../site_libs/quarto-diagram/mermaid.min.js"></script>
  <script src="../site_libs/quarto-diagram/mermaid-init.js"></script>
  <link href="../site_libs/quarto-diagram/mermaid.css" rel="stylesheet">
  <script src="../site_libs/kePrint-0.0.1/kePrint.js"></script>
  <link href="../site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<meta property="og:title" content="R语言促进高效率肿瘤登记报告 – 普癌新声">
<meta property="og:description" content="基于R Markdown / Quarto的可重复性报告撰写">
<meta property="og:site_name" content="普癌新声">
<meta name="twitter:title" content="R语言促进高效率肿瘤登记报告 – 普癌新声">
<meta name="twitter:description" content="基于R Markdown / Quarto的可重复性报告撰写">
<meta name="twitter:card" content="summary">
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" data-background-color="lightblue" class="center">
  <h1 class="title">R语言促进高效率肿瘤登记报告</h1>
  <p class="subtitle">基于R Markdown / Quarto的可重复性报告撰写</p>
  <p class="author">陈琼</p>
  <p class="institute">🏥河南省癌症中心 河南省肿瘤医院</p>
  <p class="date">Tuesday May 16, 2023</p>
</section>
<section>
<section id="肿瘤登记工作介绍" class="title-slide slide level1 center" data-background-color="lightblue">
<h1>肿瘤登记工作介绍</h1>

</section>
<section id="人群肿瘤登记的目的和意义" class="slide level2">
<h2>人群肿瘤登记的目的和意义</h2>
<p><br></p>
<blockquote>
<p>肿瘤登记是系统性、经常性搜集有关肿瘤及肿瘤患者信息的统计制度。</p>
</blockquote>
<p><br></p>
<ul>
<li><p>了解癌症发病、死亡、生存情况</p></li>
<li><p>掌握癌症疾病负担与变化趋势</p></li>
<li><p>了解癌症在不同地区和人群中的分布特征</p></li>
</ul>
</section>
<section id="人群肿瘤登记的目的和意义-1" class="slide level2">
<h2>人群肿瘤登记的目的和意义</h2>
<p><br></p>
<blockquote>
<p>肿瘤登记是系统性、经常性收集有关肿瘤及肿瘤患者信息的统计制度。</p>
</blockquote>
<p><br></p>
<ul>
<li><p>为制定癌症防控策略与措施、规划与计划提供科学依据</p></li>
<li><p>为癌症的临床研究提供信息</p></li>
<li><p>为癌症防控效果评价提供数据支持</p></li>
</ul>
</section>
<section id="河南省肿瘤登记工作进展" class="slide level2">
<h2>河南省肿瘤登记工作进展</h2>
<p><br></p>
<div class="columns">
<div class="column" style="width:50%;">
<ul>
<li>肿瘤登记工作覆盖130个县区</li>
<li>达到数据利用标准的登记处达到42个，覆盖全省32%的人口</li>
<li>连续10年出版《河南省肿瘤登记年报》</li>
</ul>
</div><div class="column" style="width:50%;">
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="../2023-4-20-cancer-registration/images/map.png"></p>
<figcaption>河南省肿瘤登记地区覆盖情况</figcaption>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="组织架构" class="slide level2">
<h2>组织架构</h2>
<p><br></p>
<div class="columns">
<div class="column" style="width:33%;">
<h4 id="省级登记处">省级登记处</h4>
<p><em>河南省癌症中心</em></p>
<div class="callout callout-note callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>职责</strong></p>
</div>
<div class="callout-content">
<ul>
<li>制定全省工作计划、实施方案</li>
<li>建立和完善肿瘤登记信息系统</li>
<li>技术指导、人员培训、质量控制和考核评价</li>
<li>督导检查</li>
<li>数据分析和报告</li>
</ul>
</div>
</div>
</div>
</div><div class="column" style="width:33%;">
<h4 id="市级登记处">市级登记处</h4>
<p><em>市级CDC/肿瘤医院</em></p>
<div class="callout callout-note callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>职责</strong></p>
</div>
<div class="callout-content">
<ul>
<li>市级技术指导、人员培训</li>
<li>质量控制</li>
<li>督导检查</li>
<li>数据分析和报告</li>
</ul>
</div>
</div>
</div>
</div><div class="column" style="width:33%;">
<h4 id="县区级登记处">县区级登记处</h4>
<p><em>县区级CDC</em></p>
<div class="callout callout-note callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>职责</strong></p>
</div>
<div class="callout-content">
<ul>
<li>技术指导、人员培训</li>
<li>质量控制</li>
<li>督导检查</li>
<li>统计分析和报告</li>
</ul>
</div>
</div>
</div>
</div></div>
<div class="footer">
<p>数据来源: 河南省肿瘤登记管理办法（豫卫2015(10号)文件）</p>
</div>
</section>
<section id="收集数据内容" class="slide level2">
<h2>收集数据内容</h2>
<blockquote>
<p>肿瘤登记收集一定人群中所有恶性肿瘤、中枢神经系统良性肿瘤以及原位癌。 <br></p>
</blockquote>
<p><br></p>
<div class="columns">
<div class="column" style="width:33%;">
<h4 id="肿瘤收集范围icd10">肿瘤收集范围(ICD10)</h4>
<ul>
<li>C00-C97</li>
<li>D32-D33</li>
<li>D42-D43</li>
<li>D45-D47</li>
<li>原位癌</li>
</ul>
</div><div class="column" style="width:33%;">
<h4 id="人口数据">人口数据</h4>
<blockquote>
<p>以县区为单位收集登记处覆盖人群分年龄、分性别户籍人口数</p>
</blockquote>
</div><div class="column" style="width:33%;">
<h4 id="寿命表数据">寿命表数据</h4>
<blockquote>
<p>以县区为单位收集登记处覆盖人群分年龄、分性别全死因死亡数以估计寿命表</p>
</blockquote>
</div></div>
</section>
<section id="数据项目" class="slide level2">
<h2>数据项目</h2>
<div class="columns">
<div class="column" style="width:30%;">
<blockquote>
<p>肿瘤登记收集的变量包括以下7个部分（<a href="#/数据项目" class="quarto-xref">图&nbsp;1</a>）</p>
</blockquote>
<ul>
<li>个人识别信息</li>
<li>人口学信息</li>
<li>肿瘤信息</li>
<li>治疗信息</li>
<li>随访信息</li>
<li>预后信息</li>
<li>信息来源</li>
</ul>
</div><div class="column" style="width:70%;">
<div class="cell" data-reveal="true" data-layout-align="default">
<div class="cell-output-display">
<div id="fig-items" class="quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-float-fig">
<div aria-describedby="fig-items-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div>
<pre class="mermaid mermaid-js" data-label="fig-items">classDiagram
    class 个人识别信息 {
    登记处编号
    身份证号
    姓名
    户籍地址
    常住地址
}
    class 人口学信息 {
    性别
    年龄
    出生日期
    婚姻状态
    职业
    民族
}
    class 肿瘤信息 {
    发病日期
    诊断依据
    原发部位ICDO3
    形态学ICDO3
    行为ICDO3
    分级ICDO3
    临床分期/TNM分期
    多原发状态
    双边性
}
    class 治疗信息 {
    治疗方法
}
    class 随访相关信息 {
    联系电话
    联系人
    联系人电话
    常住地址
}
    class 结局信息 {
    最后接触日期
    生存状态
    死亡日期
    死亡原因
    死亡地点
}
    class 信息来源 {
    报告医院
    住院号/门诊号
    报告医师
    报告日期
}

    个人识别信息 --|&gt; 人口学信息
    个人识别信息 --|&gt; 肿瘤信息
    个人识别信息 --|&gt; 治疗信息
    个人识别信息 --|&gt; 随访相关信息
    个人识别信息 --|&gt; 结局信息
    个人识别信息 --|&gt; 信息来源
</pre>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-items-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
图&nbsp;1: 人群肿瘤登记收集数据项目
</figcaption>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="数据来源" class="slide level2">
<h2>数据来源</h2>
<blockquote>
<p>肿瘤登记强调<strong>多源上报</strong>、数据来源于医院、医保系统、县-乡-村医师网、全死因数据等。（<a href="#/数据来源" class="quarto-xref">图&nbsp;5</a> ）</p>
</blockquote>
<div class="cell" data-reveal="true" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-1" class="quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-float-fig">
<div aria-describedby="fig-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div>
<pre class="mermaid mermaid-js" data-label="fig-1">flowchart TD
  A[(肿瘤登记数据库)] --&gt; B(医院)
  A --&gt; B
  A --&gt; C(县-乡-村三级医师网络)
  A --&gt; D(医疗保险)
  A --&gt; E(死因监测)
  A --&gt; F(殡葬系统)
  A --&gt; G(公安系统)
  B --&gt; b1(住院患者数据)
  B --&gt; b2(门诊患者数据)
  B --&gt; b3(病案部门)
  B --&gt; b4(病理诊断部门)
  D --&gt; d1(新农合)
  D --&gt; d2(城镇医保)
  D --&gt; d3(职工医保)
</pre>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
图&nbsp;2: 肿瘤登记数据来源渠道
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="肿瘤分类与编码" class="slide level2">
<h2>肿瘤分类与编码</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p><br></p>
<blockquote>
<p>肿瘤登记采用ICDO3和ICD10<strong>双编码系统</strong></p>
</blockquote>
<h4 id="icd-o-3数据收集">ICD-O-3：数据收集</h4>
<ul>
<li>原发部位</li>
<li>形态学</li>
<li>行为</li>
<li>分级</li>
</ul>
<h4 id="icd10-数据统计分析">ICD10 ：数据统计分析</h4>
<blockquote>
<p>《肿瘤登记年报》采用ICD10进行肿瘤分类（<a href="#/肿瘤分类与编码" class="quarto-xref">表&nbsp;1</a>）</p>
</blockquote>
</div><div class="column" style="width:50%;">
<div class="cell">
<div id="tbl-category" class="cell quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-float-tbl">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-category-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
表&nbsp;1: 常用癌症分类统计表（大类）
</figcaption>
<div aria-describedby="tbl-category-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="table do-not-create-environment cell caption-top" data-quarto-postprocess="true" style="font-size: 12px; margin-left: auto; margin-right: auto;">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">部位</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">ICD10</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">口腔和咽 (除外鼻咽癌和喉)</td>
<td style="text-align: left;">C00-10,C12-14（除外C10.1）</td>
</tr>
<tr class="even">
<td style="text-align: left;">鼻咽癌</td>
<td style="text-align: left;">C11</td>
</tr>
<tr class="odd">
<td style="text-align: left;">食管</td>
<td style="text-align: left;">C15</td>
</tr>
<tr class="even">
<td style="text-align: left;">胃</td>
<td style="text-align: left;">C16</td>
</tr>
<tr class="odd">
<td style="text-align: left;">结直肠肛门</td>
<td style="text-align: left;">C18-21</td>
</tr>
<tr class="even">
<td style="text-align: left;">肝脏</td>
<td style="text-align: left;">C22</td>
</tr>
<tr class="odd">
<td style="text-align: left;">胆囊及其他</td>
<td style="text-align: left;">C23-C24</td>
</tr>
<tr class="even">
<td style="text-align: left;">胰腺</td>
<td style="text-align: left;">C25</td>
</tr>
<tr class="odd">
<td style="text-align: left;">喉</td>
<td style="text-align: left;">C32，C10.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">气管、支气管、肺</td>
<td style="text-align: left;">C33-C34</td>
</tr>
<tr class="odd">
<td style="text-align: left;">骨</td>
<td style="text-align: left;">C40-C41</td>
</tr>
<tr class="even">
<td style="text-align: left;">乳房</td>
<td style="text-align: left;">C50</td>
</tr>
<tr class="odd">
<td style="text-align: left;">子宫颈</td>
<td style="text-align: left;">C53</td>
</tr>
<tr class="even">
<td style="text-align: left;">子宫体及子宫部位不明</td>
<td style="text-align: left;">C54-55</td>
</tr>
<tr class="odd">
<td style="text-align: left;">卵巢</td>
<td style="text-align: left;">C56</td>
</tr>
<tr class="even">
<td style="text-align: left;">前列腺</td>
<td style="text-align: left;">C61</td>
</tr>
<tr class="odd">
<td style="text-align: left;">睾丸</td>
<td style="text-align: left;">C62</td>
</tr>
<tr class="even">
<td style="text-align: left;">肾及泌尿系统不明</td>
<td style="text-align: left;">C64-66，68</td>
</tr>
<tr class="odd">
<td style="text-align: left;">膀胱</td>
<td style="text-align: left;">C67</td>
</tr>
<tr class="even">
<td style="text-align: left;">脑,神经系统</td>
<td style="text-align: left;">C70-C72</td>
</tr>
<tr class="odd">
<td style="text-align: left;">甲状腺</td>
<td style="text-align: left;">C73</td>
</tr>
<tr class="even">
<td style="text-align: left;">淋巴瘤</td>
<td style="text-align: left;">C81-85,88,90,96</td>
</tr>
<tr class="odd">
<td style="text-align: left;">白血病</td>
<td style="text-align: left;">C91-C95</td>
</tr>
<tr class="even">
<td style="text-align: left;">其它</td>
<td style="text-align: left;">Other（除外以上）</td>
</tr>
<tr class="odd">
<td style="text-align: left;">所有部位合计</td>
<td style="text-align: left;">ALL</td>
</tr>
</tbody>
</table>


</div>
</div>
</figure>
</div>
</div>
</div></div>
</section>
<section id="质量控制" class="slide level2">
<h2>质量控制</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="callout callout-tip callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>质量控制的意义</strong></p>
</div>
<div class="callout-content">
<ul>
<li>使不同地区之间的数据具有可比性</li>
<li>代表登记处所在地区的癌症人群</li>
<li>使癌症数据真实有效</li>
</ul>
</div>
</div>
</div>

</div><div class="column" style="width:60%;">
<div class="cell" data-reveal="true" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-quality" class="quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-float-fig">
<div aria-describedby="fig-quality-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div>
<pre class="mermaid mermaid-js" data-label="fig-quality">flowchart LR
  A[质量控制指标] --&gt; B(可比性)
  A --&gt; C(完整性)
  A --&gt; D(有效性)
  A --&gt; E(时效性)
  B --&gt; b1(发病的定义)
  B --&gt; b2(多原发判断)
  B --&gt; b3(分类与编码)
  B --&gt; b4(死亡证明)
  C --&gt; c1(死亡发病比M:I)
  C --&gt; c2(只有死亡医学证明书比例DCO%)
  C --&gt; c3(组织学确诊比例MV%)
  C --&gt; c4(不同时间发病率的稳定性)
  C --&gt; c5(年龄别发病率曲线)
  D --&gt; d1(组织学确诊比例)
  D --&gt; d2(只有死亡医学证明书比例DC\%)
  D --&gt; d3(部位不明比例UB%)
  D --&gt; d4(数据内部一致性)
</pre>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-quality-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
图&nbsp;3: 肿瘤登记质量控制指标体系
</figcaption>
</figure>
</div>
</div>
</div>
</div></div>
<aside><div>
<p>采用IARC/IACR国际质量控制标准</p>
</div></aside></section>
<section id="质量控制-1" class="slide level2">
<h2>质量控制</h2>
<p><br></p>
<blockquote>
<p>肿瘤登记收集的变量或者变量组合之间存在一定的逻辑关系，通过对单个变量或变量组合之间的逻辑关系进行审查，以提高肿瘤登记数据有效性。</p>
</blockquote>
<div class="columns">
<div class="column" style="width:40%;">
<div class="callout callout-tip callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>单个项目</strong></p>
</div>
<div class="callout-content">
<ul>
<li>出生日期</li>
<li>发病日期</li>
<li>年龄、性别</li>
<li>发病部位</li>
<li>形态学</li>
<li>行为和分级</li>
</ul>
</div>
</div>
</div>
</div><div class="column" style="width:40%;">
<div class="callout callout-important callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>项目组合</strong></p>
</div>
<div class="callout-content">
<ul>
<li>性别/部位</li>
<li>部位/组织学学</li>
<li>年龄/部位/组织学</li>
<li>行为/部位</li>
<li>行为/组织学</li>
<li>性别/组织学</li>
</ul>
</div>
</div>
</div>
</div><div class="column" style="width:20%;">
<div class="callout callout-caution callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>校验结果</strong></p>
</div>
<div class="callout-content">
<ul>
<li>正确✅</li>
<li>警告⚠️</li>
<li>错误❌</li>
</ul>
</div>
</div>
</div>
</div></div>
</section>
<section id="肿瘤登记报告流程" class="slide level2">
<h2>肿瘤登记报告流程</h2>
<p><br></p>
<div class="cell" data-reveal="true" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-report" class="quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-float-fig">
<div aria-describedby="fig-report-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div>
<pre class="mermaid mermaid-js" data-label="fig-report">flowchart LR
  A(数据来源单位) --&gt; B(县区级登记处)
  B --&gt; C(市级登记处)
  C --&gt; D(省级登记处)
  D --&gt; E(质量控制)
  E --&gt; B
  B --&gt; A
  E --&gt; C
  E --&gt; F(综合评估)
  F --&gt; G(年报撰写及发布)
</pre>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-report-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
图&nbsp;4: 肿瘤登记报告流程
</figcaption>
</figure>
</div>
</div>
</div>
<p><br></p>
<div class="columns">
<div class="column" style="width:50%;">
<h3 id="主要内容">主要内容</h3>
<ul>
<li>质量控制报告撰写</li>
<li>肿瘤登记报告撰写</li>
</ul>
</div><div class="column" style="width:50%;">
<h3 id="特点">特点</h3>
<ul>
<li>登记处数量多(130个县区)</li>
<li>县区级专业人员能力不足</li>
<li>质控报告反馈至市级和县区级</li>
</ul>
</div></div>
</section>
<section id="文学编程和可能重复性报告概念的引入" class="slide level2">
<h2>文学编程和可能重复性报告概念的引入</h2>
<blockquote>
<p><strong>文学编程</strong>:强调以自然语言呈现计算逻辑，以文本描述和计算代码相互混合的方式，从计算机代码的执行逻辑过渡到人的思维逻辑。</p>
</blockquote>
<blockquote>
<p><strong>可重复性报告</strong>:利用代码把数据分析过程和报告撰写过程串起来，最终生成可重复性的报告。</p>
</blockquote>
<p><br></p>
<ul>
<li>基于<em>原始数据</em>更新报告</li>
<li>报告的<em>批量化</em>生成</li>
<li>多种格式输出(html、docx)</li>
</ul>
</section></section>
<section>
<section id="基于r-markdown-quarto-的可重复性报告" class="title-slide slide level1 center" data-background-color="lightblue">
<h1>基于R Markdown / Quarto 的可重复性报告</h1>

</section>
<section id="markdown" class="slide level2">
<h2>Markdown</h2>
<p><br></p>
<blockquote>
<p>它允许人们使用易读易写的<strong>纯文本格式</strong>编写文档，然后转换成有效的 XHTML（或者HTML）文档。</p>
</blockquote>
<p><br></p>
<ul>
<li>轻量级标记语言</li>
<li>轻量化、易读易写、对图片、表格、数学公式支持</li>
<li>Github、Reddit、Diaspora、Stack Exchange、OpenStreetMap、SourceForge、简书等，甚至还能被使用来撰写电子书</li>
</ul>
</section>
<section id="r-markdown" class="slide level2">
<h2>R Markdown</h2>
<p><br></p>
<blockquote>
<p>R Markdown把<em>报告文本</em>和<em>统计计算代码</em>整合起来，从而实现一次输入多种格式输出(HTML、PDF、WORD等)。</p>
</blockquote>
<p><br></p>
<ul>
<li>YAML 元数据设置</li>
<li>代码块（R、Python等）</li>
<li>Markdown文本</li>
</ul>
</section>
<section id="r-markdown-1" class="slide level2">
<h2>R Markdown</h2>
<h3 id="yaml元数据">YAML元数据</h3>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource yaml number-lines code-with-copy"><code class="sourceCode yaml"><span id="cb1-1"><a></a><span class="pp">---</span></span>
<span id="cb1-2"><a></a><span class="fu">title</span><span class="kw">:</span><span class="at"> </span><span class="st">"河南省恶性肿瘤2017-2019年5年相对生存率"</span></span>
<span id="cb1-3"><a></a><span class="fu">authors</span><span class="kw">:</span></span>
<span id="cb1-4"><a></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> 陈琼</span></span>
<span id="cb1-5"><a></a><span class="at">    </span><span class="fu">affiliations</span><span class="kw">:</span></span>
<span id="cb1-6"><a></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">ref</span><span class="kw">:</span><span class="at"> zlyy</span></span>
<span id="cb1-7"><a></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> 张明霞</span></span>
<span id="cb1-8"><a></a><span class="at">    </span><span class="fu">affiliations</span><span class="kw">:</span></span>
<span id="cb1-9"><a></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">ref</span><span class="kw">:</span><span class="at"> zlyy</span></span>
<span id="cb1-10"><a></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">ref</span><span class="kw">:</span><span class="at"> lzu</span></span>
<span id="cb1-11"><a></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> 郭兰伟</span></span>
<span id="cb1-12"><a></a><span class="at">    </span><span class="fu">affiliations</span><span class="kw">:</span></span>
<span id="cb1-13"><a></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">ref</span><span class="kw">:</span><span class="at"> zlyy</span></span>
<span id="cb1-14"><a></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> 郑黎阳</span></span>
<span id="cb1-15"><a></a><span class="at">    </span><span class="fu">affiliations</span><span class="kw">:</span></span>
<span id="cb1-16"><a></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">ref</span><span class="kw">:</span><span class="at"> zlyy</span></span>
<span id="cb1-17"><a></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> 刘纯亚</span></span>
<span id="cb1-18"><a></a><span class="at">    </span><span class="fu">affiliations</span><span class="kw">:</span></span>
<span id="cb1-19"><a></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">ref</span><span class="kw">:</span><span class="at"> zlyy</span></span>
<span id="cb1-20"><a></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> 王一先</span></span>
<span id="cb1-21"><a></a><span class="at">    </span><span class="fu">affiliations</span><span class="kw">:</span></span>
<span id="cb1-22"><a></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">ref</span><span class="kw">:</span><span class="at"> zlyy</span></span>
<span id="cb1-23"><a></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> 刘茵</span></span>
<span id="cb1-24"><a></a><span class="at">    </span><span class="fu">affiliations</span><span class="kw">:</span></span>
<span id="cb1-25"><a></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">ref</span><span class="kw">:</span><span class="at"> zlyy</span></span>
<span id="cb1-26"><a></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> 王红</span></span>
<span id="cb1-27"><a></a><span class="at">    </span><span class="fu">affiliations</span><span class="kw">:</span></span>
<span id="cb1-28"><a></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">ref</span><span class="kw">:</span><span class="at"> zlyy</span></span>
<span id="cb1-29"><a></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> 徐慧芳</span></span>
<span id="cb1-30"><a></a><span class="at">    </span><span class="fu">affiliations</span><span class="kw">:</span></span>
<span id="cb1-31"><a></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">ref</span><span class="kw">:</span><span class="at"> zlyy</span></span>
<span id="cb1-32"><a></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> 康瑞华</span></span>
<span id="cb1-33"><a></a><span class="at">    </span><span class="fu">affiliations</span><span class="kw">:</span></span>
<span id="cb1-34"><a></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">ref</span><span class="kw">:</span><span class="at"> zlyy</span></span>
<span id="cb1-35"><a></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> 王潇杨</span></span>
<span id="cb1-36"><a></a><span class="at">    </span><span class="fu">affiliations</span><span class="kw">:</span></span>
<span id="cb1-37"><a></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">ref</span><span class="kw">:</span><span class="at"> zlyy</span></span>
<span id="cb1-38"><a></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> 刘曙正</span></span>
<span id="cb1-39"><a></a><span class="at">    </span><span class="fu">affiliations</span><span class="kw">:</span></span>
<span id="cb1-40"><a></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">ref</span><span class="kw">:</span><span class="at"> zlyy</span></span>
<span id="cb1-41"><a></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> 张韶凯</span></span>
<span id="cb1-42"><a></a><span class="at">    </span><span class="fu">affiliations</span><span class="kw">:</span></span>
<span id="cb1-43"><a></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">ref</span><span class="kw">:</span><span class="at"> zlyy</span></span>
<span id="cb1-44"><a></a><span class="at">    </span><span class="fu">corresponding</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb1-45"><a></a><span class="at">    </span><span class="fu">email</span><span class="kw">:</span><span class="at"> shaokaizhang@126.com</span></span>
<span id="cb1-46"><a></a><span class="fu">affiliations</span><span class="kw">:</span></span>
<span id="cb1-47"><a></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">id</span><span class="kw">:</span><span class="at"> zlyy</span></span>
<span id="cb1-48"><a></a><span class="at">    </span><span class="fu">name</span><span class="kw">:</span><span class="at"> 郑州大学附属肿瘤医院(河南省肿瘤医院)，疾病预防控制科；河南省肿瘤防控工程研究中心；河南省肿瘤预防国际联合实验室，郑州，450008。</span></span>
<span id="cb1-49"><a></a><span class="at">    </span><span class="fu">city</span><span class="kw">:</span><span class="at"> 郑州</span></span>
<span id="cb1-50"><a></a><span class="at">    </span><span class="fu">state</span><span class="kw">:</span><span class="at"> 河南省</span></span>
<span id="cb1-51"><a></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">id</span><span class="kw">:</span><span class="at"> lzu</span></span>
<span id="cb1-52"><a></a><span class="at">    </span><span class="fu">name</span><span class="kw">:</span><span class="at"> 兰州大学公共卫生学院</span></span>
<span id="cb1-53"><a></a><span class="at">    </span><span class="fu">city</span><span class="kw">:</span><span class="at"> 兰州</span></span>
<span id="cb1-54"><a></a><span class="at">    </span><span class="fu">state</span><span class="kw">:</span><span class="at"> 甘肃省</span></span>
<span id="cb1-55"><a></a><span class="fu">filters</span><span class="kw">:</span></span>
<span id="cb1-56"><a></a><span class="at">  </span><span class="kw">-</span><span class="at"> authors-block</span></span>
<span id="cb1-57"><a></a></span>
<span id="cb1-58"><a></a><span class="co">#prefer-html: true</span></span>
<span id="cb1-59"><a></a><span class="fu">execute</span><span class="kw">:</span><span class="at"> </span></span>
<span id="cb1-60"><a></a><span class="at">  </span><span class="fu">echo</span><span class="kw">:</span><span class="at"> </span><span class="ch">false</span></span>
<span id="cb1-61"><a></a><span class="at">  </span><span class="fu">warning</span><span class="kw">:</span><span class="at"> </span><span class="ch">false</span></span>
<span id="cb1-62"><a></a><span class="at">  </span><span class="fu">message</span><span class="kw">:</span><span class="at"> </span><span class="ch">false</span></span>
<span id="cb1-63"><a></a><span class="at">  </span><span class="fu">tbl-cap-location</span><span class="kw">:</span><span class="at"> top</span></span>
<span id="cb1-64"><a></a><span class="co">#lang: zh</span></span>
<span id="cb1-65"><a></a><span class="fu">crossref</span><span class="kw">:</span></span>
<span id="cb1-66"><a></a><span class="at">  </span><span class="fu">fig-title</span><span class="kw">:</span><span class="at"> 图     </span></span>
<span id="cb1-67"><a></a><span class="at">  </span><span class="fu">tbl-title</span><span class="kw">:</span><span class="at"> 表     </span></span>
<span id="cb1-68"><a></a><span class="at">  </span><span class="fu">title-delim</span><span class="kw">:</span><span class="at"> </span><span class="st">""</span></span>
<span id="cb1-69"><a></a><span class="at">  </span><span class="fu">tbl-prefix</span><span class="kw">:</span><span class="at"> 表</span></span>
<span id="cb1-70"><a></a></span>
<span id="cb1-71"><a></a><span class="fu">format</span><span class="kw">:</span><span class="at"> </span></span>
<span id="cb1-72"><a></a><span class="at">  </span><span class="fu">docx</span><span class="kw">:</span><span class="at"> </span></span>
<span id="cb1-73"><a></a><span class="at">    </span><span class="fu">number-sections</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb1-74"><a></a><span class="at">    </span><span class="fu">number-depth</span><span class="kw">:</span><span class="at"> </span><span class="dv">3</span></span>
<span id="cb1-75"><a></a><span class="at">    </span><span class="fu">reference-doc</span><span class="kw">:</span><span class="at"> chinese.docx</span></span>
<span id="cb1-76"><a></a></span>
<span id="cb1-77"><a></a><span class="fu">bibliography</span><span class="kw">:</span><span class="at"> survival17-19.bib</span></span>
<span id="cb1-78"><a></a><span class="fu">csl</span><span class="kw">:</span><span class="at"> </span><span class="st">"zhonghua.csl"</span></span>
<span id="cb1-79"><a></a><span class="fu">editor_options</span><span class="kw">:</span><span class="at"> </span></span>
<span id="cb1-80"><a></a><span class="at">  </span><span class="fu">chunk_output_type</span><span class="kw">:</span><span class="at"> console</span></span>
<span id="cb1-81"><a></a><span class="pp">---</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="r-markdown-2" class="slide level2">
<h2>R Markdown</h2>
<h3 id="代码块">代码块</h3>
<div class="columns">
<div class="column" style="width:50%;">
<div id="tbl-table1" class="cell quarto-float quarto-figure quarto-figure-center" data-tbl-cap-location="top">
<figure class="quarto-float quarto-float-tbl">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-table1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
表&nbsp;2: 接受不同药物治疗人群基本特征分析
</figcaption>
<div aria-describedby="tbl-table1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="tbl-table1" data-tbl-cap-location="top"><pre class="sourceCode numberSource markdown number-lines cell code-with-copy"><code class="sourceCode markdown"><span id="tbl-table1-1"><a href="#tbl-table1-1"></a><span class="in">```{r}</span></span>
<span id="tbl-table1-2"><a href="#tbl-table1-2"></a><span class="in">#| label: tbl-table1</span></span>
<span id="tbl-table1-3"><a href="#tbl-table1-3"></a><span class="in">#| tbl-cap-location: top</span></span>
<span id="tbl-table1-4"><a href="#tbl-table1-4"></a><span class="in">#| tbl-cap: "接受不同药物治疗人群基本特征分析"</span></span>
<span id="tbl-table1-5"><a href="#tbl-table1-5"></a><span class="in">#| warning: false</span></span>
<span id="tbl-table1-6"><a href="#tbl-table1-6"></a><span class="in">#| eval: false</span></span>
<span id="tbl-table1-7"><a href="#tbl-table1-7"></a><span class="in">#| message: false</span></span>
<span id="tbl-table1-8"><a href="#tbl-table1-8"></a></span>
<span id="tbl-table1-9"><a href="#tbl-table1-9"></a><span class="in">library(gtsummary)</span></span>
<span id="tbl-table1-10"><a href="#tbl-table1-10"></a></span>
<span id="tbl-table1-11"><a href="#tbl-table1-11"></a><span class="in">trial %&gt;% select(age, grade, response, trt) %&gt;% </span></span>
<span id="tbl-table1-12"><a href="#tbl-table1-12"></a><span class="in">   tbl_summary(by=trt) %&gt;% </span></span>
<span id="tbl-table1-13"><a href="#tbl-table1-13"></a><span class="in">  add_p() %&gt;% </span></span>
<span id="tbl-table1-14"><a href="#tbl-table1-14"></a><span class="in">  add_overall() %&gt;% </span></span>
<span id="tbl-table1-15"><a href="#tbl-table1-15"></a><span class="in">  add_n() %&gt;% </span></span>
<span id="tbl-table1-16"><a href="#tbl-table1-16"></a><span class="in">  bold_labels() </span></span>
<span id="tbl-table1-17"><a href="#tbl-table1-17"></a><span class="in">```</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="images/table.jpg"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="r-markdown-3" class="slide level2">
<h2>R Markdown</h2>
<h3 id="markdown文本">Markdown文本</h3>
<div class="sourceCode" id="cb2"><pre class="sourceCode numberSource yaml number-lines code-with-copy"><code class="sourceCode yaml"><span id="cb2-1"><a></a><span class="ot">**通讯作者**：张韶凯，Email:</span><span class="at"> shaokaizhang\@126.com</span></span>
<span id="cb2-2"><a></a></span>
<span id="cb2-3"><a></a><span class="at">【**摘要**】</span></span>
<span id="cb2-4"><a></a></span>
<span id="cb2-5"><a></a><span class="ot">**目的**</span><span class="at"> 利用河南省人群肿瘤登记数据分析河南省人群癌症5年相对生存率。</span></span>
<span id="cb2-6"><a></a></span>
<span id="cb2-7"><a></a><span class="ot">**方法**</span><span class="at"> 提取河南省肿瘤登记数据库中25个肿瘤登记处诊断日期在2014年1月1日至2019年12月31日之间以及2014年之前诊断但是2019年12月31日之前仍然存活的癌症病例（ICD10编码范围：C00-C97、D32-D33、D42-D43和D45-D47），随访截止日期设定为2019年12月31日，利用现时生存分析法和R语言"periodR"包的EdererII法计算癌症的5年相对生存率。</span></span>
<span id="cb2-8"><a></a></span>
<span id="cb2-9"><a></a><span class="ot">**结果**</span><span class="at"> 2017-2019年期间，河南省0-14岁儿童癌症的5年相对生存率为62.5%，15岁及以上成人癌症5年相对生存率为44.2%，年龄标化后为40.7%。总体癌症5年生存率呈现女性高于男性（47.1% VS 34.4%, *P*\&lt;0.01）、城市地区高于农村地区（46.4% VS 39.2%, *P*\&lt;0.01）的特点。在不同发病部位的癌症患者中，甲状腺癌、睾丸癌及乳腺癌具有最高的5年相对生存率，分别为86.4%、74.4%和73.1%；肝癌、胰腺癌、肺癌具有最低的5年相对生存率，分别为19.1%、20.5%和24.3%。</span></span>
<span id="cb2-10"><a></a></span>
<span id="cb2-11"><a></a><span class="ot">**结论**</span><span class="at"> 河南省儿童及成人癌症患者总体5年相对生存率仍然较低，应根据河南省癌症流行情况及不同癌症的生存率数据调整和优化癌症防控策略和措施。</span></span>
<span id="cb2-12"><a></a></span>
<span id="cb2-13"><a></a><span class="at">【**关键词**】 癌症；癌症防控；现时生存分析；5年相对生存率；河南省</span></span>
<span id="cb2-14"><a></a></span>
<span id="cb2-15"><a></a><span class="at">The 5-year relative survival among cancer patients diagnosed during 2017-2019 in Henan Province, China {.unnumbered}</span></span>
<span id="cb2-16"><a></a></span>
<span id="cb2-17"><a></a><span class="at">Qiong Chen$^1$, Mingxia Zhang$^12$, Lanwei Guo$^1$, Liyang Zheng$^1$, Yixian Wang$^1$, Yin Liu$^1$, Hong Wang$^1$, Huifang Xu$^1$, Ruihua Kang$^1$, Xiaoyang Wang$^1$, Shuzheng Liu$^1$, Shaokai Zhang$^1$</span></span>
<span id="cb2-18"><a></a></span>
<span id="cb2-19"><a></a><span class="at">$^1$ The Affiliated Cancer Hospital of Zhengzhou University &amp; Henan Cancer Hospital, Zhengzhou 450008, China。 $^2$ School of Public Health, Lanzhou University.</span></span>
<span id="cb2-20"><a></a></span>
<span id="cb2-21"><a></a><span class="ot">**Corresponding**</span><span class="at"> to：Shaokai Zhang，Email:shaokaizhang\@126.com</span></span>
<span id="cb2-22"><a></a></span>
<span id="cb2-23"><a></a><span class="ot">**Abstract**</span><span class="at"> </span></span>
<span id="cb2-24"><a></a></span>
<span id="cb2-25"><a></a><span class="ot">**Objective**</span><span class="at"> To analyze the 5-year relative survival rate of cancer in the population of Henan Province using cancer registration data. </span></span>
<span id="cb2-26"><a></a></span>
<span id="cb2-27"><a></a><span class="ot">**Methods**</span><span class="at"> Cancer cases were extracted from the cancer registration database of Henan Province with the diagnosis date between January 1, 2014 and December 31, 2019, and those diagnosed before 2014 but still alive by December 31, 2019 were included. The follow-up date was set as December 31, 2019. The 5-year relative survival rate of cancer was calculated using the period survival analysis method and the Ederer II method in the R package "periodR". </span></span>
<span id="cb2-28"><a></a></span>
<span id="cb2-29"><a></a><span class="ot">**Results**</span><span class="at"> The 5-year cancer relative survival rate in children aged 0-14 in Henan Province was 62.5% during 2017-2019, while that in adults aged 15 and above was 44.2%, age-standardized to 40.7%. The overall cancer 5-year survival rate was higher in females than in males (47.1% vs 34.4%, *P*\&lt;0.01) and in urban areas than in rural areas (46.4% vs 39.2%, *P*\&lt;0.01). Among patients with different cancer sites, thyroid cancer, testicular cancer, and breast cancer had the highest 5-year relative survival rates, which were 86.4%, 74.4%, and 73.1%, respectively. Liver cancer, pancreatic cancer, and lung cancer had the lowest 5-year relative survival rates, which were 19.1%, 20.5%, and 24.3%, respectively. </span></span>
<span id="cb2-30"><a></a></span>
<span id="cb2-31"><a></a><span class="ot">**Conclusion**</span><span class="at"> The overall 5-year relative survival rate of cancer in children and adults in Henan Province is still low, and cancer prevention and control strategies and measures should be adjusted and optimized according to the cancer incidence and survival rate data in Henan Province.</span></span>
<span id="cb2-32"><a></a></span>
<span id="cb2-33"><a></a><span class="ot">**Keywords**:</span><span class="at"> Cancer; cancer control; period survival; 5-year relative survival; Henan</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="r-markdown-4" class="slide level2" data-background-color="lightblue">
<h2>R Markdown</h2>
<blockquote>
<p>R 通过一系列包实现了文学编程的主要功能。</p>
</blockquote>
<div class="columns">
<div class="column" style="width:30%;">
<ul>
<li>rmarkdown</li>
<li>knitr</li>
<li>bookdown</li>
<li>blogdown</li>
<li>thesisdown</li>
<li>posterdown</li>
<li>distill</li>
<li>xaringan</li>
<li>tinytex</li>
</ul>
</div><div class="column" style="width:70%;">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="images/rmd-packages.png"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="pandoc" class="slide level2">
<h2>Pandoc</h2>
<blockquote>
<p>Pandoc是使用Haskell语言编写的一款跨平台、自由开源及命令行界面的标记语言转换工具，可实现不同标记语言间的格式转换。</p>
</blockquote>
<div style="font-size: 70%;">
<ul>
<li>HTML格式：包括XHTML，HTML5及HTML slide</li>
<li>文字处理软件格式：包括docx、odt、OpenDocument XML</li>
<li>电子书格式：包括EPUB（第2版及第3版）、FictionBook2</li>
<li>技术文档格式：包括DocBook、GNU TexInfo、Groff manpages、Haddock</li>
<li>页面布局格式：InDesign ICML</li>
<li>大纲处理标记语言格式：OPML</li>
<li>TeX格式：包括LaTeX、ConTeXt、LaTeX Beamer</li>
<li>PDF格式：需要LaTeX支持</li>
<li>轻量级标记语言格式：包括Markdown、reStructuredText、textile、Org-Mode、MediaWiki标记语言、AsciiDoc</li>
<li>自定义格式：可使用lua自定义转换规则</li>
</ul>
</div>
</section>
<section id="quarto-下一代-r-markdown" class="slide level2">
<h2>Quarto 下一代 R Markdown</h2>
<p><br></p>
<blockquote>
<p>Quarto® is an open-source scientific and technical publishing system built on Pandoc.</p>
</blockquote>
<p><br></p>

<img data-src="https://quarto.org/docs/get-started/hello/images/rstudio-qmd-how-it-works.png" class="r-stretch"></section>
<section id="quarto特点" class="slide level2">
<h2>Quarto特点</h2>
<ul>
<li>它可以独立于R、Rstudio或者其他软件如python等编程或统计软件，支持在Macos、Linux、Windows系统运行；</li>
<li>Quarto继承了一些Rmd包的特点、如blogdown、bookdown、xaringan等；</li>
<li>在生成website、blog、book、slides等各种格式中有了统一的语法，缩小了使用者的学习成本；</li>
<li>支持的语言包括R、Python、Julia和Observable；</li>
<li>quarto有了新的文档格式，文档扩展名为“.qmd”, 代码块选项的形式有了变化。</li>
<li>支持科技写作的特征，如公式、引用、交叉引用、图、表等。</li>
</ul>
</section>
<section id="为什么要使用-quarto-r-markdown" class="slide level2">
<h2>为什么要使用 Quarto / R Markdown ?</h2>
<div class="cell" data-reveal="true" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-1" class="quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-float-fig">
<div aria-describedby="fig-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div>
<pre class="mermaid mermaid-js" data-label="fig-1">flowchart LR
  A[(数据清洗)] --&gt; B(统计分析)
  B --&gt; C{结果初步评估}
  C --&gt; B
  C --&gt; D(统计制表)
  D --&gt; E[报告撰写]
  E -- 发现不合理结果 --&gt; B
  E --&gt; F[出版流程]
  F --&gt; G[专家意见]
  G -- 建议重新统计 --&gt; B
  G -- 不需要重新统计 --&gt; E
  G --&gt; H[正式出版]
</pre>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
图&nbsp;5: 报告撰写流程
</figcaption>
</figure>
</div>
</div>
</div>
<div class="columns">
<div class="column" style="width:50%;">
<div class="callout callout-tip callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>可能存在的情形</strong></p>
</div>
<div class="callout-content">
<ul>
<li>统计分析(SAS、R、SPSS、EXCEL)</li>
<li>数据可视化展现(R、SAS、EXCEL)</li>
<li>撰写报告(WORD、WPS、其它文字处理软件)</li>
<li>图表交叉引用</li>
<li>参考文献的引用(Zotero、Endnote、Mendley)</li>
</ul>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="callout callout-tip callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>存在的问题</strong></p>
</div>
<div class="callout-content">
<ul>
<li>统计过程与报告撰写的割裂</li>
<li>存在重复性工作的可能</li>
</ul>
</div>
</div>
</div>
</div></div>
</section>
<section id="应用场景" class="slide level2">
<h2>应用场景</h2>
<p><br></p>
<div class="columns">
<div class="column" style="width:30%;">
<ul>
<li>科技论文撰写</li>
<li>书籍编写</li>
<li>幻灯片制作</li>
<li>博客</li>
<li>网站</li>
</ul>
</div><div class="column" style="width:70%;">
<div class="cell">
<iframe src="https://www.chenq.site/qsight" width="960" height="400px" data-external="1">
</iframe>
</div>
</div></div>
</section>
<section id="应用场景-1" class="slide level2">
<h2>应用场景</h2>
<p><br></p>
<div class="columns">
<div class="column" style="width:30%;">
<ul>
<li>科技论文撰写</li>
<li>书籍编写</li>
<li>幻灯片制作</li>
<li>博客</li>
<li>网站</li>
</ul>
</div><div class="column" style="width:70%;">
<div class="cell">
<iframe src="https://www.chenq.site/slides/2023-5-11-system" width="960" height="400px" data-external="1">
</iframe>
</div>
</div></div>
</section>
<section id="应用场景-2" class="slide level2">
<h2>应用场景</h2>
<p><br></p>
<div class="columns">
<div class="column" style="width:30%;">
<ul>
<li>科技论文撰写</li>
<li>书籍编写</li>
<li>幻灯片制作</li>
<li>博客</li>
<li>网站</li>
</ul>
</div><div class="column" style="width:70%;">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="images/paper.jpg"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="应用场景-3" class="slide level2">
<h2>应用场景</h2>
<p><br></p>
<div class="columns">
<div class="column" style="width:30%;">
<ul>
<li>科技论文撰写</li>
<li>书籍编写</li>
<li>幻灯片制作</li>
<li>博客</li>
<li>网站</li>
</ul>
</div><div class="column" style="width:70%;">
<div class="cell">
<iframe src="https://www.chenq.site/report/2021" width="960" height="400px" data-external="1">
</iframe>
</div>
</div></div>
</section></section>
<section>
<section id="肿瘤登记报告的实际应用分享" class="title-slide slide level1 center" data-background-color="lightblue">
<h1>肿瘤登记报告的实际应用分享</h1>

</section>
<section id="cancer-incidence-in-five-continents-iarc" class="slide level2">
<h2>Cancer Incidence in Five Continents-IARC</h2>
<h3 id="yaml元数据设置">YAML元数据设置</h3>
<div class="sourceCode" id="cb3"><pre class="sourceCode numberSource yaml number-lines code-with-copy"><code class="sourceCode yaml"><span id="cb3-1"><a></a><span class="pp">--- </span></span>
<span id="cb3-2"><a></a><span class="fu">title</span><span class="kw">:</span><span class="at"> </span><span class="st">"河南省《五大洲发病率第12卷》数据上报审核程序"</span></span>
<span id="cb3-3"><a></a><span class="fu">subtitle</span><span class="kw">:</span><span class="at"> </span><span class="st">"登记处："</span></span>
<span id="cb3-4"><a></a><span class="fu">author</span><span class="kw">:</span><span class="at"> </span></span>
<span id="cb3-5"><a></a><span class="kw">-</span><span class="at"> </span><span class="st">"2013-2017年"</span></span>
<span id="cb3-6"><a></a><span class="kw">-</span><span class="at"> </span><span class="st">"Qiong Chen @ Henan Cancer Center/Henan Cancer Hospital"</span></span>
<span id="cb3-7"><a></a><span class="fu">date</span><span class="kw">:</span><span class="at"> </span><span class="st">""</span></span>
<span id="cb3-8"><a></a><span class="fu">output</span><span class="kw">:</span></span>
<span id="cb3-9"><a></a><span class="at">  prettydoc:</span><span class="fu">:html_pretty</span><span class="kw">:</span></span>
<span id="cb3-10"><a></a><span class="at">    </span><span class="fu">theme</span><span class="kw">:</span><span class="at"> cayman</span></span>
<span id="cb3-11"><a></a><span class="at">    </span><span class="fu">number_section</span><span class="kw">:</span><span class="at"> </span><span class="ch">TRUE</span></span>
<span id="cb3-12"><a></a><span class="at">    </span><span class="fu">highlight</span><span class="kw">:</span><span class="at"> github</span></span>
<span id="cb3-13"><a></a><span class="fu">vignette</span><span class="kw">: </span><span class="ch">&gt;</span></span>
<span id="cb3-14"><a></a>  %\VignetteIndexEntry{Vignette Title}</span>
<span id="cb3-15"><a></a>  %\VignetteEncoding{UTF-8}</span>
<span id="cb3-16"><a></a>  %\VignetteEngine{knitr::rmarkdown}</span>
<span id="cb3-17"><a></a><span class="fu">editor_options</span><span class="kw">:</span><span class="at"> </span></span>
<span id="cb3-18"><a></a><span class="at">  </span><span class="fu">chunk_output_type</span><span class="kw">:</span><span class="at"> console</span></span>
<span id="cb3-19"><a></a><span class="pp">---</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="cancer-incidence-in-five-continents-iarc-1" class="slide level2">
<h2>Cancer Incidence in Five Continents-IARC</h2>
<h3 id="代码块-1">代码块</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(</span>
<span id="cb4-2"><a></a>    <span class="at">echo =</span> <span class="cn">FALSE</span>,</span>
<span id="cb4-3"><a></a>    <span class="at">warning =</span> <span class="cn">FALSE</span>,</span>
<span id="cb4-4"><a></a>    <span class="at">fig.width=</span><span class="dv">10</span>,</span>
<span id="cb4-5"><a></a>    <span class="at">fig.height=</span><span class="dv">8</span></span>
<span id="cb4-6"><a></a>)</span>
<span id="cb4-7"><a></a><span class="fu">library</span>(dplyr)</span>
<span id="cb4-8"><a></a><span class="fu">library</span>(knitr)</span>
<span id="cb4-9"><a></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb4-10"><a></a><span class="fu">library</span>(reshape2)</span>
<span id="cb4-11"><a></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb4-12"><a></a><span class="fu">library</span>(tidyr)</span>
<span id="cb4-13"><a></a></span>
<span id="cb4-14"><a></a>period<span class="ot">&lt;-</span><span class="dv">20132017</span></span>
<span id="cb4-15"><a></a></span>
<span id="cb4-16"><a></a><span class="co">#率的统计学检验</span></span>
<span id="cb4-17"><a></a>report <span class="ot">&lt;-</span> report<span class="sc">%&gt;%</span></span>
<span id="cb4-18"><a></a>  <span class="fu">group_by</span>(year,sex,code)<span class="sc">%&gt;%</span></span>
<span id="cb4-19"><a></a>  <span class="fu">mutate</span>(<span class="at">y_ics2000=</span><span class="fu">sum</span>(ics2000)<span class="sc">/</span><span class="fu">n</span>(),</span>
<span id="cb4-20"><a></a>         <span class="at">a_ics2000=</span><span class="fu">sum</span>((ics2000<span class="sc">-</span><span class="fu">sum</span>(ics2000)<span class="sc">/</span><span class="fu">n</span>())<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>var_ics2000)<span class="sc">/</span>(<span class="fu">n</span>()<span class="sc">-</span><span class="dv">1</span>),</span>
<span id="cb4-21"><a></a>         <span class="at">a_ics2000=</span><span class="fu">ifelse</span>(a_ics2000<span class="sc">&lt;=</span><span class="dv">1</span>,<span class="dv">1</span>,a_ics2000),</span>
<span id="cb4-22"><a></a>         <span class="at">z_ics2000=</span>(ics2000<span class="sc">-</span><span class="fu">sum</span>(ics2000)<span class="sc">/</span><span class="fu">n</span>())<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>(a_ics2000<span class="sc">*</span>var_ics2000),</span>
<span id="cb4-23"><a></a>        </span>
<span id="cb4-24"><a></a>         <span class="at">y_dcs2000=</span><span class="fu">sum</span>(dcs2000)<span class="sc">/</span><span class="fu">n</span>(),</span>
<span id="cb4-25"><a></a>         <span class="at">a_dcs2000=</span><span class="fu">sum</span>((dcs2000<span class="sc">-</span><span class="fu">sum</span>(dcs2000)<span class="sc">/</span><span class="fu">n</span>())<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>var_dcs2000)<span class="sc">/</span>(<span class="fu">n</span>()<span class="sc">-</span><span class="dv">1</span>),</span>
<span id="cb4-26"><a></a>         <span class="at">a_dcs2000=</span><span class="fu">ifelse</span>(a_dcs2000<span class="sc">&lt;=</span><span class="dv">1</span>,<span class="dv">1</span>,a_dcs2000),</span>
<span id="cb4-27"><a></a>         <span class="at">z_dcs2000=</span>(dcs2000<span class="sc">-</span><span class="fu">sum</span>(dcs2000)<span class="sc">/</span><span class="fu">n</span>())<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>(a_dcs2000<span class="sc">*</span>var_dcs2000),</span>
<span id="cb4-28"><a></a>         </span>
<span id="cb4-29"><a></a>         <span class="at">y_iws85=</span><span class="fu">sum</span>(iws85)<span class="sc">/</span><span class="fu">n</span>(),</span>
<span id="cb4-30"><a></a>         <span class="at">a_iws85=</span><span class="fu">sum</span>((iws85<span class="sc">-</span><span class="fu">sum</span>(iws85)<span class="sc">/</span><span class="fu">n</span>())<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>var_iws85)<span class="sc">/</span>(<span class="fu">n</span>()<span class="sc">-</span><span class="dv">1</span>),</span>
<span id="cb4-31"><a></a>         <span class="at">a_iws85=</span><span class="fu">ifelse</span>(a_iws85<span class="sc">&lt;=</span><span class="dv">1</span>,<span class="dv">1</span>,a_iws85),</span>
<span id="cb4-32"><a></a>         <span class="at">z_iws85=</span>(iws85<span class="sc">-</span><span class="fu">sum</span>(iws85)<span class="sc">/</span><span class="fu">n</span>())<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>(a_iws85<span class="sc">*</span>var_iws85),</span>
<span id="cb4-33"><a></a>         </span>
<span id="cb4-34"><a></a>         <span class="at">y_dws85=</span><span class="fu">sum</span>(dws85)<span class="sc">/</span><span class="fu">n</span>(),</span>
<span id="cb4-35"><a></a>         <span class="at">a_dws85=</span><span class="fu">sum</span>((dws85<span class="sc">-</span><span class="fu">sum</span>(dws85)<span class="sc">/</span><span class="fu">n</span>())<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>var_dws85)<span class="sc">/</span>(<span class="fu">n</span>()<span class="sc">-</span><span class="dv">1</span>),</span>
<span id="cb4-36"><a></a>         <span class="at">a_dws85=</span><span class="fu">ifelse</span>(a_dws85<span class="sc">&lt;=</span><span class="dv">1</span>,<span class="dv">1</span>,a_dws85),</span>
<span id="cb4-37"><a></a>         <span class="at">z_dws85=</span>(dws85<span class="sc">-</span><span class="fu">sum</span>(dws85)<span class="sc">/</span><span class="fu">n</span>())<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>(a_dws85<span class="sc">*</span>var_dws85),</span>
<span id="cb4-38"><a></a>         </span>
<span id="cb4-39"><a></a>         <span class="at">mvn=</span>b5<span class="sc">+</span>b6<span class="sc">+</span>b7,</span>
<span id="cb4-40"><a></a>         <span class="at">p1=</span>(b5<span class="sc">+</span>b6<span class="sc">+</span>b7)<span class="sc">/</span>fhj,</span>
<span id="cb4-41"><a></a>         <span class="at">p=</span><span class="fu">sum</span>(mvn)<span class="sc">/</span><span class="fu">sum</span>(fhj),</span>
<span id="cb4-42"><a></a>         <span class="at">a_mv=</span><span class="fu">sum</span>((mvn<span class="sc">-</span>p<span class="sc">*</span>fhj)<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>(fhj<span class="sc">*</span>p1<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>p1)))<span class="sc">/</span>(<span class="fu">n</span>()<span class="sc">-</span><span class="dv">1</span>),</span>
<span id="cb4-43"><a></a>         <span class="at">z_mv=</span>(mvn<span class="sc">-</span>p<span class="sc">*</span>fhj)<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>(a_mv<span class="sc">*</span>p1<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>p1)<span class="sc">*</span>fhj),</span>
<span id="cb4-44"><a></a>        </span>
<span id="cb4-45"><a></a>         <span class="at">a_mi=</span><span class="fu">sum</span>(shj)<span class="sc">/</span><span class="fu">sum</span>(fhj),</span>
<span id="cb4-46"><a></a>         <span class="at">aa_mi=</span><span class="fu">sum</span>((shj<span class="sc">-</span>a_mi<span class="sc">*</span>fhj)<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>((shj<span class="sc">+</span>fhj)<span class="sc">*</span>a_mi))<span class="sc">/</span>(<span class="fu">n</span>()<span class="sc">-</span><span class="dv">1</span>),</span>
<span id="cb4-47"><a></a>         <span class="at">z_mi=</span>(shj<span class="sc">-</span>a_mi<span class="sc">*</span>fhj)<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>(aa_mi<span class="sc">*</span>(shj<span class="sc">+</span>fhj)<span class="sc">*</span>a_mi),</span>
<span id="cb4-48"><a></a>         </span>
<span id="cb4-49"><a></a></span>
<span id="cb4-50"><a></a><span class="at">diff2_ics2000=</span><span class="fu">ifelse</span>(z_ics2000<span class="sc">&gt;</span><span class="fl">3.84</span> <span class="sc">&amp;</span> ics2000<span class="sc">/</span>y_ics2000<span class="sc">&gt;</span><span class="dv">1</span>, <span class="fu">paste0</span>(<span class="st">"&gt;"</span>,<span class="st">"("</span>,<span class="fu">round</span>(ics2000<span class="sc">/</span>y_ics2000,<span class="dv">1</span>),<span class="st">")"</span>),</span>
<span id="cb4-51"><a></a>              <span class="fu">ifelse</span>(z_ics2000<span class="sc">&gt;</span><span class="fl">3.84</span> <span class="sc">&amp;</span> ics2000<span class="sc">/</span>y_ics2000<span class="sc">&lt;</span><span class="dv">1</span>, <span class="fu">paste0</span>(<span class="st">"&lt;"</span>,<span class="st">"("</span>,<span class="fu">round</span>(ics2000<span class="sc">/</span>y_ics2000,<span class="dv">1</span>),<span class="st">")"</span>),<span class="st">""</span>)),</span>
<span id="cb4-52"><a></a><span class="at">diff2_dcs2000=</span><span class="fu">ifelse</span>(z_dcs2000<span class="sc">&gt;</span><span class="fl">3.84</span> <span class="sc">&amp;</span> dcs2000<span class="sc">/</span>y_dcs2000<span class="sc">&gt;</span><span class="dv">1</span>, <span class="fu">paste0</span>(<span class="st">"&gt;"</span>,<span class="st">"("</span>,<span class="fu">round</span>(dcs2000<span class="sc">/</span>y_dcs2000,<span class="dv">1</span>),<span class="st">")"</span>),</span>
<span id="cb4-53"><a></a>              <span class="fu">ifelse</span>(z_dcs2000<span class="sc">&gt;</span><span class="fl">3.84</span> <span class="sc">&amp;</span> dcs2000<span class="sc">/</span>y_dcs2000<span class="sc">&lt;</span><span class="dv">1</span>, <span class="fu">paste0</span>(<span class="st">"&lt;"</span>,<span class="st">"("</span>,<span class="fu">round</span>(dcs2000<span class="sc">/</span>y_dcs2000,<span class="dv">1</span>),<span class="st">")"</span>),<span class="st">""</span>)),</span>
<span id="cb4-54"><a></a><span class="at">diff2_iws85=</span><span class="fu">ifelse</span>(z_iws85<span class="sc">&gt;</span><span class="fl">3.84</span> <span class="sc">&amp;</span> iws85<span class="sc">/</span>y_iws85<span class="sc">&gt;</span><span class="dv">1</span>, <span class="fu">paste0</span>(<span class="st">"&gt;"</span>,<span class="st">"("</span>,<span class="fu">round</span>(iws85<span class="sc">/</span>y_iws85,<span class="dv">1</span>),<span class="st">")"</span>),</span>
<span id="cb4-55"><a></a>            <span class="fu">ifelse</span>(z_iws85<span class="sc">&gt;</span><span class="fl">3.84</span> <span class="sc">&amp;</span> iws85<span class="sc">/</span>y_iws85<span class="sc">&lt;</span><span class="dv">1</span>, <span class="fu">paste0</span>(<span class="st">"&lt;"</span>,<span class="st">"("</span>,<span class="fu">round</span>(iws85<span class="sc">/</span>y_iws85,<span class="dv">1</span>),<span class="st">")"</span>),<span class="st">""</span>)),</span>
<span id="cb4-56"><a></a><span class="at">diff2_dws85=</span><span class="fu">ifelse</span>(z_dws85<span class="sc">&gt;</span><span class="fl">3.84</span> <span class="sc">&amp;</span> dws85<span class="sc">/</span>y_dws85<span class="sc">&gt;</span><span class="dv">1</span>, <span class="fu">paste0</span>(<span class="st">"&gt;"</span>,<span class="st">"("</span>,<span class="fu">round</span>(dws85<span class="sc">/</span>y_dws85,<span class="dv">1</span>),<span class="st">")"</span>),</span>
<span id="cb4-57"><a></a>            <span class="fu">ifelse</span>(z_dws85<span class="sc">&gt;</span><span class="fl">3.84</span> <span class="sc">&amp;</span> dws85<span class="sc">/</span>y_dws85<span class="sc">&lt;</span><span class="dv">1</span>, <span class="fu">paste0</span>(<span class="st">"&lt;"</span>,<span class="st">"("</span>,<span class="fu">round</span>(dws85<span class="sc">/</span>y_dws85,<span class="dv">1</span>),<span class="st">")"</span>),<span class="st">""</span>)),</span>
<span id="cb4-58"><a></a>         </span>
<span id="cb4-59"><a></a>         <span class="at">diff_mi=</span><span class="fu">ifelse</span>(z_mi<span class="sc">&gt;</span><span class="fl">3.84</span> <span class="sc">&amp;</span> mi<span class="sc">/</span>a_mi<span class="sc">&gt;</span><span class="dv">1</span>,<span class="fu">paste0</span>(<span class="st">"&gt;"</span>,<span class="st">"("</span>,<span class="fu">round</span>(mi<span class="sc">/</span>a_mi,<span class="dv">1</span>),<span class="st">")"</span>),</span>
<span id="cb4-60"><a></a>                        <span class="fu">ifelse</span>(z_mi<span class="sc">&gt;</span><span class="fl">3.84</span> <span class="sc">&amp;</span> mi<span class="sc">/</span>a_mi<span class="sc">&lt;</span><span class="dv">1</span>,<span class="fu">paste0</span>(<span class="st">"&lt;"</span>,<span class="st">"("</span>,<span class="fu">round</span>(mi<span class="sc">/</span>a_mi,<span class="dv">1</span>),<span class="st">")"</span>),<span class="st">""</span>)),</span>
<span id="cb4-61"><a></a>         <span class="at">diff_mv=</span><span class="fu">ifelse</span>(z_mv<span class="sc">&gt;</span><span class="fl">3.84</span> <span class="sc">&amp;</span> p1<span class="sc">/</span>p<span class="sc">&gt;</span><span class="dv">1</span>,<span class="fu">paste0</span>(<span class="st">"&gt;"</span>,<span class="st">"("</span>,<span class="fu">round</span>(p1<span class="sc">/</span>p,<span class="dv">1</span>),<span class="st">")"</span>),</span>
<span id="cb4-62"><a></a>                        <span class="fu">ifelse</span>(z_mv<span class="sc">&gt;</span><span class="fl">3.84</span> <span class="sc">&amp;</span> p1<span class="sc">/</span>p<span class="sc">&lt;</span><span class="dv">1</span>,<span class="fu">paste0</span>(<span class="st">"&lt;"</span>,<span class="st">"("</span>,<span class="fu">round</span>(p1<span class="sc">/</span>p,<span class="dv">1</span>),<span class="st">")"</span>),<span class="st">""</span>))</span>
<span id="cb4-63"><a></a>         </span>
<span id="cb4-64"><a></a>         )<span class="sc">%&gt;%</span></span>
<span id="cb4-65"><a></a>  <span class="fu">ungroup</span>()<span class="sc">%&gt;%</span></span>
<span id="cb4-66"><a></a>  <span class="fu">select</span>(<span class="sc">-</span>a_ics2000,<span class="sc">-</span>z_ics2000,<span class="sc">-</span>a_dcs2000,<span class="sc">-</span>z_dcs2000,<span class="sc">-</span>y_iws85,<span class="sc">-</span>a_iws85,<span class="sc">-</span>z_iws85,<span class="sc">-</span>y_dws85,<span class="sc">-</span>a_dws85,<span class="sc">-</span>z_dws85,<span class="sc">-</span>mvn,<span class="sc">-</span>a_mv,<span class="sc">-</span>z_mv,<span class="sc">-</span>aa_mi,<span class="sc">-</span>z_mi)</span>
<span id="cb4-67"><a></a></span>
<span id="cb4-68"><a></a></span>
<span id="cb4-69"><a></a></span>
<span id="cb4-70"><a></a>quality <span class="ot">&lt;-</span> haven<span class="sc">::</span><span class="fu">read_sas</span>(<span class="st">"Y:/CanReg/statistic/code/create_report/codedata/quality.sas7bdat"</span>)</span>
<span id="cb4-71"><a></a>quality <span class="ot">&lt;-</span> quality <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">city=</span><span class="fu">ifelse</span>(city<span class="sc">==</span><span class="dv">0</span>,<span class="dv">2</span>,<span class="dv">1</span>),<span class="at">city=</span><span class="fu">as.character</span>(city))</span>
<span id="cb4-72"><a></a>site <span class="ot">&lt;-</span> <span class="fu">unique</span>(registry[registry<span class="sc">$</span>name<span class="sc">==</span>state,<span class="fu">c</span>(<span class="st">"areacode"</span>)]<span class="sc">$</span>areacode)</span>
<span id="cb4-73"><a></a></span>
<span id="cb4-74"><a></a><span class="co">#levels &lt;- c(110,104,103,106,112,105,113,120,115,116,119,122)</span></span>
<span id="cb4-75"><a></a><span class="co">#labels &lt;- c("肺","胃","食管","肝","乳房","结直肠","宫颈","甲状腺","卵巢","前列腺","脑","白血病")</span></span>
<span id="cb4-76"><a></a></span>
<span id="cb4-77"><a></a>levels<span class="ot">=</span><span class="fu">c</span>(<span class="dv">122</span>,<span class="dv">121</span>,<span class="dv">120</span>,<span class="dv">119</span>,<span class="dv">113</span>,<span class="dv">112</span>,<span class="dv">105</span>,<span class="dv">103</span>,<span class="dv">106</span>,<span class="dv">104</span>,<span class="dv">110</span>,<span class="dv">62</span>)</span>
<span id="cb4-78"><a></a>labels<span class="ot">=</span><span class="fu">c</span>(<span class="st">"白血病"</span>,<span class="st">"淋巴瘤"</span>,<span class="st">"甲状腺"</span>,<span class="st">"脑"</span>,<span class="st">"宫颈"</span>,<span class="st">"乳房"</span>,<span class="st">"结直肠"</span>,<span class="st">"食管"</span>,<span class="st">"肝"</span>,<span class="st">"胃"</span>,<span class="st">"肺"</span>,<span class="st">"所有部位"</span>)</span>
<span id="cb4-79"><a></a></span>
<span id="cb4-80"><a></a></span>
<span id="cb4-81"><a></a>years<span class="ot">&lt;-</span>report[report<span class="sc">$</span>areacode<span class="sc">==</span>site<span class="sc">&amp;!</span>(report<span class="sc">$</span>year<span class="sc">%in%</span><span class="fu">c</span>(<span class="st">"20132017"</span>,<span class="st">"20182022"</span>)),<span class="fu">c</span>(<span class="st">"year"</span>)]<span class="sc">$</span>year</span>
<span id="cb4-82"><a></a>max<span class="ot">&lt;-</span><span class="fu">as.numeric</span>(<span class="fu">max</span>(years))</span>
<span id="cb4-83"><a></a>min<span class="ot">&lt;-</span><span class="fu">as.numeric</span>(<span class="fu">min</span>(years))</span>
<span id="cb4-84"><a></a>caption2<span class="ot">&lt;-</span><span class="fu">paste0</span>(<span class="st">"图中&gt;(O/E)或&lt;(O/E)表示登记处指标与同期河南省各登记处的平均值相比具有统计学意义</span><span class="sc">\n</span><span class="st">(O/E)表示登记处指标与平均值指标的比值"</span>)</span>
<span id="cb4-85"><a></a></span>
<span id="cb4-86"><a></a></span>
<span id="cb4-87"><a></a>pop <span class="ot">&lt;-</span> report<span class="sc">%&gt;%</span><span class="fu">filter</span>(areacode<span class="sc">==</span>site,sex<span class="sc">==</span><span class="st">"合计"</span>,code<span class="sc">==</span><span class="dv">62</span>,year<span class="sc">==</span><span class="st">"2017"</span>)<span class="sc">%&gt;%</span><span class="fu">select</span>(rhj)</span>
<span id="cb4-88"><a></a>pop <span class="ot">&lt;-</span>pop<span class="sc">$</span>rhj</span>
<span id="cb4-89"><a></a></span>
<span id="cb4-90"><a></a>mv <span class="ot">&lt;-</span> report<span class="sc">%&gt;%</span><span class="fu">filter</span>(areacode<span class="sc">==</span>site,sex<span class="sc">==</span><span class="st">"合计"</span>,code<span class="sc">==</span><span class="dv">62</span>,year<span class="sc">==</span><span class="st">"20132017"</span>)<span class="sc">%&gt;%</span><span class="fu">select</span>(mv)</span>
<span id="cb4-91"><a></a>mv <span class="ot">&lt;-</span>mv<span class="sc">$</span>mv</span>
<span id="cb4-92"><a></a></span>
<span id="cb4-93"><a></a>mi <span class="ot">&lt;-</span> report<span class="sc">%&gt;%</span><span class="fu">filter</span>(areacode<span class="sc">==</span>site,sex<span class="sc">==</span><span class="st">"合计"</span>,code<span class="sc">==</span><span class="dv">62</span>,year<span class="sc">==</span><span class="st">"20132017"</span>)<span class="sc">%&gt;%</span><span class="fu">select</span>(mi)</span>
<span id="cb4-94"><a></a>mi <span class="ot">&lt;-</span>mi<span class="sc">$</span>mi</span>
<span id="cb4-95"><a></a></span>
<span id="cb4-96"><a></a>cr_color_block <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb4-97"><a></a>  <span class="fu">theme_classic</span>()<span class="sc">+</span></span>
<span id="cb4-98"><a></a>  <span class="fu">theme</span>(</span>
<span id="cb4-99"><a></a>    <span class="at">legend.title=</span> <span class="fu">element_blank</span>(),</span>
<span id="cb4-100"><a></a>    <span class="at">legend.position=</span> <span class="st">"top"</span>,</span>
<span id="cb4-101"><a></a>    <span class="at">strip.text=</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>,<span class="at">face=</span><span class="st">"bold.italic"</span>),</span>
<span id="cb4-102"><a></a>    <span class="at">strip.background=</span> <span class="fu">element_rect</span>(<span class="at">color=</span><span class="st">"white"</span>,<span class="at">size=</span><span class="dv">0</span>),</span>
<span id="cb4-103"><a></a>    <span class="at">axis.line=</span> <span class="fu">element_blank</span>(),</span>
<span id="cb4-104"><a></a>    <span class="at">axis.ticks=</span> <span class="fu">element_blank</span>(),</span>
<span id="cb4-105"><a></a>    <span class="at">axis.title=</span> <span class="fu">element_blank</span>(),</span>
<span id="cb4-106"><a></a>    <span class="at">axis.text=</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">11</span>,<span class="at">face=</span><span class="st">"bold.italic"</span>),</span>
<span id="cb4-107"><a></a>    <span class="at">axis.text.x=</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">11</span>,<span class="at">face=</span><span class="st">"bold.italic"</span>,<span class="at">angle =</span> <span class="dv">90</span>),</span>
<span id="cb4-108"><a></a>    <span class="at">plot.title=</span> <span class="fu">element_text</span>(<span class="at">face=</span><span class="st">"bold"</span>, <span class="at">size=</span><span class="dv">14</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb4-109"><a></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">face=</span><span class="st">"bold"</span>,<span class="at">size=</span><span class="dv">10</span>,<span class="at">hjust=</span><span class="fl">0.5</span>),</span>
<span id="cb4-110"><a></a>    <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">8</span>)</span>
<span id="cb4-111"><a></a>  )</span>
<span id="cb4-112"><a></a>}</span>
<span id="cb4-113"><a></a></span>
<span id="cb4-114"><a></a></span>
<span id="cb4-115"><a></a>cr_grid <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb4-116"><a></a>  <span class="fu">theme_light</span>()<span class="sc">+</span></span>
<span id="cb4-117"><a></a>  <span class="fu">theme</span>(</span>
<span id="cb4-118"><a></a>    <span class="at">legend.title=</span> <span class="fu">element_blank</span>(),</span>
<span id="cb4-119"><a></a>    <span class="at">legend.position=</span> <span class="st">"bottom"</span>,</span>
<span id="cb4-120"><a></a>    <span class="at">strip.text=</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>,<span class="at">face=</span><span class="st">"bold.italic"</span>),</span>
<span id="cb4-121"><a></a>    <span class="at">strip.background=</span> <span class="fu">element_rect</span>(<span class="at">color=</span><span class="st">"white"</span>,<span class="at">size=</span><span class="dv">0</span>),</span>
<span id="cb4-122"><a></a>    <span class="at">axis.line.y=</span> <span class="fu">element_blank</span>(),</span>
<span id="cb4-123"><a></a>    <span class="at">axis.ticks.y=</span> <span class="fu">element_blank</span>(),</span>
<span id="cb4-124"><a></a>    <span class="at">axis.title=</span> <span class="fu">element_blank</span>(),</span>
<span id="cb4-125"><a></a>    <span class="at">axis.text=</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">9</span>,<span class="at">face=</span><span class="st">"bold.italic"</span>),</span>
<span id="cb4-126"><a></a>    <span class="at">plot.title=</span> <span class="fu">element_text</span>(<span class="at">face=</span><span class="st">"bold"</span>, <span class="at">size=</span><span class="dv">14</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb4-127"><a></a>    <span class="at">plot.subtitle=</span><span class="fu">element_text</span>(<span class="at">face=</span><span class="st">"bold.italic"</span>,<span class="at">size=</span><span class="dv">12</span>,<span class="at">hjust=</span><span class="fl">0.5</span>),</span>
<span id="cb4-128"><a></a>    <span class="co"># add border 1)</span></span>
<span id="cb4-129"><a></a>    <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">colour =</span> <span class="st">"blue"</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">linetype =</span> <span class="dv">2</span>),</span>
<span id="cb4-130"><a></a>    <span class="co"># color background 2)</span></span>
<span id="cb4-131"><a></a>    <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"aliceblue"</span>),</span>
<span id="cb4-132"><a></a>    <span class="co"># modify grid 3)</span></span>
<span id="cb4-133"><a></a>    <span class="at">panel.grid.major.x =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">"steelblue"</span>, <span class="at">linetype =</span> <span class="dv">3</span>, <span class="at">size =</span> <span class="fl">0.5</span>),</span>
<span id="cb4-134"><a></a>    <span class="at">panel.grid.minor.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb4-135"><a></a>    <span class="at">panel.grid.major.y =</span>  <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">"steelblue"</span>, <span class="at">linetype =</span> <span class="dv">3</span>, <span class="at">size =</span> <span class="fl">0.5</span>),</span>
<span id="cb4-136"><a></a>    <span class="at">panel.grid.minor.y =</span> <span class="fu">element_blank</span>()</span>
<span id="cb4-137"><a></a>  )</span>
<span id="cb4-138"><a></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="cancer-incidence-in-five-continents-iarc-2" class="slide level2">
<h2>Cancer Incidence in Five Continents-IARC</h2>
<h3 id="代码块-2">代码块</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a></a><span class="cf">for</span> (i <span class="cf">in</span> min<span class="sc">:</span>max) {</span>
<span id="cb5-2"><a></a> report <span class="sc">%&gt;%</span></span>
<span id="cb5-3"><a></a>  <span class="fu">filter</span>(areacode<span class="sc">==</span>site, code<span class="sc">==</span><span class="dv">62</span>, <span class="sc">!</span>(sex<span class="sc">==</span><span class="st">"合计"</span>), year<span class="sc">==</span>i)<span class="sc">%&gt;%</span></span>
<span id="cb5-4"><a></a>  <span class="fu">select</span>(year,sex,r0<span class="sc">:</span>r85)<span class="sc">%&gt;%</span></span>
<span id="cb5-5"><a></a>  <span class="fu">gather</span>(<span class="st">"agegrp"</span>,<span class="st">"rks"</span>,<span class="sc">-</span>year,<span class="sc">-</span>sex)<span class="sc">%&gt;%</span></span>
<span id="cb5-6"><a></a>  <span class="fu">mutate</span>(<span class="at">agegrp=</span><span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">"[^0-9]"</span>, <span class="st">""</span>, agegrp)),</span>
<span id="cb5-7"><a></a>         <span class="at">rks=</span><span class="fu">ifelse</span>(sex<span class="sc">==</span><span class="st">"男性"</span>,<span class="sc">-</span>rks,rks),</span>
<span id="cb5-8"><a></a>         <span class="at">agegrp=</span><span class="fu">factor</span>(agegrp,<span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"0"</span>,<span class="st">"1-4"</span>,<span class="st">"5-9"</span>,<span class="st">"10-14"</span>,<span class="st">"15-19"</span>,<span class="st">"20-24"</span>,<span class="st">"25-29"</span>,<span class="st">"30-34"</span>,<span class="st">"35-39"</span>,<span class="st">"40-44"</span>,<span class="st">"45-49"</span>,<span class="st">"50-54"</span>,<span class="st">"55-59"</span>,<span class="st">"60-64"</span>,<span class="st">"65-69"</span>,<span class="st">"70-74"</span>,<span class="st">"75-79"</span>,<span class="st">"80-84"</span>,<span class="st">"85+"</span>)))<span class="sc">%&gt;%</span></span>
<span id="cb5-9"><a></a>  <span class="fu">group_by</span>(sex)<span class="sc">%&gt;%</span></span>
<span id="cb5-10"><a></a>  <span class="fu">mutate</span>(<span class="at">rks=</span><span class="fu">round</span>(rks<span class="sc">/</span><span class="fu">sum</span>(rks),<span class="dv">2</span>),</span>
<span id="cb5-11"><a></a>         <span class="at">rks=</span><span class="fu">ifelse</span>(sex<span class="sc">==</span><span class="st">"男性"</span>,<span class="sc">-</span>rks,rks))<span class="sc">%&gt;%</span></span>
<span id="cb5-12"><a></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span><span class="fu">factor</span>(agegrp),<span class="at">y=</span>rks,<span class="at">fill=</span>sex)) <span class="sc">+</span></span>
<span id="cb5-13"><a></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>,<span class="at">position =</span> <span class="st">"identity"</span>,<span class="at">color=</span><span class="st">"black"</span>,<span class="at">size=</span><span class="fl">0.25</span>)<span class="sc">+</span></span>
<span id="cb5-14"><a></a>  <span class="fu">coord_flip</span>()<span class="sc">+</span></span>
<span id="cb5-15"><a></a>  <span class="fu">theme_classic</span>()<span class="sc">+</span></span>
<span id="cb5-16"><a></a>  <span class="fu">xlab</span>(<span class="st">""</span>)<span class="sc">+</span></span>
<span id="cb5-17"><a></a>  <span class="fu">ylab</span>(<span class="st">""</span>)<span class="sc">+</span></span>
<span id="cb5-18"><a></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.12</span>,<span class="fl">0.12</span>),<span class="at">breaks=</span><span class="fu">seq</span>(<span class="sc">-</span><span class="fl">0.12</span>,<span class="fl">0.12</span>,<span class="fl">0.02</span>),<span class="at">labels =</span> <span class="cf">function</span>(x) <span class="fu">paste0</span>(<span class="fu">abs</span>(x) <span class="sc">*</span> <span class="dv">100</span>, <span class="st">'%'</span>))<span class="sc">+</span></span>
<span id="cb5-19"><a></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">"历年人口金字塔变化情况"</span>,<span class="at">subtitle=</span><span class="fu">paste</span>(i))<span class="sc">+</span></span>
<span id="cb5-20"><a></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.1</span>,<span class="fl">0.9</span>),</span>
<span id="cb5-21"><a></a>        <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb5-22"><a></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>, <span class="at">face=</span><span class="st">"bold.italic"</span>),</span>
<span id="cb5-23"><a></a>        <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">color=</span><span class="st">"white"</span>, <span class="at">size=</span><span class="dv">0</span>),</span>
<span id="cb5-24"><a></a>        <span class="at">axis.text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>),</span>
<span id="cb5-25"><a></a>        <span class="at">axis.title=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">12</span>, <span class="at">face=</span><span class="st">"bold"</span>),</span>
<span id="cb5-26"><a></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face=</span><span class="st">"bold"</span>, <span class="at">size=</span><span class="dv">14</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb5-27"><a></a>        <span class="at">plot.subtitle=</span><span class="fu">element_text</span>(<span class="at">face=</span><span class="st">"bold"</span>,<span class="at">size=</span><span class="dv">13</span>,<span class="at">hjust=</span><span class="fl">0.8</span>,<span class="at">colour=</span><span class="st">"tomato"</span>))<span class="ot">-&gt;</span>p</span>
<span id="cb5-28"><a></a>  <span class="fu">plot</span>(p)</span>
<span id="cb5-29"><a></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="cancer-incidence-in-five-continents-iarc-3" class="slide level2">
<h2>Cancer Incidence in Five Continents-IARC</h2>
<h3 id="markdown文本-1">Markdown文本</h3>
<div class="sourceCode" id="cb6"><pre class="sourceCode numberSource md number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb6-1"><a></a><span class="fu"># 基本情况介绍</span></span>
<span id="cb6-2"><a></a></span>
<span id="cb6-3"><a></a>肿瘤登记处拟上报至年肿瘤登记数据至五大洲发病率第12卷。</span>
<span id="cb6-4"><a></a></span>
<span id="cb6-5"><a></a>河南省肿瘤登记处按照《五大洲发病率》收录数据审核标准对河南省各登记处拟上报年份范围的数据质量进行了图形化展示，各登记处可根据审核结果完善核实本登记处数据！</span>
<span id="cb6-6"><a></a></span>
<span id="cb6-7"><a></a><span class="at">&gt;本结果分如下几个部分：</span></span>
<span id="cb6-8"><a></a></span>
<span id="cb6-9"><a></a><span class="at">&gt;1. 基本情况介绍 </span></span>
<span id="cb6-10"><a></a><span class="at">&gt;1. 人口数据审核</span></span>
<span id="cb6-11"><a></a><span class="at">&gt;1. 总体癌症发病死亡情况</span></span>
<span id="cb6-12"><a></a><span class="at">&gt;1. 主要部位癌症发病死亡情况</span></span>
<span id="cb6-13"><a></a><span class="at">&gt;1. 年龄别率</span></span>
<span id="cb6-14"><a></a><span class="at">&gt;1. 儿童肿瘤发病率/死亡率</span></span>
<span id="cb6-15"><a></a><span class="at">&gt;1. 主要质量控制指标情况(登记癌种数、MV%、M:I、DCO%)</span></span>
<span id="cb6-16"><a></a></span>
<span id="cb6-17"><a></a><span class="fu"># 人口数据审核</span></span>
<span id="cb6-18"><a></a></span>
<span id="cb6-19"><a></a><span class="at">&gt;人口数据质量对于肿瘤登记数据质量至关重要，本程序对于人口数据的审核从**人口总数**、**人口性别比例**、以&gt;及**人口金字塔**等三个方面进行。</span></span>
<span id="cb6-20"><a></a></span>
<span id="cb6-21"><a></a><span class="fu">## 人口总数变化情况</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="cancer-incidence-in-five-continents-iarc-4" class="slide level2">
<h2>Cancer Incidence in Five Continents-IARC</h2>
<div class="cell">
<iframe src="https://www.chenq.site/slides/2023-5-16-canreg-report/example.html" width="960" height="600px" data-external="1">
</iframe>
</div>
</section>
<section id="cancer-incidence-in-five-continents-iarc-5" class="slide level2">
<h2>Cancer Incidence in Five Continents-IARC</h2>
<h3 id="报告输出的批量化">报告输出的批量化</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a></a><span class="do">###五大洲数据审核程序#</span></span>
<span id="cb7-2"><a></a><span class="fu">library</span>(dplyr)</span>
<span id="cb7-3"><a></a><span class="fu">library</span>(RODBC)</span>
<span id="cb7-4"><a></a>state.name<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">"开封市祥符区"</span>,<span class="st">"洛阳市城区"</span>,<span class="st">"孟津县"</span>,<span class="st">"新安县"</span>,<span class="st">"栾川县"</span>,<span class="st">"嵩县"</span>,<span class="st">"汝阳县"</span>,</span>
<span id="cb7-5"><a></a>              <span class="st">"宜阳县"</span>,<span class="st">"偃师市"</span>,<span class="st">"鲁山县"</span>,<span class="st">"林州市"</span>,<span class="st">"鹤壁市城区"</span>,<span class="st">"辉县市"</span>,<span class="st">"濮阳市华龙区"</span>,</span>
<span id="cb7-6"><a></a>              <span class="st">"濮阳县"</span>,<span class="st">"漯河市郾城区"</span>,<span class="st">"漯河市召陵区"</span>,<span class="st">"漯河市源汇区"</span>,<span class="st">"三门峡市湖滨区"</span>,<span class="st">"方城县"</span>,</span>
<span id="cb7-7"><a></a>              <span class="st">"内乡县"</span>,<span class="st">"睢县"</span>,<span class="st">"虞城县"</span>,<span class="st">"罗山县"</span>,<span class="st">"沈丘县"</span>,<span class="st">"郸城县"</span>,<span class="st">"西平县"</span>,<span class="st">"济源市"</span>)</span>
<span id="cb7-8"><a></a></span>
<span id="cb7-9"><a></a>db<span class="ot">&lt;-</span><span class="fu">file.path</span>(<span class="st">"../create_report/Codedata/code.mdb"</span>) </span>
<span id="cb7-10"><a></a>channel<span class="ot">&lt;-</span><span class="fu">odbcConnectAccess2007</span>(db)</span>
<span id="cb7-11"><a></a>data<span class="ot">&lt;-</span><span class="fu">sqlFetch</span>(channel,<span class="st">"registry"</span>)</span>
<span id="cb7-12"><a></a>data1<span class="ot">&lt;-</span>data<span class="sc">%&gt;%</span><span class="fu">filter</span>(<span class="sc">!</span>(<span class="fu">is.na</span>(CI512)))</span>
<span id="cb7-13"><a></a></span>
<span id="cb7-14"><a></a>report<span class="ot">&lt;-</span>haven<span class="sc">::</span><span class="fu">read_sas</span>(<span class="st">"../create_report/tmpdata/report.sas7bdat"</span>)</span>
<span id="cb7-15"><a></a>pro<span class="ot">&lt;-</span>report<span class="sc">%&gt;%</span><span class="fu">filter</span>(name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"全省"</span>))</span>
<span id="cb7-16"><a></a>report<span class="ot">&lt;-</span>report<span class="sc">%&gt;%</span><span class="fu">filter</span>((name <span class="sc">%in%</span> state.name))</span>
<span id="cb7-17"><a></a>registry<span class="ot">&lt;-</span> report<span class="sc">%&gt;%</span></span>
<span id="cb7-18"><a></a>  <span class="fu">select</span>(areacode,name)<span class="sc">%&gt;%</span></span>
<span id="cb7-19"><a></a>  <span class="fu">filter</span>(<span class="sc">!</span>(<span class="fu">substr</span>(areacode,<span class="dv">1</span>,<span class="dv">1</span>)<span class="sc">==</span><span class="st">"9"</span>))<span class="sc">%&gt;%</span></span>
<span id="cb7-20"><a></a>  <span class="fu">distinct</span>(<span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb7-21"><a></a></span>
<span id="cb7-22"><a></a><span class="cf">for</span> (state <span class="cf">in</span> state.name) {</span>
<span id="cb7-23"><a></a>  areacode<span class="ot">&lt;-</span>registry[registry<span class="sc">$</span>name<span class="sc">==</span>state,<span class="fu">c</span>(<span class="st">"areacode"</span>)]<span class="sc">$</span>areacode</span>
<span id="cb7-24"><a></a>  <span class="fu">dir.create</span>(<span class="fu">paste0</span>(<span class="st">"./Output/CI5check/"</span>,areacode,state))</span>
<span id="cb7-25"><a></a>  rmarkdown<span class="sc">::</span><span class="fu">render</span>(</span>
<span id="cb7-26"><a></a>    <span class="at">input =</span> <span class="st">'./Rmd_template/CI5check.Rmd'</span>,</span>
<span id="cb7-27"><a></a>    <span class="at">output_file =</span> <span class="st">'index.html'</span>,</span>
<span id="cb7-28"><a></a>    <span class="at">output_dir =</span> <span class="fu">paste0</span>(<span class="st">"./Output/CI5check/"</span>,areacode,state)</span>
<span id="cb7-29"><a></a>  )</span>
<span id="cb7-30"><a></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="cancer-incidence-in-five-continents-iarc-6" class="slide level2">
<h2>Cancer Incidence in Five Continents-IARC</h2>
<h3 id="报告输出的批量化-1">报告输出的批量化</h3>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="images/list.png"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="images/list2.png"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="基于bookdown撰写肿瘤登记年报" class="slide level2">
<h2>基于bookdown撰写《肿瘤登记年报》</h2>
<h3 id="bookdown.yml">_bookdown.yml</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a></a>book_filename<span class="sc">:</span> bookdown</span>
<span id="cb8-2"><a></a>clean<span class="sc">:</span> [packages.bib, bookdown.bbl]</span>
<span id="cb8-3"><a></a>delete_merged_file<span class="sc">:</span> true</span>
<span id="cb8-4"><a></a>new_session<span class="sc">:</span> true</span>
<span id="cb8-5"><a></a>language<span class="sc">:</span></span>
<span id="cb8-6"><a></a>  label<span class="sc">:</span></span>
<span id="cb8-7"><a></a>    fig<span class="sc">:</span> <span class="st">"图 "</span></span>
<span id="cb8-8"><a></a>    tab<span class="sc">:</span> <span class="st">"表 "</span></span>
<span id="cb8-9"><a></a>  ui<span class="sc">:</span></span>
<span id="cb8-10"><a></a>    edit<span class="sc">:</span> <span class="st">"编辑"</span></span>
<span id="cb8-11"><a></a>    chapter_name<span class="sc">:</span> [<span class="st">"第 "</span>, <span class="st">" 章"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="基于bookdown撰写肿瘤登记年报-1" class="slide level2">
<h2>基于bookdown撰写《肿瘤登记年报》</h2>
<h3 id="output.yml">_output.yml</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a></a>bookdown<span class="sc">::</span>gitbook<span class="sc">:</span></span>
<span id="cb9-2"><a></a>  css<span class="sc">:</span> css<span class="sc">/</span>style.css</span>
<span id="cb9-3"><a></a>  config<span class="sc">:</span></span>
<span id="cb9-4"><a></a>    toc<span class="sc">:</span></span>
<span id="cb9-5"><a></a>      collapse<span class="sc">:</span> none</span>
<span id="cb9-6"><a></a>      before<span class="sc">:</span> <span class="er">|</span></span>
<span id="cb9-7"><a></a>        <span class="er">&lt;</span>li<span class="sc">&gt;</span><span class="er">&lt;</span>a href<span class="ot">=</span><span class="st">"./"</span><span class="sc">&gt;</span><span class="dv">2021</span>河南省肿瘤登记年报<span class="sc">&lt;</span><span class="er">/</span>a<span class="sc">&gt;</span><span class="er">&lt;/</span>li<span class="sc">&gt;</span></span>
<span id="cb9-8"><a></a>      after<span class="sc">:</span> <span class="er">|</span></span>
<span id="cb9-9"><a></a>        <span class="er">&lt;</span>li<span class="sc">&gt;</span><span class="er">&lt;</span>a href<span class="ot">=</span><span class="st">"https://chenq.site"</span> target<span class="ot">=</span><span class="st">"blank"</span><span class="sc">&gt;</span>Qiong Chen<span class="sc">&lt;</span><span class="er">/</span>a<span class="sc">&gt;</span><span class="er">&lt;/</span>li<span class="sc">&gt;</span></span>
<span id="cb9-10"><a></a>    search<span class="sc">:</span> yes</span>
<span id="cb9-11"><a></a>    sharing<span class="sc">:</span></span>
<span id="cb9-12"><a></a>      github<span class="sc">:</span> yes</span>
<span id="cb9-13"><a></a>      weibo<span class="sc">:</span> yes</span>
<span id="cb9-14"><a></a>bookdown<span class="sc">::</span>markdown_document2<span class="sc">:</span></span>
<span id="cb9-15"><a></a>  base_format<span class="sc">:</span> officedown<span class="sc">::</span>rdocx_document</span>
<span id="cb9-16"><a></a>  lists<span class="sc">:</span></span>
<span id="cb9-17"><a></a>    ol.style<span class="sc">:</span> Default ol</span>
<span id="cb9-18"><a></a>    ul.style<span class="sc">:</span> Default ul</span>
<span id="cb9-19"><a></a>  tables<span class="sc">:</span></span>
<span id="cb9-20"><a></a>    conditional<span class="sc">:</span></span>
<span id="cb9-21"><a></a>      first_row<span class="sc">:</span> true</span>
<span id="cb9-22"><a></a>      first_column<span class="sc">:</span> true</span>
<span id="cb9-23"><a></a>      last_row<span class="sc">:</span> false</span>
<span id="cb9-24"><a></a>      last_column<span class="sc">:</span> false</span>
<span id="cb9-25"><a></a>      no_hband<span class="sc">:</span> false</span>
<span id="cb9-26"><a></a>      no_vband<span class="sc">:</span> true</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="基于bookdown撰写肿瘤登记年报-2" class="slide level2">
<h2>基于bookdown撰写《肿瘤登记年报》</h2>
<h3 id="yaml元数据-1">yaml元数据</h3>
<div class="sourceCode" id="cb10"><pre class="sourceCode numberSource yaml number-lines code-with-copy"><code class="sourceCode yaml"><span id="cb10-1"><a></a><span class="pp">--- </span></span>
<span id="cb10-2"><a></a><span class="fu">title</span><span class="kw">:</span><span class="at"> </span><span class="st">"2022河南省肿瘤登记年报"</span></span>
<span id="cb10-3"><a></a><span class="fu">author</span><span class="kw">:</span><span class="at"> </span><span class="st">"主编 张建功 张韶凯"</span></span>
<span id="cb10-4"><a></a><span class="fu">date</span><span class="kw">:</span><span class="at"> 2022-4-1</span></span>
<span id="cb10-5"><a></a><span class="fu">output</span><span class="kw">:</span></span>
<span id="cb10-6"><a></a><span class="at">  </span><span class="fu">html_document</span><span class="kw">:</span></span>
<span id="cb10-7"><a></a><span class="at">    </span><span class="fu">df_print</span><span class="kw">:</span><span class="at"> paged</span></span>
<span id="cb10-8"><a></a><span class="at">  bookdown:</span><span class="fu">:word_document2</span><span class="kw">:</span><span class="at"> </span></span>
<span id="cb10-9"><a></a><span class="at">    </span><span class="fu">toc</span><span class="kw">:</span><span class="at"> </span><span class="ch">yes</span></span>
<span id="cb10-10"><a></a><span class="at">    </span><span class="fu">reference_docx</span><span class="kw">:</span><span class="at"> </span><span class="st">"./data/format.docx"</span></span>
<span id="cb10-11"><a></a><span class="at">  </span><span class="fu">pdf_document</span><span class="kw">:</span><span class="at"> default</span></span>
<span id="cb10-12"><a></a><span class="fu">always_allow_html</span><span class="kw">:</span><span class="at"> </span><span class="ch">yes</span></span>
<span id="cb10-13"><a></a><span class="fu">bibliography</span><span class="kw">:</span></span>
<span id="cb10-14"><a></a><span class="kw">-</span><span class="at"> book.bib</span></span>
<span id="cb10-15"><a></a><span class="kw">-</span><span class="at"> packages.bib</span></span>
<span id="cb10-16"><a></a><span class="fu">description</span><span class="kw">:</span><span class="at"> 河南省肿瘤登记年报</span></span>
<span id="cb10-17"><a></a><span class="fu">documentclass</span><span class="kw">:</span><span class="at"> ctexbook</span></span>
<span id="cb10-18"><a></a><span class="fu">colorlinks</span><span class="kw">:</span><span class="at"> </span><span class="ch">yes</span></span>
<span id="cb10-19"><a></a><span class="fu">site</span><span class="kw">:</span><span class="at"> bookdown::bookdown_site</span></span>
<span id="cb10-20"><a></a><span class="fu">biblio-style</span><span class="kw">:</span><span class="at"> apalike</span></span>
<span id="cb10-21"><a></a><span class="pp">---</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="基于bookdown撰写肿瘤登记年报-3" class="slide level2">
<h2>基于bookdown撰写《肿瘤登记年报》</h2>
<h3 id="报告文本撰写">报告文本撰写</h3>
<div class="columns">
<div class="column" style="width:30%;">
<ul>
<li>index.Rmd</li>
<li>01summary.Rmd</li>
<li>02-method.Rmd</li>
<li>03-quality.Rmd</li>
<li>04-total_cancer.Rmd</li>
<li>05-eachsite.Rmd</li>
</ul>
</div><div class="column" style="width:70%;">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="images/page.jpg"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="基于bookdown撰写肿瘤登记年报-4" class="slide level2">
<h2>基于bookdown撰写《肿瘤登记年报》</h2>
<h3 id="图表批量生成">图表批量生成</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a></a><span class="do">#####</span></span>
<span id="cb11-2"><a></a><span class="co"># 年度数据审核##</span></span>
<span id="cb11-3"><a></a><span class="do">#####</span></span>
<span id="cb11-4"><a></a></span>
<span id="cb11-5"><a></a><span class="fu">library</span>(dplyr)</span>
<span id="cb11-6"><a></a><span class="fu">library</span>(reshape2)</span>
<span id="cb11-7"><a></a><span class="fu">require</span>(ggplot2)</span>
<span id="cb11-8"><a></a><span class="fu">library</span>(ggsci)</span>
<span id="cb11-9"><a></a><span class="fu">library</span>(cowplot)</span>
<span id="cb11-10"><a></a><span class="fu">library</span>(stringr)</span>
<span id="cb11-11"><a></a><span class="fu">library</span>(ggpubr)</span>
<span id="cb11-12"><a></a><span class="fu">library</span>(extrafont)</span>
<span id="cb11-13"><a></a><span class="co">#font_import() # 导入系统中已经安装的字体，包括中文字体</span></span>
<span id="cb11-14"><a></a><span class="co"># 恢复默认的主题设置</span></span>
<span id="cb11-15"><a></a><span class="fu">loadfonts</span>() <span class="co"># 加载已经导入的字体</span></span>
<span id="cb11-16"><a></a><span class="co">#font &lt;- "SimHei" # 指定中文字体，这里使用黑体（SimHei）</span></span>
<span id="cb11-17"><a></a><span class="fu">theme_set</span>(<span class="fu">theme_bw</span>(<span class="at">base_family =</span> <span class="st">"STKaiti"</span>))</span>
<span id="cb11-18"><a></a></span>
<span id="cb11-19"><a></a></span>
<span id="cb11-20"><a></a></span>
<span id="cb11-21"><a></a><span class="do">####</span></span>
<span id="cb11-22"><a></a><span class="co">#生成第五章各癌种年龄别率图#</span></span>
<span id="cb11-23"><a></a><span class="do">###</span></span>
<span id="cb11-24"><a></a></span>
<span id="cb11-25"><a></a>age_specific_rate <span class="ot">&lt;-</span> report<span class="sc">%&gt;%</span></span>
<span id="cb11-26"><a></a>  <span class="fu">filter</span>(city<span class="sc">==</span><span class="st">"33"</span>,code<span class="sc">&gt;=</span><span class="dv">101</span><span class="sc">&amp;</span>code<span class="sc">&lt;=</span><span class="dv">122</span><span class="sc">|</span>code<span class="sc">==</span><span class="dv">62</span>)<span class="sc">%&gt;%</span></span>
<span id="cb11-27"><a></a>  <span class="fu">select</span>(areacode,sex,code,icd,by,i0<span class="sc">:</span>i85,d0<span class="sc">:</span>d85)<span class="sc">%&gt;%</span></span>
<span id="cb11-28"><a></a>  <span class="fu">melt</span>(<span class="at">id.vars=</span><span class="fu">c</span>(<span class="st">"areacode"</span>,<span class="st">"sex"</span>,<span class="st">"code"</span>,<span class="st">"icd"</span>,<span class="st">"by"</span>),</span>
<span id="cb11-29"><a></a>       <span class="at">variable.name =</span> <span class="st">"type"</span>,</span>
<span id="cb11-30"><a></a>       <span class="at">value.name=</span><span class="st">"rate"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-31"><a></a>  <span class="fu">mutate</span>(<span class="at">order=</span>code<span class="dv">-100</span>,</span>
<span id="cb11-32"><a></a>         <span class="at">age=</span><span class="fu">as.numeric</span>(<span class="fu">ifelse</span>(<span class="fu">substr</span>(type,<span class="dv">1</span>,<span class="dv">1</span>)<span class="sc">==</span><span class="st">"i"</span>,<span class="fu">gsub</span>(<span class="st">"i"</span>,<span class="st">""</span>,type),<span class="fu">gsub</span>(<span class="st">"d"</span>,<span class="st">""</span>,type))),</span>
<span id="cb11-33"><a></a>         <span class="at">type=</span><span class="fu">ifelse</span>(<span class="fu">substr</span>(type,<span class="dv">1</span>,<span class="dv">1</span>)<span class="sc">==</span><span class="st">"i"</span>,<span class="st">"incidence"</span>,<span class="st">"mortality"</span>))</span>
<span id="cb11-34"><a></a></span>
<span id="cb11-35"><a></a>age_specific_rate2<span class="ot">&lt;-</span>age_specific_rate<span class="sc">%&gt;%</span></span>
<span id="cb11-36"><a></a>  <span class="fu">filter</span>(code<span class="sc">==</span><span class="dv">62</span>)<span class="sc">%&gt;%</span></span>
<span id="cb11-37"><a></a>  <span class="fu">mutate</span>(<span class="at">sex=</span><span class="fu">ifelse</span>(areacode<span class="sc">==</span><span class="st">"510000"</span>,<span class="fu">paste0</span>(<span class="st">"城市"</span>,sex),</span>
<span id="cb11-38"><a></a>                    <span class="fu">ifelse</span>(areacode<span class="sc">==</span><span class="st">"520000"</span>,<span class="fu">paste0</span>(<span class="st">"农村"</span>,sex),sex)))<span class="sc">%&gt;%</span></span>
<span id="cb11-39"><a></a>  <span class="fu">filter</span>(<span class="sc">!</span>(areacode<span class="sc">==</span><span class="st">"500000"</span>))<span class="sc">%&gt;%</span></span>
<span id="cb11-40"><a></a>  <span class="fu">mutate</span>(<span class="at">areacode=</span><span class="st">"530000"</span>)</span>
<span id="cb11-41"><a></a></span>
<span id="cb11-42"><a></a></span>
<span id="cb11-43"><a></a>age_specific_rate<span class="ot">&lt;-</span>age_specific_rate<span class="sc">%&gt;%</span></span>
<span id="cb11-44"><a></a>  <span class="fu">filter</span>(<span class="sc">!</span>((code <span class="sc">%in%</span> <span class="dv">112</span><span class="sc">:</span><span class="dv">115</span>)<span class="sc">&amp;</span>(sex <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"合计"</span>,<span class="st">"男性"</span>))),<span class="sc">!</span>(code<span class="sc">==</span><span class="dv">116</span><span class="sc">&amp;</span>sex<span class="sc">%in%</span><span class="fu">c</span>(<span class="st">"合计"</span>,<span class="st">"女性"</span>)))</span>
<span id="cb11-45"><a></a></span>
<span id="cb11-46"><a></a>Age_specific_rate<span class="ot">&lt;-</span><span class="fu">rbind</span>(age_specific_rate,age_specific_rate2)<span class="sc">%&gt;%</span></span>
<span id="cb11-47"><a></a>  <span class="fu">mutate</span>(<span class="at">order=</span><span class="fu">ifelse</span>(order<span class="sc">==-</span><span class="dv">38</span>,<span class="dv">0</span>,order))<span class="sc">%&gt;%</span></span>
<span id="cb11-48"><a></a>  <span class="fu">filter</span>(<span class="sc">!</span>(sex <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"城市合计"</span>,<span class="st">"农村合计"</span>)))</span>
<span id="cb11-49"><a></a></span>
<span id="cb11-50"><a></a></span>
<span id="cb11-51"><a></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">22</span>){</span>
<span id="cb11-52"><a></a>  plot <span class="ot">&lt;-</span> Age_specific_rate[Age_specific_rate<span class="sc">$</span>order<span class="sc">==</span>i,]</span>
<span id="cb11-53"><a></a>  <span class="cf">if</span> (i <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">12</span><span class="sc">:</span><span class="dv">16</span>)){</span>
<span id="cb11-54"><a></a>    ct <span class="ot">&lt;-</span> plot<span class="sc">%&gt;%</span><span class="fu">mutate</span>(<span class="at">areacode=</span><span class="fu">factor</span>(areacode,<span class="at">labels =</span><span class="fu">c</span>(<span class="st">"全省"</span>,<span class="st">"城市"</span>,<span class="st">"农村"</span>)))<span class="sc">%&gt;%</span><span class="fu">group_by</span>(type)<span class="sc">%&gt;%</span><span class="fu">group_split</span>()</span>
<span id="cb11-55"><a></a>  } <span class="cf">else</span> {</span>
<span id="cb11-56"><a></a>    ct <span class="ot">&lt;-</span> plot<span class="sc">%&gt;%</span><span class="fu">group_by</span>(type,areacode)<span class="sc">%&gt;%</span><span class="fu">group_split</span>()</span>
<span id="cb11-57"><a></a>  }</span>
<span id="cb11-58"><a></a></span>
<span id="cb11-59"><a></a>  icd<span class="ot">&lt;-</span>plot[<span class="dv">1</span>,<span class="fu">c</span>(<span class="st">"icd"</span>)]</span>
<span id="cb11-60"><a></a></span>
<span id="cb11-61"><a></a>  p<span class="ot">&lt;-</span> <span class="fu">lapply</span>(ct,<span class="cf">function</span>(x) {</span>
<span id="cb11-62"><a></a>    type<span class="ot">&lt;-</span>x[<span class="dv">1</span>,<span class="fu">c</span>(<span class="st">"type"</span>)]</span>
<span id="cb11-63"><a></a>    <span class="cf">if</span> (i <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">12</span><span class="sc">:</span><span class="dv">16</span>)){</span>
<span id="cb11-64"><a></a>      p<span class="ot">&lt;-</span><span class="fu">ggplot</span>(x,<span class="fu">aes</span>(<span class="at">x=</span>age,<span class="at">y=</span>rate,<span class="at">group=</span>areacode))<span class="sc">+</span><span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">colour=</span>areacode),<span class="at">size=</span><span class="fl">1.2</span>)</span>
<span id="cb11-65"><a></a>    } <span class="cf">else</span> {</span>
<span id="cb11-66"><a></a>      p<span class="ot">&lt;-</span><span class="fu">ggplot</span>(x,<span class="fu">aes</span>(<span class="at">x=</span>age,<span class="at">y=</span>rate,<span class="at">group=</span>sex))<span class="sc">+</span><span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">colour=</span>sex),<span class="at">size=</span><span class="fl">1.2</span>)</span>
<span id="cb11-67"><a></a>    }</span>
<span id="cb11-68"><a></a>    p<span class="ot">&lt;-</span>p<span class="sc">+</span><span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">20</span>,<span class="dv">30</span>,<span class="dv">40</span>,<span class="dv">50</span>,<span class="dv">60</span>,<span class="dv">70</span>,<span class="dv">80</span>))<span class="sc">+</span></span>
<span id="cb11-69"><a></a>      <span class="fu">theme_classic</span>()<span class="sc">+</span></span>
<span id="cb11-70"><a></a>      <span class="fu">xlab</span>(<span class="st">"年龄(岁)"</span>)<span class="sc">+</span></span>
<span id="cb11-71"><a></a>      <span class="fu">ylab</span>(<span class="fu">ifelse</span>(type<span class="sc">==</span><span class="st">"incidence"</span>,<span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">"年龄别发病率（1/"</span>, <span class="dv">10</span><span class="sc">^</span><span class="dv">5</span>,<span class="st">")"</span>)),<span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">"年龄别死亡率（1/"</span>, <span class="dv">10</span><span class="sc">^</span><span class="dv">5</span>,<span class="st">")"</span>))))<span class="sc">+</span></span>
<span id="cb11-72"><a></a>      <span class="fu">scale_color_lancet</span>()<span class="sc">+</span></span>
<span id="cb11-73"><a></a>      <span class="fu">theme</span>(</span>
<span id="cb11-74"><a></a>        <span class="at">text=</span><span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">"STKaiti"</span>),</span>
<span id="cb11-75"><a></a>        <span class="at">legend.position=</span><span class="fu">c</span>(<span class="fl">0.2</span>,<span class="fl">0.8</span>),</span>
<span id="cb11-76"><a></a>        <span class="at">legend.title=</span><span class="fu">element_blank</span>(),</span>
<span id="cb11-77"><a></a>        <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">face=</span><span class="st">"bold"</span>),</span>
<span id="cb11-78"><a></a>        <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">face=</span><span class="st">"bold"</span>),</span>
<span id="cb11-79"><a></a>        <span class="at">axis.line=</span><span class="fu">element_line</span>(<span class="at">size=</span><span class="fl">0.5</span>,<span class="at">colour=</span><span class="st">"black"</span>),</span>
<span id="cb11-80"><a></a>        <span class="at">axis.ticks =</span> <span class="fu">element_line</span>(<span class="at">size=</span><span class="fl">0.5</span>,<span class="at">colour=</span><span class="st">"black"</span>))</span>
<span id="cb11-81"><a></a></span>
<span id="cb11-82"><a></a>  })</span>
<span id="cb11-83"><a></a></span>
<span id="cb11-84"><a></a>  <span class="cf">if</span> (i<span class="sc">==</span><span class="dv">0</span>){</span>
<span id="cb11-85"><a></a>    p_com1<span class="ot">&lt;-</span><span class="fu">plot_grid</span>(p[[<span class="dv">1</span>]],p[[<span class="dv">2</span>]],p[[<span class="dv">3</span>]],p[[<span class="dv">4</span>]],<span class="at">labels=</span><span class="fu">c</span>(<span class="st">"全省"</span>,<span class="st">"城市"</span>,<span class="st">"农村"</span>,<span class="st">"城市和农村"</span>),<span class="at">label_size=</span><span class="dv">13</span>,<span class="at">label_x=</span><span class="fl">0.35</span>,<span class="at">align=</span><span class="st">"hv"</span>,<span class="at">ncol=</span><span class="dv">2</span>,<span class="at">nrow=</span><span class="dv">2</span>,<span class="at">byrow=</span><span class="cn">TRUE</span>)</span>
<span id="cb11-86"><a></a>    p_com2<span class="ot">&lt;-</span><span class="fu">plot_grid</span>(p[[<span class="dv">5</span>]],p[[<span class="dv">6</span>]],p[[<span class="dv">7</span>]],p[[<span class="dv">8</span>]],<span class="at">labels=</span><span class="fu">c</span>(<span class="st">"全省"</span>,<span class="st">"城市"</span>,<span class="st">"农村"</span>,<span class="st">"城市和农村"</span>),<span class="at">label_size=</span><span class="dv">13</span>,<span class="at">label_x=</span><span class="fl">0.35</span>,<span class="at">align=</span><span class="st">"hv"</span>,<span class="at">ncol=</span><span class="dv">2</span>,<span class="at">nrow=</span><span class="dv">2</span>,<span class="at">byrow=</span><span class="cn">TRUE</span>)</span>
<span id="cb11-87"><a></a>    loca2 <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"./images/Chapter4-"</span>,<span class="st">"2.png"</span>,<span class="at">sep=</span><span class="st">""</span>)</span>
<span id="cb11-88"><a></a>    loca3 <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"./images/Chapter4-"</span>,<span class="st">"6.png"</span>,<span class="at">sep=</span><span class="st">""</span>)</span>
<span id="cb11-89"><a></a>    <span class="fu">ggsave</span>(loca2,p_com1,<span class="at">width=</span><span class="dv">8</span>,<span class="at">height=</span><span class="fl">6.6</span>,<span class="at">device=</span><span class="st">"png"</span>)</span>
<span id="cb11-90"><a></a>    <span class="fu">ggsave</span>(loca3,p_com2,<span class="at">width=</span><span class="dv">8</span>,<span class="at">height=</span><span class="fl">6.6</span>,<span class="at">device=</span><span class="st">"png"</span>)</span>
<span id="cb11-91"><a></a>  } <span class="cf">else</span> <span class="cf">if</span>(i <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">12</span><span class="sc">:</span><span class="dv">16</span>)){</span>
<span id="cb11-92"><a></a>    p_comx<span class="ot">&lt;-</span><span class="fu">plot_grid</span>(p[[<span class="dv">1</span>]],p[[<span class="dv">2</span>]],<span class="at">labels=</span><span class="fu">c</span>(<span class="st">"发病"</span>,<span class="st">"死亡"</span>), <span class="at">lable_size=</span><span class="dv">13</span>,<span class="at">label_x=</span><span class="fl">0.35</span>,<span class="at">ncol=</span><span class="dv">2</span>,<span class="at">nrow=</span><span class="dv">1</span>,<span class="at">align=</span><span class="st">"hv"</span>)</span>
<span id="cb11-93"><a></a>    loca <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"./images/Chapter5-"</span>,i,<span class="st">"-1.png"</span>,<span class="at">sep=</span><span class="st">""</span>)</span>
<span id="cb11-94"><a></a>    <span class="fu">ggsave</span>(loca,p_comx,<span class="at">width=</span><span class="dv">8</span>,<span class="at">height=</span><span class="fl">3.3</span>,<span class="at">device=</span><span class="st">"png"</span>)</span>
<span id="cb11-95"><a></a>  }</span>
<span id="cb11-96"><a></a>  <span class="cf">else</span> {</span>
<span id="cb11-97"><a></a>    p_com<span class="ot">&lt;-</span><span class="fu">plot_grid</span>(p[[<span class="dv">1</span>]],p[[<span class="dv">4</span>]],p[[<span class="dv">2</span>]],p[[<span class="dv">5</span>]],p[[<span class="dv">3</span>]],p[[<span class="dv">6</span>]],<span class="at">labels=</span><span class="fu">c</span>(<span class="st">"全省 发病"</span>,<span class="st">"全省 死亡"</span>,<span class="st">"城市 发病"</span>,<span class="st">"城市 死亡"</span>,<span class="st">"农村 发病"</span>,<span class="st">"农村 死亡"</span>),<span class="at">label_size=</span><span class="dv">13</span>,<span class="at">label_x=</span><span class="fl">0.35</span>,<span class="at">align=</span><span class="st">"hv"</span>,<span class="at">ncol=</span><span class="dv">2</span>,<span class="at">nrow=</span><span class="dv">3</span>,<span class="at">byrow=</span><span class="cn">TRUE</span>)</span>
<span id="cb11-98"><a></a>    <span class="co">#p_com&lt;-add_sub(p_com, paste("ICD10:",icd),x=0.07, y=0,vjust=0,hjust=0)</span></span>
<span id="cb11-99"><a></a>    loca <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"./images/Chapter5-"</span>,i,<span class="st">"-1.png"</span>,<span class="at">sep=</span><span class="st">""</span>)</span>
<span id="cb11-100"><a></a>    <span class="fu">ggsave</span>(loca,p_com,<span class="at">width=</span><span class="dv">8</span>,<span class="at">height=</span><span class="dv">10</span>,<span class="at">device=</span><span class="st">"png"</span>)</span>
<span id="cb11-101"><a></a>  }</span>
<span id="cb11-102"><a></a>}</span>
<span id="cb11-103"><a></a></span>
<span id="cb11-104"><a></a><span class="do">####</span></span>
<span id="cb11-105"><a></a><span class="co">#生成第五章各癌种不同地区发病率和死亡率顺位图#</span></span>
<span id="cb11-106"><a></a><span class="do">####</span></span>
<span id="cb11-107"><a></a></span>
<span id="cb11-108"><a></a>area_rate <span class="ot">&lt;-</span> report<span class="sc">%&gt;%</span></span>
<span id="cb11-109"><a></a>  <span class="fu">filter</span>(<span class="sc">!</span>(city<span class="sc">==</span><span class="st">"33"</span>),code<span class="sc">&gt;=</span><span class="dv">101</span><span class="sc">&amp;</span>code<span class="sc">&lt;=</span><span class="dv">122</span>)<span class="sc">%&gt;%</span></span>
<span id="cb11-110"><a></a>  <span class="fu">select</span>(areacode,city,name,sex,code,icd,by,ics2000,dcs2000)<span class="sc">%&gt;%</span></span>
<span id="cb11-111"><a></a>  <span class="fu">melt</span>(<span class="at">id.vars=</span><span class="fu">c</span>(<span class="st">"areacode"</span>,<span class="st">"city"</span>,<span class="st">"name"</span>,<span class="st">"sex"</span>,<span class="st">"code"</span>,<span class="st">"icd"</span>,<span class="st">"by"</span>),</span>
<span id="cb11-112"><a></a>       <span class="at">variable.name =</span> <span class="st">"type"</span>,</span>
<span id="cb11-113"><a></a>       <span class="at">value.name=</span><span class="st">"rate"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-114"><a></a>  <span class="fu">mutate</span>(<span class="at">order=</span>code<span class="dv">-100</span>,</span>
<span id="cb11-115"><a></a>         <span class="at">city=</span><span class="fu">ifelse</span>(city<span class="sc">==</span><span class="dv">11</span>,<span class="dv">1</span>,city),</span>
<span id="cb11-116"><a></a>         <span class="at">type=</span><span class="fu">ifelse</span>(type<span class="sc">==</span><span class="st">"ics2000"</span>,<span class="st">"发病率"</span>,<span class="st">"死亡率"</span>),</span>
<span id="cb11-117"><a></a>         <span class="at">rate=</span><span class="fu">ifelse</span>(sex<span class="sc">==</span><span class="st">"男性"</span>,<span class="sc">-</span>rate,rate),</span>
<span id="cb11-118"><a></a>         )<span class="sc">%&gt;%</span></span>
<span id="cb11-119"><a></a>  <span class="fu">filter</span>(<span class="sc">!</span>((code <span class="sc">%in%</span> <span class="dv">112</span><span class="sc">:</span><span class="dv">115</span>)<span class="sc">&amp;</span> sex <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"合计"</span>,<span class="st">"男性"</span>)),</span>
<span id="cb11-120"><a></a>         <span class="sc">!</span>(code<span class="sc">==</span><span class="dv">116</span><span class="sc">&amp;</span>sex<span class="sc">%in%</span><span class="fu">c</span>(<span class="st">"合计"</span>,<span class="st">"女性"</span>)))</span>
<span id="cb11-121"><a></a></span>
<span id="cb11-122"><a></a><span class="co">#自定义主题</span></span>
<span id="cb11-123"><a></a>theme_nb <span class="ot">&lt;-</span> <span class="cf">function</span>(..., <span class="at">bg=</span><span class="st">'white'</span>){</span>
<span id="cb11-124"><a></a>  <span class="fu">theme_classic</span>(...) <span class="sc">+</span></span>
<span id="cb11-125"><a></a>    <span class="fu">theme</span>(</span>
<span id="cb11-126"><a></a>      <span class="at">text=</span><span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">"STKaiti"</span>),</span>
<span id="cb11-127"><a></a>      <span class="at">legend.position=</span><span class="fu">c</span>(<span class="fl">0.7</span>,<span class="fl">0.1</span>),</span>
<span id="cb11-128"><a></a>      <span class="at">legend.title=</span><span class="fu">element_blank</span>(),</span>
<span id="cb11-129"><a></a>      <span class="at">axis.line.y=</span><span class="fu">element_blank</span>(),</span>
<span id="cb11-130"><a></a>      <span class="at">axis.title.y =</span><span class="fu">element_blank</span>(),</span>
<span id="cb11-131"><a></a>      <span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb11-132"><a></a>      <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">12</span>),</span>
<span id="cb11-133"><a></a>      <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">12</span>),</span>
<span id="cb11-134"><a></a>      <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">12</span>),</span>
<span id="cb11-135"><a></a>      <span class="at">axis.title.x =</span><span class="fu">element_text</span>(<span class="at">face=</span><span class="st">"bold"</span>,<span class="at">size=</span><span class="dv">14</span>))</span>
<span id="cb11-136"><a></a>}</span>
<span id="cb11-137"><a></a></span>
<span id="cb11-138"><a></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">22</span>)){</span>
<span id="cb11-139"><a></a>  plot <span class="ot">&lt;-</span> area_rate[area_rate<span class="sc">$</span>order<span class="sc">==</span>i,]</span>
<span id="cb11-140"><a></a>  ct <span class="ot">&lt;-</span> plot<span class="sc">%&gt;%</span><span class="fu">group_by</span>(city)<span class="sc">%&gt;%</span><span class="fu">group_split</span>()</span>
<span id="cb11-141"><a></a></span>
<span id="cb11-142"><a></a>  icd<span class="ot">&lt;-</span>plot[<span class="dv">1</span>,<span class="fu">c</span>(<span class="st">"icd"</span>)]</span>
<span id="cb11-143"><a></a></span>
<span id="cb11-144"><a></a>  <span class="cf">if</span> (i <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">11</span>,<span class="dv">17</span><span class="sc">:</span><span class="dv">22</span>)) {</span>
<span id="cb11-145"><a></a>    p<span class="ot">&lt;-</span> <span class="fu">lapply</span>(ct,<span class="cf">function</span>(x) {</span>
<span id="cb11-146"><a></a>      top_value <span class="ot">&lt;-</span>  <span class="fu">max</span>(<span class="fu">abs</span>(x<span class="sc">$</span>rate))</span>
<span id="cb11-147"><a></a></span>
<span id="cb11-148"><a></a>      xx <span class="ot">&lt;-</span>x<span class="sc">%&gt;%</span><span class="fu">filter</span>(sex<span class="sc">==</span><span class="st">"女性"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb11-149"><a></a>        <span class="fu">arrange</span>(type,rate)<span class="sc">%&gt;%</span></span>
<span id="cb11-150"><a></a>        <span class="fu">mutate</span>(<span class="at">name=</span><span class="fu">factor</span>(name,<span class="fu">unique</span>(name)),<span class="at">type=</span><span class="fu">factor</span>(type,<span class="at">levels=</span><span class="fu">c</span>(<span class="st">"死亡率"</span>,<span class="st">"发病率"</span>)))</span>
<span id="cb11-151"><a></a>      p2<span class="ot">&lt;-</span><span class="fu">ggplot</span>(<span class="at">data=</span>xx,<span class="fu">aes</span>(<span class="at">y=</span>name))<span class="sc">+</span></span>
<span id="cb11-152"><a></a>        <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x=</span>rate,<span class="at">fill=</span><span class="fu">factor</span>(type)),<span class="at">stat =</span> <span class="st">"identity"</span>,<span class="at">position =</span> <span class="st">"dodge"</span>)<span class="sc">+</span></span>
<span id="cb11-153"><a></a>        <span class="fu">scale_fill_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">'#e31a1c'</span>,<span class="st">'#4169E1'</span>))<span class="sc">+</span></span>
<span id="cb11-154"><a></a>        <span class="fu">scale_x_continuous</span>(<span class="at">position =</span> <span class="st">"top"</span>,<span class="at">limits=</span><span class="fu">c</span>(<span class="dv">0</span>,top_value))<span class="sc">+</span></span>
<span id="cb11-155"><a></a>        <span class="fu">xlab</span>(<span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">"女性率（1/"</span>, <span class="dv">10</span><span class="sc">^</span><span class="dv">5</span>,<span class="st">"）"</span>)))<span class="sc">+</span></span>
<span id="cb11-156"><a></a>        <span class="fu">scale_y_discrete</span>(<span class="at">position =</span> <span class="st">"right"</span>)<span class="sc">+</span></span>
<span id="cb11-157"><a></a>        <span class="fu">theme_nb</span>()</span>
<span id="cb11-158"><a></a></span>
<span id="cb11-159"><a></a>      xx <span class="ot">&lt;-</span>x<span class="sc">%&gt;%</span><span class="fu">filter</span>(sex<span class="sc">==</span><span class="st">"男性"</span>)<span class="sc">%&gt;%</span><span class="fu">mutate</span>(<span class="at">rate2=</span><span class="fu">abs</span>(rate))<span class="sc">%&gt;%</span><span class="fu">arrange</span>(type,rate2)<span class="sc">%&gt;%</span><span class="fu">mutate</span>(<span class="at">name=</span><span class="fu">factor</span>(name,<span class="fu">unique</span>(name)),<span class="at">type=</span><span class="fu">factor</span>(type,<span class="at">levels=</span><span class="fu">c</span>(<span class="st">"死亡率"</span>,<span class="st">"发病率"</span>)))</span>
<span id="cb11-160"><a></a>      p1<span class="ot">&lt;-</span><span class="fu">ggplot</span>(<span class="at">data=</span>xx,<span class="fu">aes</span>(<span class="at">x=</span>name))<span class="sc">+</span></span>
<span id="cb11-161"><a></a>        <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">y=</span>rate,<span class="at">fill=</span><span class="fu">factor</span>(type)),<span class="at">stat =</span> <span class="st">"identity"</span>,<span class="at">position =</span> <span class="st">"dodge"</span>)<span class="sc">+</span></span>
<span id="cb11-162"><a></a>        <span class="fu">scale_fill_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">'#e31a1c'</span>,<span class="st">'#4169E1'</span>))<span class="sc">+</span></span>
<span id="cb11-163"><a></a>        <span class="fu">scale_y_continuous</span>(<span class="at">position =</span> <span class="st">"right"</span>,<span class="at">limits=</span><span class="fu">c</span>(<span class="sc">-</span>top_value,<span class="dv">0</span>),<span class="at">labels=</span>abs)<span class="sc">+</span></span>
<span id="cb11-164"><a></a>        <span class="fu">ylab</span>(<span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">"男性率（1/"</span>, <span class="dv">10</span><span class="sc">^</span><span class="dv">5</span>,<span class="st">"）"</span>)))<span class="sc">+</span></span>
<span id="cb11-165"><a></a>        <span class="fu">coord_flip</span>()<span class="sc">+</span></span>
<span id="cb11-166"><a></a>        <span class="fu">theme_nb</span>()<span class="sc">+</span></span>
<span id="cb11-167"><a></a>        <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"none"</span>)</span>
<span id="cb11-168"><a></a>      p3<span class="ot">&lt;-</span><span class="fu">plot_grid</span>(p1,p2,<span class="at">labels=</span><span class="fu">c</span>(<span class="st">""</span>,<span class="st">""</span>),<span class="at">ncol=</span><span class="dv">2</span>)</span>
<span id="cb11-169"><a></a>      <span class="fu">return</span>(p3)</span>
<span id="cb11-170"><a></a>    })</span>
<span id="cb11-171"><a></a></span>
<span id="cb11-172"><a></a>  } <span class="cf">else</span> {</span>
<span id="cb11-173"><a></a>    <span class="co">#制作单性别癌种图</span></span>
<span id="cb11-174"><a></a>    p<span class="ot">&lt;-</span> <span class="fu">lapply</span>(ct,<span class="cf">function</span>(x) {</span>
<span id="cb11-175"><a></a>      top_value <span class="ot">&lt;-</span>  <span class="fu">max</span>(<span class="fu">abs</span>(x<span class="sc">$</span>rate))</span>
<span id="cb11-176"><a></a>      xx <span class="ot">&lt;-</span>x<span class="sc">%&gt;%</span><span class="fu">mutate</span>(<span class="at">rate2=</span><span class="fu">abs</span>(rate))<span class="sc">%&gt;%</span><span class="fu">arrange</span>(type,rate2)<span class="sc">%&gt;%</span><span class="fu">mutate</span>(<span class="at">name=</span><span class="fu">factor</span>(name,<span class="fu">unique</span>(name)),<span class="at">type=</span><span class="fu">factor</span>(type,<span class="at">levels=</span><span class="fu">c</span>(<span class="st">"死亡率"</span>,<span class="st">"发病率"</span>)))</span>
<span id="cb11-177"><a></a>      px<span class="ot">&lt;-</span><span class="fu">ggplot</span>(<span class="at">data=</span>xx,<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">y=</span>name))<span class="sc">+</span></span>
<span id="cb11-178"><a></a>        <span class="fu">geom_bar</span>(<span class="at">mapping=</span><span class="fu">aes</span>(<span class="at">x=</span>rate2,<span class="at">fill=</span><span class="fu">factor</span>(type)),<span class="at">stat =</span> <span class="st">"identity"</span>,<span class="at">position =</span> <span class="st">"dodge"</span>)<span class="sc">+</span></span>
<span id="cb11-179"><a></a>        <span class="fu">scale_fill_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">'#e31a1c'</span>,<span class="st">'#4169E1'</span>))<span class="sc">+</span></span>
<span id="cb11-180"><a></a>        <span class="fu">scale_x_continuous</span>(<span class="at">position =</span> <span class="st">"top"</span>,<span class="at">limits=</span><span class="fu">c</span>(<span class="dv">0</span>,top_value))<span class="sc">+</span></span>
<span id="cb11-181"><a></a>        <span class="fu">scale_y_discrete</span>(<span class="at">position =</span> <span class="st">"left"</span>)<span class="sc">+</span></span>
<span id="cb11-182"><a></a>        <span class="fu">xlab</span>(<span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">"中标率（1/"</span>, <span class="dv">10</span><span class="sc">^</span><span class="dv">5</span>,<span class="st">"）"</span>)))<span class="sc">+</span></span>
<span id="cb11-183"><a></a>        <span class="fu">theme_nb</span>()</span>
<span id="cb11-184"><a></a>      <span class="fu">return</span>(px)</span>
<span id="cb11-185"><a></a>    })</span>
<span id="cb11-186"><a></a>  }</span>
<span id="cb11-187"><a></a></span>
<span id="cb11-188"><a></a>  loca2 <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"./images/Chapter5-"</span>,i,<span class="st">"-2.png"</span>,<span class="at">sep=</span><span class="st">""</span>)</span>
<span id="cb11-189"><a></a>  loca3 <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"./images/Chapter5-"</span>,i,<span class="st">"-3.png"</span>,<span class="at">sep=</span><span class="st">""</span>)</span>
<span id="cb11-190"><a></a>  <span class="fu">ggsave</span>(loca2,p[[<span class="dv">1</span>]],<span class="at">width=</span><span class="dv">8</span>,<span class="at">height=</span><span class="dv">4</span>,<span class="at">device=</span><span class="st">"png"</span>)</span>
<span id="cb11-191"><a></a>  <span class="fu">ggsave</span>(loca3,p[[<span class="dv">2</span>]],<span class="at">width=</span><span class="dv">8</span>,<span class="at">height=</span><span class="dv">10</span>,<span class="at">device=</span><span class="st">"png"</span>)</span>
<span id="cb11-192"><a></a>}</span>
<span id="cb11-193"><a></a></span>
<span id="cb11-194"><a></a></span>
<span id="cb11-195"><a></a></span>
<span id="cb11-196"><a></a><span class="do">####</span></span>
<span id="cb11-197"><a></a><span class="co">#生成第四章 前10肿瘤 顺位及构成图#</span></span>
<span id="cb11-198"><a></a><span class="do">####</span></span>
<span id="cb11-199"><a></a></span>
<span id="cb11-200"><a></a>t1 <span class="ot">&lt;-</span> report<span class="sc">%&gt;%</span></span>
<span id="cb11-201"><a></a>  <span class="fu">filter</span>( city<span class="sc">==</span><span class="st">"33"</span>,code<span class="sc">&gt;=</span><span class="dv">101</span><span class="sc">&amp;</span>code<span class="sc">&lt;=</span><span class="dv">122</span>)<span class="sc">%&gt;%</span></span>
<span id="cb11-202"><a></a>  <span class="fu">select</span>(areacode,name,sex,code,icd,by,ihj,fcon)<span class="sc">%&gt;%</span></span>
<span id="cb11-203"><a></a>  <span class="fu">mutate</span>(<span class="at">type=</span><span class="st">"incidence"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb11-204"><a></a>  <span class="fu">rename</span>(<span class="at">rate=</span>ihj,<span class="at">constitute=</span>fcon)</span>
<span id="cb11-205"><a></a></span>
<span id="cb11-206"><a></a>t2 <span class="ot">&lt;-</span> report<span class="sc">%&gt;%</span></span>
<span id="cb11-207"><a></a>  <span class="fu">filter</span>( city<span class="sc">==</span><span class="st">"33"</span>,code<span class="sc">&gt;=</span><span class="dv">101</span><span class="sc">&amp;</span>code<span class="sc">&lt;=</span><span class="dv">122</span>)<span class="sc">%&gt;%</span></span>
<span id="cb11-208"><a></a>  <span class="fu">select</span>(areacode,name,sex,code,icd,by,dhj,scon)<span class="sc">%&gt;%</span></span>
<span id="cb11-209"><a></a>  <span class="fu">mutate</span>(<span class="at">type=</span><span class="st">"mortality"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb11-210"><a></a>  <span class="fu">rename</span>(<span class="at">rate=</span>dhj,<span class="at">constitute=</span>scon)</span>
<span id="cb11-211"><a></a></span>
<span id="cb11-212"><a></a>total_rank<span class="ot">&lt;-</span><span class="fu">rbind</span>(t1,t2)<span class="sc">%&gt;%</span></span>
<span id="cb11-213"><a></a>  <span class="fu">mutate</span>(<span class="at">by=</span><span class="fu">ifelse</span>(code<span class="sc">==</span><span class="dv">110</span>,<span class="st">"肺"</span>,</span>
<span id="cb11-214"><a></a>                   <span class="fu">ifelse</span>(code<span class="sc">==</span><span class="dv">119</span>,<span class="st">"脑"</span>,</span>
<span id="cb11-215"><a></a>                          <span class="fu">ifelse</span>(code<span class="sc">==</span><span class="dv">105</span>,<span class="st">"结直肠"</span>,</span>
<span id="cb11-216"><a></a>                                 <span class="fu">ifelse</span>(code<span class="sc">==</span><span class="dv">107</span>,<span class="st">"胆囊"</span>,</span>
<span id="cb11-217"><a></a>                                        <span class="fu">ifelse</span>(code<span class="sc">==</span><span class="dv">117</span>,<span class="st">"肾"</span>,</span>
<span id="cb11-218"><a></a>                                               <span class="fu">ifelse</span>(code<span class="sc">==</span><span class="dv">121</span>,<span class="st">"淋巴瘤"</span>,by)))))),</span>
<span id="cb11-219"><a></a>         <span class="at">cate=</span><span class="fu">paste0</span>(by,<span class="st">"("</span>,icd,<span class="st">")"</span>),</span>
<span id="cb11-220"><a></a>         <span class="at">cate=</span><span class="fu">ifelse</span>(code<span class="sc">==</span><span class="dv">121</span>,<span class="st">"淋巴瘤"</span>,cate),</span>
<span id="cb11-221"><a></a>         <span class="at">sex=</span><span class="fu">factor</span>(sex,<span class="at">levels=</span><span class="fu">c</span>(<span class="st">"合计"</span>,<span class="st">"男性"</span>,<span class="st">"女性"</span>),<span class="at">labels=</span><span class="fu">c</span>(<span class="st">"合计"</span>,<span class="st">"男性"</span>,<span class="st">"女性"</span>)))</span>
<span id="cb11-222"><a></a></span>
<span id="cb11-223"><a></a></span>
<span id="cb11-224"><a></a>mycolor<span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'#1f78b4'</span>,<span class="st">'#a6cee3'</span>,<span class="st">'#33a02c'</span>,<span class="st">'#b2df8a'</span>,<span class="st">'#e31a1c'</span>,<span class="st">'#fb9a99'</span>,<span class="st">'#ff7f00'</span>,<span class="st">'#fdbf6f'</span>,<span class="st">'#6a3d9a'</span>,<span class="st">'#cab2d6'</span>,<span class="st">'#ffff99'</span>)</span>
<span id="cb11-225"><a></a></span>
<span id="cb11-226"><a></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">c</span>(<span class="st">"incidence"</span>,<span class="st">"mortality"</span>)) {</span>
<span id="cb11-227"><a></a>  <span class="cf">for</span> (j <span class="cf">in</span> <span class="fu">c</span>(<span class="st">"全省"</span>,<span class="st">"城市地区"</span>,<span class="st">"农村地区"</span>)) {</span>
<span id="cb11-228"><a></a>    plot <span class="ot">&lt;-</span> total_rank[total_rank<span class="sc">$</span>type<span class="sc">==</span>i <span class="sc">&amp;</span> total_rank<span class="sc">$</span>name<span class="sc">==</span>j,]</span>
<span id="cb11-229"><a></a>    ct <span class="ot">&lt;-</span> plot<span class="sc">%&gt;%</span><span class="fu">group_by</span>(sex)<span class="sc">%&gt;%</span><span class="fu">group_split</span>()</span>
<span id="cb11-230"><a></a>    p<span class="ot">&lt;-</span> <span class="fu">lapply</span>(ct,<span class="cf">function</span>(x) {</span>
<span id="cb11-231"><a></a></span>
<span id="cb11-232"><a></a>      xx <span class="ot">&lt;-</span>x<span class="sc">%&gt;%</span><span class="fu">arrange</span>(rate)<span class="sc">%&gt;%</span><span class="fu">mutate</span>(<span class="at">cate=</span><span class="fu">factor</span>(cate,<span class="fu">unique</span>(cate)))<span class="sc">%&gt;%</span><span class="fu">slice</span>(<span class="dv">13</span><span class="sc">:</span><span class="dv">22</span>)</span>
<span id="cb11-233"><a></a>      yy<span class="ot">&lt;-</span><span class="fu">ggplot</span>(xx,<span class="fu">aes</span>(<span class="at">y=</span>cate))<span class="sc">+</span><span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x=</span>rate),<span class="at">fill=</span><span class="fu">ifelse</span>(i<span class="sc">==</span><span class="st">"incidence"</span>,<span class="st">"#1f78b4"</span>,<span class="st">"#e31a1c"</span>),<span class="at">stat =</span> <span class="st">"identity"</span>)<span class="sc">+</span><span class="fu">theme_void</span>()<span class="sc">+</span></span>
<span id="cb11-234"><a></a>        <span class="fu">scale_x_continuous</span>(<span class="at">position =</span> <span class="st">"top"</span>)<span class="sc">+</span></span>
<span id="cb11-235"><a></a>        <span class="fu">xlab</span>(<span class="fu">ifelse</span>(i<span class="sc">==</span><span class="st">"incidence"</span>,<span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">"发病率（1/"</span>, <span class="dv">10</span><span class="sc">^</span><span class="dv">5</span>,<span class="st">")"</span>)),<span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">"死亡率（1/"</span>, <span class="dv">10</span><span class="sc">^</span><span class="dv">5</span>,<span class="st">")"</span>))))<span class="sc">+</span></span>
<span id="cb11-236"><a></a>        <span class="fu">scale_y_discrete</span>(<span class="at">position =</span> <span class="st">"left"</span>,<span class="at">labels=</span><span class="cf">function</span>(x) <span class="fu">str_wrap</span>(x, <span class="at">width=</span><span class="dv">20</span>))<span class="sc">+</span></span>
<span id="cb11-237"><a></a>        <span class="fu">theme</span>(</span>
<span id="cb11-238"><a></a>          <span class="co">#plot.background = element_rect(fill="white",color="white"),</span></span>
<span id="cb11-239"><a></a>          <span class="at">text=</span><span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">"STKaiti"</span>),</span>
<span id="cb11-240"><a></a>          <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">9</span>),</span>
<span id="cb11-241"><a></a>          <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">9</span>),</span>
<span id="cb11-242"><a></a>          <span class="at">axis.line.y=</span><span class="fu">element_blank</span>(),</span>
<span id="cb11-243"><a></a>          <span class="at">axis.title.y =</span><span class="fu">element_blank</span>(),</span>
<span id="cb11-244"><a></a>          <span class="at">axis.title.x =</span><span class="fu">element_text</span>(<span class="at">face=</span><span class="st">"bold"</span>,<span class="at">size=</span><span class="dv">12</span>),</span>
<span id="cb11-245"><a></a>          <span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>()</span>
<span id="cb11-246"><a></a>        )</span>
<span id="cb11-247"><a></a></span>
<span id="cb11-248"><a></a>      xx <span class="ot">&lt;-</span>xx<span class="sc">%&gt;%</span><span class="fu">arrange</span>(<span class="fu">desc</span>(constitute))<span class="sc">%&gt;%</span><span class="fu">mutate</span>(<span class="at">cate=</span><span class="fu">factor</span>(cate,<span class="fu">unique</span>(cate)))</span>
<span id="cb11-249"><a></a>      xx2<span class="ot">&lt;-</span>xx<span class="sc">%&gt;%</span><span class="fu">mutate</span>(<span class="at">constitute=</span><span class="fu">round</span>(<span class="dv">100</span><span class="sc">-</span><span class="fu">sum</span>(constitute),<span class="dv">2</span>))<span class="sc">%&gt;%</span></span>
<span id="cb11-250"><a></a>        <span class="fu">distinct</span>(areacode,name,sex,constitute,type)<span class="sc">%&gt;%</span></span>
<span id="cb11-251"><a></a>        <span class="fu">mutate</span>(<span class="at">cate=</span><span class="st">"其它"</span>,<span class="at">code=</span><span class="dv">62</span>,<span class="at">by=</span><span class="st">"其它"</span>,<span class="at">rate=</span><span class="dv">50</span>,<span class="at">icd=</span><span class="st">"other"</span>)</span>
<span id="cb11-252"><a></a>      xx<span class="ot">&lt;-</span><span class="fu">rbind</span>(xx,xx2)</span>
<span id="cb11-253"><a></a></span>
<span id="cb11-254"><a></a>      zz <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(xx,<span class="fu">aes</span>(<span class="at">x=</span><span class="st">""</span>,<span class="at">y=</span>constitute,<span class="at">fill=</span>cate))<span class="sc">+</span></span>
<span id="cb11-255"><a></a>        <span class="fu">geom_bar</span>(<span class="at">width=</span><span class="dv">1</span>,<span class="at">stat=</span><span class="st">"identity"</span>,<span class="at">color=</span><span class="st">"white"</span>)<span class="sc">+</span></span>
<span id="cb11-256"><a></a>        <span class="fu">coord_polar</span>(<span class="st">"y"</span>,<span class="at">start=</span><span class="dv">0</span>)<span class="sc">+</span></span>
<span id="cb11-257"><a></a>        <span class="fu">theme_void</span>()<span class="sc">+</span></span>
<span id="cb11-258"><a></a>        <span class="fu">scale_fill_manual</span>(<span class="at">values=</span> mycolor)<span class="sc">+</span></span>
<span id="cb11-259"><a></a>        <span class="co">#geom_text(aes(x=1.2,label=as.character(constitute)),position = position_stack(vjust=0.5),size=2)+</span></span>
<span id="cb11-260"><a></a>        <span class="fu">theme</span>(</span>
<span id="cb11-261"><a></a>          <span class="co">#plot.background = element_rect(fill="white",color="white"),</span></span>
<span id="cb11-262"><a></a>          <span class="at">text=</span><span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">"STKaiti"</span>),</span>
<span id="cb11-263"><a></a>          <span class="at">legend.title=</span><span class="fu">element_blank</span>(),</span>
<span id="cb11-264"><a></a>          <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>),</span>
<span id="cb11-265"><a></a>          <span class="at">legend.position =</span><span class="st">"right"</span>,</span>
<span id="cb11-266"><a></a>          <span class="at">legend.direction =</span> <span class="st">"vertical"</span>,</span>
<span id="cb11-267"><a></a>          <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb11-268"><a></a>          <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb11-269"><a></a>          <span class="at">panel.border =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb11-270"><a></a>          <span class="at">panel.grid=</span><span class="fu">element_blank</span>(),</span>
<span id="cb11-271"><a></a>          <span class="at">plot.margin =</span> <span class="fu">unit</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>), <span class="st">"lines"</span>),</span>
<span id="cb11-272"><a></a>          <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb11-273"><a></a>          <span class="at">plot.title=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">face=</span><span class="st">"bold"</span>)</span>
<span id="cb11-274"><a></a>        )</span>
<span id="cb11-275"><a></a></span>
<span id="cb11-276"><a></a>      com1<span class="ot">&lt;-</span><span class="fu">plot_grid</span>(yy,zz,<span class="at">ncol=</span><span class="dv">2</span>,<span class="at">labels=</span><span class="fu">c</span>(<span class="st">""</span>,<span class="st">"构成"</span>),<span class="at">label_x=</span><span class="fl">0.2</span>,<span class="at">label_y=</span><span class="fl">0.2</span>,<span class="at">label_size=</span><span class="dv">12</span>,<span class="at">rel_widths=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb11-277"><a></a>      <span class="fu">return</span>(com1)</span>
<span id="cb11-278"><a></a>    })</span>
<span id="cb11-279"><a></a></span>
<span id="cb11-280"><a></a>    pp<span class="ot">&lt;-</span><span class="fu">plot_grid</span>(p[[<span class="dv">1</span>]],p[[<span class="dv">2</span>]],p[[<span class="dv">3</span>]],<span class="at">ncol=</span><span class="dv">1</span>,<span class="at">labels=</span><span class="fu">c</span>(<span class="st">"合计"</span>,<span class="st">"男性"</span>,<span class="st">"女性"</span>),<span class="at">label_size=</span><span class="dv">13</span>,<span class="at">label_x=</span><span class="fl">0.45</span>,<span class="at">align=</span><span class="st">"hv"</span>)</span>
<span id="cb11-281"><a></a></span>
<span id="cb11-282"><a></a>    kk<span class="ot">&lt;-</span> <span class="fu">ifelse</span>(i<span class="sc">==</span><span class="st">"incidence"</span> <span class="sc">&amp;</span> j<span class="sc">==</span><span class="st">"全省"</span>,<span class="dv">3</span>,</span>
<span id="cb11-283"><a></a>                <span class="fu">ifelse</span>(i<span class="sc">==</span><span class="st">"incidence"</span> <span class="sc">&amp;</span> j<span class="sc">==</span><span class="st">"城市地区"</span>,<span class="dv">4</span>,</span>
<span id="cb11-284"><a></a>                       <span class="fu">ifelse</span>(i<span class="sc">==</span><span class="st">"incidence"</span> <span class="sc">&amp;</span> j<span class="sc">==</span><span class="st">"农村地区"</span>,<span class="dv">5</span>,</span>
<span id="cb11-285"><a></a>                              <span class="fu">ifelse</span>(i<span class="sc">==</span><span class="st">"mortality"</span> <span class="sc">&amp;</span> j<span class="sc">==</span><span class="st">"全省"</span>,<span class="dv">7</span>,</span>
<span id="cb11-286"><a></a>                                     <span class="fu">ifelse</span>(i<span class="sc">==</span><span class="st">"mortality"</span> <span class="sc">&amp;</span> j<span class="sc">==</span><span class="st">"城市地区"</span>,<span class="dv">8</span>,</span>
<span id="cb11-287"><a></a>                                            <span class="fu">ifelse</span>(i<span class="sc">==</span><span class="st">"mortality"</span> <span class="sc">&amp;</span> j<span class="sc">==</span><span class="st">"农村地区"</span>,<span class="dv">9</span>,))))))</span>
<span id="cb11-288"><a></a></span>
<span id="cb11-289"><a></a>    loca2 <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"./images/Chapter4-"</span>,kk,<span class="st">".png"</span>,<span class="at">sep=</span><span class="st">""</span>)</span>
<span id="cb11-290"><a></a>    <span class="fu">ggsave</span>(loca2,pp,<span class="at">width=</span><span class="dv">6</span>,<span class="at">height=</span><span class="dv">8</span>,<span class="at">device =</span> <span class="st">"png"</span>)</span>
<span id="cb11-291"><a></a></span>
<span id="cb11-292"><a></a>  }}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="基于bookdown撰写肿瘤登记年报-5" class="slide level2">
<h2>基于bookdown撰写《肿瘤登记年报》</h2>
<h3 id="图表批量生成-1">图表批量生成</h3>

<img data-src="images/pics.jpg" class="r-stretch"></section>
<section id="基于bookdown撰写肿瘤登记年报-6" class="slide level2">
<h2>基于bookdown撰写《肿瘤登记年报》</h2>
<div class="cell">
<iframe src="https://www.chenq.site/report/2021/" width="960" height="400px" data-external="1">
</iframe>
</div>
</section>
<section id="学习资源" class="slide level2">
<h2>学习资源</h2>
<ul>
<li><a href="https://rmarkdown.rstudio.com">R Markdown</a></li>
<li><a href="https://bookdown.org/yihui/bookdown/">bookdown</a></li>
<li><a href="https://quarto.org">Quarto官网</a></li>
<li><a href="https://github.com/mcanouil/awesome-quarto">Github: Awesome-quarto</a></li>
<li><a href="https://rstudio-conf-2022.github.io/get-started-quarto/materials/05-presentations.html#/presentations">Revealjs slides</a></li>
<li><a href="https://cosx.org/">统计之都</a></li>
</ul>
</section></section>
<section id="谢-谢-关-注" class="title-slide slide level1 center" data-background-color="lightblue">
<h1>谢 谢 关 注 !</h1>
<p>陈 琼</p>
<p>chenq08@126.com</p>
<div id="qr2" class="qrcode"></div>
<script type="text/javascript">
var qrcode = new QRCode("qr2", {"colorLight":"#ffffff","width":"60","colorDark":"#0011bb","height":"60","text":"https://www.chenq.site/qsight"});
</script>
    

<div class="quarto-auto-generated-content">
<div class="footer footer-default">
<p>河南省人群肿瘤登记</p>
</div>
</div>
<div class="reveal-header">
<div class="header-logo">
<img data-src="">
</div>
<div class="sc-title">
<p> </p>
</div>
<div class="header-text title-text">
<p>基于R Markdown / Quarto的可重复性报告撰写</p>
</div>
<div class="sb-title">
<p> </p>
</div>
</div>
</section>
    </div>
  </div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="../site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="../site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="../site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="../site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="../site_libs/revealjs/plugin/search/search.js"></script>
  <script src="../site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="../site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': true,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    
    <script>
      // htmlwidgets need to know to resize themselves when slides are shown/hidden.
      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
      // slide changes (different for each slide format).
      (function () {
        // dispatch for htmlwidgets
        function fireSlideEnter() {
          const event = window.document.createEvent("Event");
          event.initEvent("slideenter", true, true);
          window.document.dispatchEvent(event);
        }

        function fireSlideChanged(previousSlide, currentSlide) {
          fireSlideEnter();

          // dispatch for shiny
          if (window.jQuery) {
            if (previousSlide) {
              window.jQuery(previousSlide).trigger("hidden");
            }
            if (currentSlide) {
              window.jQuery(currentSlide).trigger("shown");
            }
          }
        }

        // hookup for slidy
        if (window.w3c_slidy) {
          window.w3c_slidy.add_observer(function (slide_num) {
            // slide_num starts at position 1
            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
          });
        }

      })();
    </script>

    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const onCopySuccess = function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      }
      const getTextToCopy = function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
        text: getTextToCopy
      });
      clipboard.on('success', onCopySuccess);
      if (window.document.getElementById('quarto-embedded-source-code-modal')) {
        // For code content inside modals, clipBoardJS needs to be initialized with a container option
        // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
        const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
          text: getTextToCopy,
          container: window.document.getElementById('quarto-embedded-source-code-modal')
        });
        clipboardModal.on('success', onCopySuccess);
      }
        var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
        var mailtoRegex = new RegExp(/^mailto:/);
          var filterRegex = new RegExp("http:\/\/chenq\.site:999");
        var isInternal = (href) => {
            return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
        }
        // Inspect non-navigation links and adorn them if external
     	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
        for (var i=0; i<links.length; i++) {
          const link = links[i];
          if (!isInternal(link.href)) {
            // undo the damage that might have been done by quarto-nav.js in the case of
            // links that we want to consider external
            if (link.dataset.originalHref !== undefined) {
              link.href = link.dataset.originalHref;
            }
          }
        }
      function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
        const config = {
          allowHTML: true,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start',
        };
        if (contentFn) {
          config.content = contentFn;
        }
        if (onTriggerFn) {
          config.onTrigger = onTriggerFn;
        }
        if (onUntriggerFn) {
          config.onUntrigger = onUntriggerFn;
        }
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note) {
            return note.innerHTML;
          } else {
            return "";
          }
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>